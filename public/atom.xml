<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Maxie&#39;blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2019-01-14T14:03:13.888Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>MaxieLj</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ç®—æ³•-æœ€å¤§å­åºå’Œ</title>
    <link href="http://yoursite.com/2019/01/14/%E7%AE%97%E6%B3%95-%E6%9C%80%E5%A4%A7%E5%AD%90%E5%BA%8F%E5%92%8C/"/>
    <id>http://yoursite.com/2019/01/14/ç®—æ³•-æœ€å¤§å­åºå’Œ/</id>
    <published>2019-01-14T13:43:04.000Z</published>
    <updated>2019-01-14T14:03:13.888Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><h3 id="è‹±æ–‡"><a href="#è‹±æ–‡" class="headerlink" title="è‹±æ–‡"></a>è‹±æ–‡</h3><p>Given an integer array nums, find the contiguous subarray (containing at least one number) which has the largest sum and return its sum.</p><p>Example:</p><p>Input: [-2,1,-3,4,-1,2,1,-5,4],<br>Output: 6<br>Explanation: [4,-1,2,1] has the largest sum = 6.</p><h3 id="ä¸­æ–‡"><a href="#ä¸­æ–‡" class="headerlink" title="ä¸­æ–‡"></a>ä¸­æ–‡</h3><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾åˆ°ä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›å…¶æœ€å¤§å’Œã€‚</p><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><ul><li>åŠ¨æ€è§„åˆ’ã€‚</li><li>æŠŠæ±‚è”ç³»æœ€å¤§å­åºåˆ—è½¬åŒ–ä¸ºæ±‚å½“å‰èŠ‚ç‚¹ä¸ä¸Šä¸€èŠ‚ç‚¹çš„æœ€å¤§å€¼ã€‚</li></ul><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">maxSubArray</span><span class="params">(<span class="keyword">int</span>* nums, <span class="keyword">int</span> numsSize)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(numsSize == <span class="number">0</span>)&#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(numsSize &lt;=<span class="number">1</span>)&#123;</div><div class="line">        <span class="keyword">return</span> *nums;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> tmp = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> pre =  *nums ;</div><div class="line">    nums++;</div><div class="line">    </div><div class="line">    <span class="keyword">int</span> ret = pre;</div><div class="line">   <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i&lt; numsSize;i++)</div><div class="line">   &#123;</div><div class="line">      </div><div class="line">       tmp = (pre + *nums) &gt; *nums ? (pre + *nums) : *nums;</div><div class="line">       </div><div class="line">           <span class="comment">// printf("tmp:%d\n", tmp);</span></div><div class="line">           <span class="keyword">if</span>(tmp &gt; ret)</div><div class="line">           &#123;</div><div class="line">               ret = tmp;</div><div class="line">           &#125;</div><div class="line">        </div><div class="line">       </div><div class="line">       pre = tmp;</div><div class="line">       nums++;</div><div class="line">   &#125;</div><div class="line">    <span class="keyword">return</span> ret;</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;é¢˜ç›®&quot;&gt;&lt;a href=&quot;#é¢˜ç›®&quot; class=&quot;headerlink&quot; title=&quot;é¢˜ç›®&quot;&gt;&lt;/a&gt;é¢˜ç›®&lt;/h2&gt;&lt;h3 id=&quot;è‹±æ–‡&quot;&gt;&lt;a href=&quot;#è‹±æ–‡&quot; class=&quot;headerlink&quot; title=&quot;è‹±æ–‡&quot;&gt;&lt;/a&gt;è‹±æ–‡&lt;/h3&gt;&lt;p&gt;Giv
      
    
    </summary>
    
      <category term="ç®—æ³•" scheme="http://yoursite.com/categories/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="ç®—æ³•" scheme="http://yoursite.com/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•-æ±‚æœ€å¤§æ­£æ–¹å½¢é¢ç§¯</title>
    <link href="http://yoursite.com/2019/01/14/%E7%AE%97%E6%B3%95-%E6%B1%82%E6%9C%80%E5%A4%A7%E6%AD%A3%E6%96%B9%E5%BD%A2%E9%9D%A2%E7%A7%AF/"/>
    <id>http://yoursite.com/2019/01/14/ç®—æ³•-æ±‚æœ€å¤§æ­£æ–¹å½¢é¢ç§¯/</id>
    <published>2019-01-14T09:18:04.000Z</published>
    <updated>2019-01-14T11:25:28.948Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><h3 id="è‹±æ–‡"><a href="#è‹±æ–‡" class="headerlink" title="è‹±æ–‡"></a>è‹±æ–‡</h3><p>Given a 2D binary matrix filled with 0â€™s and 1â€™s, find the largest square containing only 1â€™s and return its area.</p><p>Example:</p><p>Input: </p><p>1 0 1 0 0<br>1 0 1 1 1<br>1 1 1 1 1<br>1 0 0 1 0</p><p>Output: 4</p><h3 id="ä¸­æ–‡"><a href="#ä¸­æ–‡" class="headerlink" title="ä¸­æ–‡"></a>ä¸­æ–‡</h3><p>åœ¨ä¸€ä¸ªç”± 0 å’Œ 1 ç»„æˆçš„äºŒç»´çŸ©é˜µå†…ï¼Œæ‰¾åˆ°åªåŒ…å« 1 çš„æœ€å¤§æ­£æ–¹å½¢ï¼Œå¹¶è¿”å›å…¶é¢ç§¯ã€‚</p><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><ul><li>åŠ¨æ€è§„åˆ’(ä¸»è¦ç”¨æˆ·å°†ä¸€ä¸ªå¤æ‚çš„é—®é¢˜åˆ†è§£ä¸ºå¤šä¸ªå»ºå•çš„é—®é¢˜ï¼Œæ±‚æœ€ä¼˜è§£æ—¶)ã€‚</li><li>å£°æ˜ä¸€ä¸ªç©ºé—´å’ŒåŸæœ‰äºŒä½æ•°æ®å¤§å°ä¸€æ ·çš„äºŒä½æ•°ç»„(tmp[i][j])ã€‚</li><li>è®¡ç®—æ¯ä¸€ä¸ªèŠ‚ç‚¹æœ€å¤§æ­£æ–¹å½¢çš„è¾¹é•¿ï¼Œå¹¶å­˜å‚¨ä¸è¯¥èŠ‚ç‚¹ï¼ˆåˆ©ç”¨ä¹‹å‰èŠ‚ç‚¹è®¡ç®—å½“å‰èŠ‚ç‚¹æœ€å¤§æ­£æ–¹å½¢è¾¹é•¿ï¼‰ã€‚</li><li>å–tmp[i][j]å¾—æœ€å¤§å€¼çš„å¹³å‡¡è¿”å›ã€‚<h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2></li></ul><p><code>ç¬¬ä¸€ç‰ˆä»£ç </code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">maximalSquare</span><span class="params">($matrix)</span> </span>&#123;</div><div class="line">      $hight =  count($matrix);</div><div class="line">      <span class="keyword">if</span>($hight&lt;<span class="number">1</span>)</div><div class="line">      &#123;</div><div class="line">          <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">      &#125;</div><div class="line">      $wide = <span class="number">0</span>;</div><div class="line">      <span class="keyword">if</span>($hight &gt; <span class="number">0</span>)&#123;</div><div class="line">          $wide= count($matrix[<span class="number">0</span>]);</div><div class="line">      &#125;</div><div class="line">      $ret = <span class="number">0</span>;</div><div class="line">      <span class="keyword">for</span>($i = <span class="number">1</span>; $i&lt;= $hight; $i++)</div><div class="line">      &#123;</div><div class="line">          $tmp = <span class="keyword">$this</span>-&gt;getRet($matrix, $i, $hight, $wide);</div><div class="line">          <span class="keyword">if</span>($ret &lt;$tmp )&#123;</div><div class="line">              $ret = $tmp;</div><div class="line">          &#125;</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">return</span> $ret;</div><div class="line">  &#125;</div><div class="line">    </div><div class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getRet</span><span class="params">($matrix, $i, $hight, $wide)</span></span></div><div class="line">  &#123;</div><div class="line">    <span class="comment">//èµ·å§‹ç‚¹çºµå‘åæ ‡  </span></div><div class="line">    <span class="keyword">for</span>($h = <span class="number">0</span>; $h&lt;= $hight-$i; $h++ )</div><div class="line">    &#123;   </div><div class="line">        <span class="keyword">for</span>($j = <span class="number">0</span>;$j &lt;= $wide-$i; $j++)</div><div class="line">        &#123;</div><div class="line">            <span class="comment">//h ä¸ºèµ·ç‚¹é«˜ï¼Œjä¸ºèµ·ç‚¹å®½ã€‚</span></div><div class="line">            $ret = <span class="number">1</span>;</div><div class="line">            <span class="keyword">for</span>($m = $h; $m &lt;$h + $i; $m++)&#123;</div><div class="line">                <span class="keyword">for</span>($k = $j; $k &lt; $j + $i; $k++)&#123;</div><div class="line">                    <span class="keyword">if</span>($matrix[$m][$k] == <span class="number">0</span>)</div><div class="line">                    &#123;</div><div class="line">                        $ret = <span class="number">0</span>;</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span>($ret == <span class="number">0</span>) &#123;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>($ret == <span class="number">1</span>)&#123;</div><div class="line">                <span class="keyword">return</span> $i*$i;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">  &#125;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure><p>ç”¨phpè·‘æµ‹è¯•ç”¨ä¾‹ï¼Œè·‘äº†2.5ç§’ã€‚ğŸ˜“</p><p>å›å¤´ç”¨cé‡å†™ä¸‹è¯•è¯•ã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">å¾…å®š</div></pre></td></tr></table></figure></p><h2 id="æœ€ä¼˜è§£"><a href="#æœ€ä¼˜è§£" class="headerlink" title="æœ€ä¼˜è§£"></a>æœ€ä¼˜è§£</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maximalSquare</span><span class="params">(<span class="keyword">char</span>[][] matrix)</span> </span>&#123;</div><div class="line">        <span class="comment">/**</span></div><div class="line">        dp[i][j]è¡¨ç¤ºä»¥ç¬¬iè¡Œç¬¬jåˆ—ä¸ºå³ä¸‹è§’æ‰€èƒ½æ„æˆçš„æœ€å¤§æ­£æ–¹å½¢è¾¹é•¿, åˆ™é€’æ¨å¼ä¸º: </div><div class="line">        dp[i][j] = 1 + min(dp[i-1][j-1], dp[i-1][j], dp[i][j-1]);</div><div class="line">        **/</div><div class="line">        <span class="keyword">int</span> m = matrix.length;</div><div class="line">        <span class="keyword">if</span>(m &lt; <span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> n = matrix[<span class="number">0</span>].length;</div><div class="line">        <span class="keyword">int</span> max = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span>[][] dp = <span class="keyword">new</span> <span class="keyword">int</span>[m+<span class="number">1</span>][n+<span class="number">1</span>];</div><div class="line">        </div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) &#123;</div><div class="line">                <span class="keyword">if</span>(matrix[i-<span class="number">1</span>][j-<span class="number">1</span>] == <span class="string">'1'</span>) &#123;</div><div class="line">                    dp[i][j] = <span class="number">1</span> + Math.min(dp[i-<span class="number">1</span>][j-<span class="number">1</span>], Math.min(dp[i-<span class="number">1</span>][j], dp[i][j-<span class="number">1</span>]));</div><div class="line">                    max = Math.max(max, dp[i][j]); </div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">return</span> max*max;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;é¢˜ç›®&quot;&gt;&lt;a href=&quot;#é¢˜ç›®&quot; class=&quot;headerlink&quot; title=&quot;é¢˜ç›®&quot;&gt;&lt;/a&gt;é¢˜ç›®&lt;/h2&gt;&lt;h3 id=&quot;è‹±æ–‡&quot;&gt;&lt;a href=&quot;#è‹±æ–‡&quot; class=&quot;headerlink&quot; title=&quot;è‹±æ–‡&quot;&gt;&lt;/a&gt;è‹±æ–‡&lt;/h3&gt;&lt;p&gt;Giv
      
    
    </summary>
    
      <category term="ç®—æ³•" scheme="http://yoursite.com/categories/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="ç®—æ³•" scheme="http://yoursite.com/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>äºŒå‰æ ‘æœ€è¿‘å…¬å…±ç¥–å…ˆ</title>
    <link href="http://yoursite.com/2019/01/10/%E7%AE%97%E6%B3%95-%E4%BA%8C%E5%8F%89%E6%A0%91%E6%9C%80%E8%BF%91%E5%85%AC%E5%85%B1%E7%A5%96%E5%85%88/"/>
    <id>http://yoursite.com/2019/01/10/ç®—æ³•-äºŒå‰æ ‘æœ€è¿‘å…¬å…±ç¥–å…ˆ/</id>
    <published>2019-01-10T14:59:11.000Z</published>
    <updated>2019-01-15T02:27:26.525Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚</p><p>ç™¾åº¦ç™¾ç§‘ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªç»“ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªç»“ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆï¼‰ã€‚â€</p><p>ä¾‹å¦‚ï¼Œç»™å®šå¦‚ä¸‹äºŒå‰æ ‘:  root = [3,5,1,6,2,0,8,null,null,7,4]</p><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><h3 id="åŸæœ‰æ€è·¯"><a href="#åŸæœ‰æ€è·¯" class="headerlink" title="åŸæœ‰æ€è·¯"></a>åŸæœ‰æ€è·¯</h3><ul><li>æŸ¥è¯¢æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹æœ‰ä¸¤ä¸ªç›®æ ‡èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚</li><li>ç„¶åæŸ¥è¯¢å½“å‰èŠ‚ç‚¹çš„å·¦å³å­èŠ‚ç‚¹ï¼Œå¦‚æœæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹çš„å­èŠ‚ç‚¹åªåŒ…å«ä¸€ä¸ªç›®æ ‡èŠ‚ç‚¹ï¼Œåˆ™ä»–çš„çˆ¶èŠ‚ç‚¹åˆ™ä¸ºæœ€è¿‘å…¬å…±ç¥–å…ˆã€‚<h2 id="æ”¹è‰¯åæ€è·¯"><a href="#æ”¹è‰¯åæ€è·¯" class="headerlink" title="æ”¹è‰¯åæ€è·¯"></a>æ”¹è‰¯åæ€è·¯</h2></li><li>ä¸­åºéå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œå¦‚æœå½“å‰æ¥ç”µæ¥ç‚¹æˆ–è€…å…¶å­èŠ‚ç‚¹åŒ¹é…åˆ°äº†ç›®æ ‡èŠ‚ç‚¹ï¼Œåˆ™è¿”å›å½“å‰èŠ‚ç‚¹ã€‚</li><li>å¦‚æœå½“å‰èŠ‚ç‚¹çš„å·¦å³èŠ‚ç‚¹åˆ†åˆ«åŒ¹é…åˆ°äº†ä¸€ä¸ªç›®æ ‡èŠ‚ç‚¹ï¼ˆroot == null || p || q ç›´æ¥è¿”å›rootï¼‰ï¼Œåˆ™å½“å‰èŠ‚ç‚¹æ˜¯æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚<h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2></li></ul><p><code>åŸç‰ˆä»£ç </code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">leftFist</span><span class="params">(<span class="keyword">struct</span> TreeNode* root, <span class="keyword">struct</span> TreeNode* p, <span class="keyword">struct</span> TreeNode*  q)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">    <span class="keyword">if</span>(root-&gt;left) &#123;</div><div class="line">        ret =  ret + leftFist(root-&gt;left, p, q);</div><div class="line">    &#125; </div><div class="line">    </div><div class="line">    <span class="keyword">if</span>(root-&gt;right)&#123;</div><div class="line">        ret = ret+ leftFist(root-&gt;right, p, q);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(root == p) &#123;</div><div class="line">        ret +=<span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(root == q) &#123;</div><div class="line">        ret +=<span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * Definition for a binary tree node.</div><div class="line"> * struct TreeNode &#123;</div><div class="line"> *     int val;</div><div class="line"> *     struct TreeNode *left;</div><div class="line"> *     struct TreeNode *right;</div><div class="line"> * &#125;;</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">struct</span> TreeNode* <span class="title">lowestCommonAncestor</span><span class="params">(<span class="keyword">struct</span> TreeNode* root, <span class="keyword">struct</span> TreeNode* p, <span class="keyword">struct</span> TreeNode* q)</span> </span>&#123;</div><div class="line">    <span class="keyword">struct</span> TreeNode* retRoot = <span class="literal">NULL</span> ;</div><div class="line">    <span class="keyword">int</span> retSum =  leftFist(root, p, q);</div><div class="line">    </div><div class="line">    <span class="keyword">if</span>(retSum ==  <span class="number">2</span>) &#123;</div><div class="line">        <span class="keyword">int</span> retSumleft = <span class="literal">NULL</span>;</div><div class="line">        <span class="keyword">if</span>(root-&gt;left) &#123;</div><div class="line">            retSumleft = leftFist(root-&gt;left, p, q);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(<span class="number">0</span> &lt; retSumleft &amp;&amp;  retSumleft &lt; <span class="number">2</span>) &#123;</div><div class="line">            <span class="comment">// printf("retSumleft:%d,", root-&gt;left-&gt;val);</span></div><div class="line">            <span class="keyword">return</span> root;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">int</span> retSumright = <span class="literal">NULL</span>;</div><div class="line">        <span class="keyword">if</span>(root-&gt;right) &#123;</div><div class="line">            retSumright = leftFist(root-&gt;right, p, q);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(<span class="number">0</span> &lt; retSumright &amp;&amp; retSumright&lt; <span class="number">2</span>) &#123;</div><div class="line">            <span class="comment">// printf("retSumright:%d", root-&gt;right-&gt;val);</span></div><div class="line">            <span class="keyword">return</span> root;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(root-&gt;left) &#123;</div><div class="line">        retRoot =  lowestCommonAncestor(root-&gt;left, p, q);</div><div class="line">        <span class="keyword">if</span>(retRoot) &#123;</div><div class="line">            <span class="keyword">return</span> retRoot;</div><div class="line">        &#125;</div><div class="line">    &#125; </div><div class="line">    </div><div class="line">    <span class="keyword">if</span>(root-&gt;right)&#123;</div><div class="line">        retRoot =  lowestCommonAncestor(root-&gt;right, p, q);</div><div class="line">        <span class="keyword">if</span>(retRoot) &#123;</div><div class="line">            <span class="keyword">return</span> retRoot;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> retRoot;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>cè¯­è¨€è®©æˆ‘è·‘äº†1888msã€‚ã€‚</p><h3 id="ä¼˜åŒ–è§£"><a href="#ä¼˜åŒ–è§£" class="headerlink" title="ä¼˜åŒ–è§£"></a>ä¼˜åŒ–è§£</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Definition for a binary tree node.</div><div class="line"> * struct TreeNode &#123;</div><div class="line"> *     int val;</div><div class="line"> *     struct TreeNode *left;</div><div class="line"> *     struct TreeNode *right;</div><div class="line"> * &#125;;</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">struct</span> TreeNode* <span class="title">lowestCommonAncestor</span><span class="params">(<span class="keyword">struct</span> TreeNode* root, <span class="keyword">struct</span> TreeNode* p, <span class="keyword">struct</span> TreeNode* q)</span> </span>&#123;</div><div class="line">   <span class="keyword">if</span>(root == <span class="literal">NULL</span> || root == p || root == q) &#123;</div><div class="line">       <span class="keyword">return</span> root;</div><div class="line">   &#125;</div><div class="line">    <span class="keyword">struct</span> TreeNode* left = lowestCommonAncestor(root-&gt;left, p ,q);</div><div class="line">    <span class="keyword">struct</span> TreeNode* right = lowestCommonAncestor(root-&gt;right, p ,q);</div><div class="line">    </div><div class="line">    <span class="keyword">if</span>(left == <span class="literal">NULL</span> &amp;&amp; right == <span class="literal">NULL</span>) <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(left != <span class="literal">NULL</span> &amp;&amp; right != <span class="literal">NULL</span>) <span class="keyword">return</span> root;</div><div class="line">    <span class="keyword">return</span> (left == <span class="literal">NULL</span> ? right : left);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><code>12ms</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;é¢˜ç›®&quot;&gt;&lt;a href=&quot;#é¢˜ç›®&quot; class=&quot;headerlink&quot; title=&quot;é¢˜ç›®&quot;&gt;&lt;/a&gt;é¢˜ç›®&lt;/h2&gt;&lt;p&gt;ç»™å®šä¸€ä¸ªäºŒå‰æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚&lt;/p&gt;
&lt;p&gt;ç™¾åº¦ç™¾ç§‘ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªç»“ç‚¹ pã€q
      
    
    </summary>
    
    
      <category term="ç®—æ³•" scheme="http://yoursite.com/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>åˆå¹¶kä¸ªé“¾è¡¨</title>
    <link href="http://yoursite.com/2019/01/10/%E7%AE%97%E6%B3%95-%E5%90%88%E5%B9%B6k%E4%B8%AA%E9%93%BE%E8%A1%A8/"/>
    <id>http://yoursite.com/2019/01/10/ç®—æ³•-åˆå¹¶kä¸ªé“¾è¡¨/</id>
    <published>2019-01-10T08:09:18.000Z</published>
    <updated>2019-01-10T08:11:01.540Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>åˆå¹¶ k ä¸ªæ’åºé“¾è¡¨ï¼Œè¿”å›åˆå¹¶åçš„æ’åºé“¾è¡¨ã€‚è¯·åˆ†æå’Œæè¿°ç®—æ³•çš„å¤æ‚åº¦ã€‚</p><p>ç¤ºä¾‹:</p><p>è¾“å…¥:<br>[<br>  1-&gt;4-&gt;5,<br>  1-&gt;3-&gt;4,<br>  2-&gt;6<br>]<br>è¾“å‡º: 1-&gt;1-&gt;2-&gt;3-&gt;4-&gt;4-&gt;5-&gt;6</p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><ul><li>å¦‚æœç†ç”±<code>æœ€åé€‰æ‹©</code>è¿›è¡Œåˆå¹¶é“¾è¡¨ï¼Œè¿™æ˜¯æ—¶é—´å¤æ‚åº¦æ˜¯<code>kn</code>å¦‚æœ <code>k</code> å¾ˆå¤§çš„æ—¶å€™æ—¶é—´å¤æ‚åº¦ç®€ç›´çˆ†ç‚¸ï¼Œè¿˜ä¸å¦‚ç›´æ¥åˆå¹¶ã€‚</li><li>å¦‚æœä½¿ç”¨å½’å¹¶æ’åº æ—¶é—´å¤æ‚åº¦æ˜¯<code>nlogk</code>ã€‚</li><li>å¦‚æœç›´æ¥ä¸¤ä¸¤æš´åŠ›åˆå¹¶ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯<code>n(k^2+k)/2</code></li><li>æ‰€ä»¥å½“kå¾ˆå¤§çš„æ—¶å€™ï¼Œæœ€ä¼˜è§£åº”è¯¥æ˜¯å¹¶å½’ã€‚<h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">struct</span> ListNode* <span class="title">merge</span><span class="params">(<span class="keyword">struct</span> ListNode* l1, <span class="keyword">struct</span> ListNode* l2)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">struct</span> ListNode* l3 = <span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">struct</span> ListNode* p = <span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">struct</span> ListNode* tmp = <span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(!l1 &amp;&amp; !l2) &#123;</div><div class="line">        <span class="keyword">return</span> l3;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(l1 &amp;&amp; !l2) &#123;</div><div class="line">        <span class="keyword">return</span> l1;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(!l1 &amp;&amp; l2)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> l2;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//è®¾ç½®å¤´ç»“ç‚¹</span></div><div class="line">    <span class="keyword">if</span>(l1-&gt;val &lt; l2-&gt;val) &#123;</div><div class="line">        l3 = l1;</div><div class="line">        l1 = l1-&gt;next;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        l3 = l2;</div><div class="line">        l2 = l2-&gt;next;</div><div class="line">    &#125;    </div><div class="line">    p = l3;</div><div class="line">    <span class="keyword">while</span>(l1 &amp;&amp; l2)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>(l1-&gt;val &lt; l2-&gt;val)</div><div class="line">        &#123;</div><div class="line">            tmp = l1-&gt;next;</div><div class="line">            p-&gt;next = l1;</div><div class="line">            l1 = tmp;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            tmp = l2-&gt;next;</div><div class="line">            p-&gt;next = l2;</div><div class="line">            l2 = tmp;</div><div class="line">        &#125;</div><div class="line">        p = p-&gt;next;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span>(l1) &#123;</div><div class="line">        p-&gt;next = l1;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(l2)</div><div class="line">    &#123;</div><div class="line">        p-&gt;next = l2;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// struct ListNode* tmp3= l3;</span></div><div class="line">    <span class="comment">// while(tmp3)</span></div><div class="line">    <span class="comment">// &#123;</span></div><div class="line">    <span class="comment">//     printf("%d,", tmp3-&gt;val);</span></div><div class="line">    <span class="comment">//     tmp3 = tmp3-&gt;next;</span></div><div class="line">    <span class="comment">// &#125;</span></div><div class="line">    <span class="comment">// printf("\n");</span></div><div class="line">    <span class="keyword">return</span> l3;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Definition for singly-linked list.</div><div class="line"> * struct ListNode &#123;</div><div class="line"> *     int val;</div><div class="line"> *     struct ListNode *next;</div><div class="line"> * &#125;;</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">struct</span> ListNode* <span class="title">mergeKLists</span><span class="params">(<span class="keyword">struct</span> ListNode** lists, <span class="keyword">int</span> listsSize)</span> </span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span>(listsSize == <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(listsSize == <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">return</span> (*lists);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">struct</span> ListNode* ret = (*lists);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; listsSize; i++)</div><div class="line">    &#123;</div><div class="line">        lists++;</div><div class="line">        ret = merge((*lists), ret);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ret;   </div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>å°è¯•å¯»æ‰¾æ›´ä¼˜è§£æ³•ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;é¢˜ç›®&quot;&gt;&lt;a href=&quot;#é¢˜ç›®&quot; class=&quot;headerlink&quot; title=&quot;é¢˜ç›®&quot;&gt;&lt;/a&gt;é¢˜ç›®&lt;/h2&gt;&lt;p&gt;åˆå¹¶ k ä¸ªæ’åºé“¾è¡¨ï¼Œè¿”å›åˆå¹¶åçš„æ’åºé“¾è¡¨ã€‚è¯·åˆ†æå’Œæè¿°ç®—æ³•çš„å¤æ‚åº¦ã€‚&lt;/p&gt;
&lt;p&gt;ç¤ºä¾‹:&lt;/p&gt;
&lt;p&gt;è¾“å…¥:&lt;br&gt;[&lt;br&gt;  1-
      
    
    </summary>
    
      <category term="ç®—æ³•" scheme="http://yoursite.com/categories/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="ç®—æ³•" scheme="http://yoursite.com/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>tcpä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹</title>
    <link href="http://yoursite.com/2019/01/09/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E4%B8%8E%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/"/>
    <id>http://yoursite.com/2019/01/09/tcpä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹/</id>
    <published>2019-01-09T14:16:19.000Z</published>
    <updated>2019-01-09T14:17:44.197Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸‰æ¬¡æ¡æ‰‹"><a href="#ä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="ä¸‰æ¬¡æ¡æ‰‹"></a>ä¸‰æ¬¡æ¡æ‰‹</h2><p><code>ä¸‰æ¬¡æ¡æ‰‹</code> æ˜¯æŒ‡tcpå»ºç«‹è¿æ¥æ—¶å€™éœ€è¦æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å‘é€ä¸‰ä¸ªç½‘ç»œåŒ…ã€‚<br>ä¸‰æ¬¡æ¡æ‰‹çš„ç›®çš„æ˜¯é“¾æ¥ä¸æœåŠ¡å™¨ç«¯å£ï¼Œå¹¶å»ºç«‹tcpè¿æ¥ï¼Œå¹¶åŒæ­¥è¿æ¥åŒæ–¹çš„åºåˆ—å·å’Œç¡®è®¤å·ï¼Œå¹¶äº¤æ¢tcpçª—å£å¤§å°ä¿¡æ¯ã€‚</p><p><img src="/photo/img/tcpä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹/tcpæ¡æ‰‹.png" alt="image"><br>åœ¨tcp/ipåè®®ä¸­, tcpæä¾›å¯é çš„é“¾æ¥æœåŠ¡ï¼Œé‡‡ç”¨ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹ä¸€ä¸ªé“¾æ¥ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚</p><ul><li>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šå»ºç«‹è¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯å‘é€SYNåŒ…åˆ°æœåŠ¡å™¨ï¼ŒåŒæ—¶è¿›å…¥SYN_SENDçŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨Bç¡®è®¤ã€‚</li><li>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šæœåŠ¡å™¨Bæ”¶åˆ°SYNåŒ…ï¼Œç¡®è®¤å®¢æˆ·ç«¯çš„SYN(ACK+1),åŒæ—¶è‡ªå·±å‘é€ä¸€ä¸ªSYNåŒ…ï¼Œæ­¤æ—¶æœåŠ¡å™¨è¿›å…¥SYN_RECVçŠ¶æ€ã€‚</li><li>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼š å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„SYN+ACKåŒ…ï¼Œå‘æœåŠ¡å™¨å‘é€ç¡®è®¤åŒ…ï¼ˆACK+1ï¼‰,æ­¤åŒ…å‘é€å®Œæ¯•ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¿›å…¥RESTABLISHEDçŠ¶æ€ï¼Œå®Œæˆä¸‰æ¬¡æ¡æ‰‹ã€‚<h2 id="å››æ¬¡æŒ¥æ‰‹"><a href="#å››æ¬¡æŒ¥æ‰‹" class="headerlink" title="å››æ¬¡æŒ¥æ‰‹"></a>å››æ¬¡æŒ¥æ‰‹</h2>tcpæ–­å¼€è¿æ¥éœ€è¦å‘é€å››ä¸ªåŒ…ï¼Œæ‰€ä»¥ç§°ä¹‹ä¸º <code>å››æ¬¡æŒ¥æ‰‹</code>,å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å¯ä»¥å‘èµ·<code>æŒ¥æ‰‹</code>ã€‚</li></ul><p><img src="/photo/img/tcpä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹/tcpå››æ¬¡æŒ¥æ‰‹.png" alt="image"></p><p>ç”±äºTCPæ˜¯å…¨åŒå·¥çš„ï¼Œæ‰€ä»¥éœ€è¦åŒå‘å…³é—­ã€‚åŸåˆ™æ˜¯å½“ä¸€æ–¹å®Œæˆæ•°æ®å‘é€åå°±åªèƒ½å‘é€ä¸€ä¸ªFINæ¥ç»ˆæ­¢è¿™ä¸ªæ–¹å‘çš„é“¾æ¥ã€‚æ”¶åˆ°ä¸€ä¸ªFINåªæ„å‘³ç€è¿™ä¸ªä¸€ä¸ªæ–¹å‘æ²¡æœ‰æ•°æ®å‘é€ï¼Œä¸€ä¸ªtcpé“¾æ¥æ”¶åˆ°ä¸€ä¸ªFINåä»ç„¶èƒ½å‘é€æ•°æ®ã€‚é¦–å…ˆå…³é—­çš„ä»¥é˜²è¿›è¡Œä¸»åŠ¨å…³é—­ï¼Œå¦å¤–ä»¥é˜²æ‰§è¡Œè¢«åŠ¨å…³é—­ã€‚</p><ul><li>ä¸»åŠ¨æ–¹å‘é€ä¸€ä¸ªFIN,ç”¨æ¥å‘Šè¯‰è¢«åŠ¨æ–¹æˆ‘å‘é€å®Œæ¯•ï¼Œè¯·æ±‚å…³é—­é“¾æ¥ã€‚</li><li>è¢«åŠ¨æ–¹æ”¶åˆ°ä¸»åŠ¨æ–¹çš„FINè¯·æ±‚ï¼Œä¼šå›å‘ä¸€ä¸ªACK(æˆ‘çŸ¥é“äº†)ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ç»Ÿä¸€å…³é—­é“¾æ¥ã€‚</li><li>å½“è¢«åŠ¨æ–¹ä¹Ÿå‘é€å®Œæ•°æ®äº†ï¼Œä¼šå‘é€ä¸€ä¸ªFINåŒ…ï¼Œé«˜é€Ÿä¸»åŠ¨æ–¹æˆ‘ä¹Ÿå‘é€å®Œäº†ã€‚</li><li>ä¸»åŠ¨æ–¹æ”¶åˆ°è¢«åŠ¨æ–¹çš„FINåŒ…ï¼Œå›å¤ACK(ç¡®è®¤æ”¶åˆ°)ï¼Œæ­¤æ—¶tcpæ–­å¼€è¿æ¥ã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ä¸‰æ¬¡æ¡æ‰‹&quot;&gt;&lt;a href=&quot;#ä¸‰æ¬¡æ¡æ‰‹&quot; class=&quot;headerlink&quot; title=&quot;ä¸‰æ¬¡æ¡æ‰‹&quot;&gt;&lt;/a&gt;ä¸‰æ¬¡æ¡æ‰‹&lt;/h2&gt;&lt;p&gt;&lt;code&gt;ä¸‰æ¬¡æ¡æ‰‹&lt;/code&gt; æ˜¯æŒ‡tcpå»ºç«‹è¿æ¥æ—¶å€™éœ€è¦æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å‘é€ä¸‰ä¸ªç½‘ç»œåŒ…ã€‚&lt;br&gt;ä¸‰æ¬¡æ¡æ‰‹çš„ç›®çš„æ˜¯é“¾æ¥ä¸æœ
      
    
    </summary>
    
      <category term="ç½‘ç»œ" scheme="http://yoursite.com/categories/%E7%BD%91%E7%BB%9C/"/>
    
    
      <category term="ç½‘ç»œ" scheme="http://yoursite.com/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•-é“¾è¡¨ç›¸äº¤(ntersection of Two Linked Lists)</title>
    <link href="http://yoursite.com/2019/01/08/%E7%AE%97%E6%B3%95-%E9%93%BE%E8%A1%A8%E7%9B%B8%E4%BA%A4/"/>
    <id>http://yoursite.com/2019/01/08/ç®—æ³•-é“¾è¡¨ç›¸äº¤/</id>
    <published>2019-01-08T09:11:56.000Z</published>
    <updated>2019-01-08T11:34:02.619Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œæ‰¾åˆ°ä¸¤ä¸ªå•é“¾è¡¨ç›¸äº¤çš„èµ·å§‹èŠ‚ç‚¹<br>æ³¨æ„ï¼š</p><ul><li>å¦‚æœä¸¤ä¸ªé“¾è¡¨æ²¡æœ‰äº¤ç‚¹ï¼Œè¿”å› null.</li><li>åœ¨è¿”å›ç»“æœåï¼Œä¸¤ä¸ªé“¾è¡¨ä»é¡»ä¿æŒåŸæœ‰çš„ç»“æ„ã€‚</li><li>å¯å‡å®šæ•´ä¸ªé“¾è¡¨ç»“æ„ä¸­æ²¡æœ‰å¾ªç¯ã€‚</li><li>ç¨‹åºå°½é‡æ»¡è¶³ O(n) æ—¶é—´å¤æ‚åº¦ï¼Œä¸”ä»…ç”¨ O(1) å†…å­˜ã€‚</li></ul><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>æ¶è®¾å­˜åœ¨ä¸¤ä¸ªé“¾è¡¨ <code>headA</code> <code>headB</code>ã€‚å®šä¹‰ä¸¤ä¸ªæŒ‡é’ˆ <code>a</code> <code>b</code>åˆ†åˆ«å¯¹åº”<code>headA</code> <code>headB</code>, å¾ªç¯<code>a</code> <code>b</code> ç›´è‡³åˆ°è¾¾é“¾è¡¨çš„å°¾éƒ¨ï¼Œç„¶åå°†<code>a</code>æŒ‡å‘<code>headB</code>ã€å°†<code>b</code>æŒ‡å‘<code>headA</code> ,ç»§ç»­å¾ªç¯ç›´è‡³å‡ºç°<code>a==b</code>çš„æƒ…å†µï¼Œæˆ–è€…ä»»æ„ä¸€ä¸ªé“¾è¡¨åˆ°è¾¾ç»ˆç‚¹ã€‚</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Definition for singly-linked list.</div><div class="line"> * struct ListNode &#123;</div><div class="line"> *     int val;</div><div class="line"> *     struct ListNode *next;</div><div class="line"> * &#125;;</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">struct</span> ListNode *<span class="title">getIntersectionNode</span><span class="params">(<span class="keyword">struct</span> ListNode *headA, <span class="keyword">struct</span> ListNode *headB)</span> </span>&#123;</div><div class="line">    <span class="keyword">struct</span> ListNode *a = headA;</div><div class="line">    <span class="keyword">struct</span> ListNode *b = headB;</div><div class="line">    <span class="keyword">int</span> aDone =<span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> bDone =<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>(a == b) &#123;</div><div class="line">            <span class="keyword">return</span> a;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(a &amp;&amp; a-&gt;next) &#123;</div><div class="line">            a =  a-&gt;next;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">if</span>(aDone != <span class="number">1</span>) &#123;</div><div class="line">               a = headB;</div><div class="line">               aDone = <span class="number">1</span>; </div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">        &#125; </div><div class="line">        </div><div class="line">        <span class="keyword">if</span>(b &amp;&amp; b-&gt;next )</div><div class="line">        &#123;</div><div class="line">            b = b-&gt;next;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">if</span>(bDone != <span class="number">1</span>) &#123;</div><div class="line">                b = headA;</div><div class="line">                bDone =<span class="number">1</span>;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">        &#125;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">    </div><div class="line">   </div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;é¢˜ç›®&quot;&gt;&lt;a href=&quot;#é¢˜ç›®&quot; class=&quot;headerlink&quot; title=&quot;é¢˜ç›®&quot;&gt;&lt;/a&gt;é¢˜ç›®&lt;/h2&gt;&lt;p&gt;ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œæ‰¾åˆ°ä¸¤ä¸ªå•é“¾è¡¨ç›¸äº¤çš„èµ·å§‹èŠ‚ç‚¹&lt;br&gt;æ³¨æ„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœä¸¤ä¸ªé“¾è¡¨æ²¡æœ‰äº¤ç‚¹ï¼Œè¿”å› null.&lt;/li&gt;
&lt;li
      
    
    </summary>
    
      <category term="ç®—æ³•" scheme="http://yoursite.com/categories/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="ç®—æ³•" scheme="http://yoursite.com/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®åº“éš”ç¦»çº§åˆ«</title>
    <link href="http://yoursite.com/2018/12/23/%E6%95%B0%E6%8D%AE%E5%BA%93%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/"/>
    <id>http://yoursite.com/2018/12/23/æ•°æ®åº“éš”ç¦»çº§åˆ«/</id>
    <published>2018-12-23T12:34:25.000Z</published>
    <updated>2019-01-08T10:59:07.515Z</updated>
    
    <content type="html"><![CDATA[<p>SQLæ ‡å‡†è§„èŒƒä¸­å®šä¹‰äº†å››ç§æ•°æ®åº“éš”ç¦»çº§åˆ«ã€‚æ¯ç§éš”ç¦»çº§åˆ«å¸¦æ¥çš„ç³»ç»Ÿå¼€é”€æ˜¯ä¸ä¸€æ ·çš„ã€‚é€šå¸¸è¾ƒä½çš„éš”ç¦»çº§åˆ«çš„ç³»ç»Ÿå¼€é”€ä¼šæ›´ä½ï¼Œå¯ä»¥æ‰§è¡Œæ›´é«˜çš„å¹¶å‘ã€‚</p><h2 id="READ-COMMITTED-æœªæäº¤è¯»"><a href="#READ-COMMITTED-æœªæäº¤è¯»" class="headerlink" title="READ COMMITTED(æœªæäº¤è¯»)"></a>READ COMMITTED(æœªæäº¤è¯»)</h2><p>é¡¾åæ€ä¹‰ï¼Œæœªæäº¤è¯»éš”ç¦»çº§åˆ«ä¸­ï¼Œäº‹ç‰©çš„ä¿®æ”¹å³ä½¿æ²¡æœ‰æäº¤ï¼Œå¯¹å…¶ä»–äº‹åŠ¡ä¹Ÿæ˜¯å¯è§çš„ã€‚äº‹åŠ¡å¯ä»¥è¯»å–ä¸ºæœªæäº¤çš„æ•°æ®ï¼Œä¹Ÿæˆä¸º<code>è„è¯»</code>ã€‚READ COMMITED æ€§èƒ½ä¸Šä¸ä¼šæœ‰è·Ÿå¾ˆå¤§çš„ä¼˜åŠ¿ï¼Œä½†æ˜¯å´ä¼šå¯¼è‡´å¾ˆå¤šçš„é—®é¢˜ï¼Œåœ¨å®é™…åº”ç”¨ä¸­å¾ˆå°‘ä½¿ç”¨ã€‚</p><p>eg:<br>ä¸šåŠ¡åœºæ™¯æ”¯ä»˜æ‰£æ¬¾ã€‚å½“ç”¨æˆ·ç»Ÿä¸€æ—¶åˆ»å‘ç”Ÿä¸€ç¬”å……å€¼500ï¼Œå’Œä¸€ç¬”æ‰£æ¬¾200ä¸šåŠ¡æ—¶ã€‚ æ‰£æ¬¾è¯»åˆ°æ˜¯æœªæ‰§è¡Œçš„å……å€¼äº‹åŠ¡é‡‘é¢ï¼Œè´¦æˆ·ä½™é¢500å…ƒï¼Œä½†æ˜¯å……å€¼äº‹åŠ¡å›æ»šäº†ï¼Œè¿™ç§æƒ…å†µä¸‹æ•°æ®å‡ºç°é—®é¢˜ï¼Œæ‰€ä»¥æœªæäº¤è¯»æ˜¯ä¸€ç§ä¸å¯é çš„äº‹åŠ¡ã€‚</p><h2 id="READ-COMMITED-æäº¤è¯»"><a href="#READ-COMMITED-æäº¤è¯»" class="headerlink" title="READ COMMITED(æäº¤è¯»)"></a>READ COMMITED(æäº¤è¯»)</h2><p>å¤šæ•°æ•°æ®åº“çš„éš”ç¦»çº§æ˜¯æäº¤è¯»(æ¯”å¦‚Sql Server , Oracle)ï¼Œä½†æ˜¯mysqlä¸æ˜¯ã€‚<br>æäº¤è¯»çš„å«ä¹‰æ˜¯ï¼šä¸€ä¸ªäº‹åŠ¡åªèƒ½çœ‹åˆ°å·²ç»æäº¤çš„äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹ã€‚ä¹Ÿå°±æ˜¯è¯´äº‹åŠ¡å’Œäº‹åŠ¡ä¹‹å‰åœ¨æäº¤å‰æ˜¯ç›¸äº’ä¸å¯è§çš„ã€‚è¿™ä¸ªçº§åˆ«åˆç§°ä¸ºä¸å¯é‡å¤è¯»ï¼Œå› ä¸ºæ¯æ¬¡è¯»å–çš„ç»“æœå¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><p>eg:<br>å½“æˆ‘ä»¬æ‹¿ç€é“¶è¡Œå¡å»æ¶ˆè´¹æ—¶å€™ï¼ŒæŸ¥è¯¢åˆ°å¡é‡Œè¿˜æœ‰2000å…ƒï¼Œè¿™æ—¶å‡†å¤‡æ¶ˆè´¹ã€‚ä¸æ­¤åŒæ—¶è¿™å¼ å¡çš„é’±è¢«è€å©†è½¬è´¦äº†ï¼ˆå·²ç»è½¬å‡ºå»2000å…ƒï¼‰ï¼Œå½“æˆ‘ä»¬åœ¨æ‰£æ¬¾ä½ çš„æ—¶å€™ä¼šæç¤ºä½™é¢ä¸è¶³ã€‚<br>æäº¤è¯»é¿å…äº†<code>è„è¯»</code>ï¼Œä½†æ˜¯å´äº§ç”Ÿäº†<code>ä¸å¯é‡å¤è¯»</code>ï¼ˆåŒä¸€äº‹åŠ¡å†…ï¼‰ã€‚</p><h2 id="Repeatable-read-ï¼ˆé‡å¤è¯»ï¼‰"><a href="#Repeatable-read-ï¼ˆé‡å¤è¯»ï¼‰" class="headerlink" title="Repeatable read ï¼ˆé‡å¤è¯»ï¼‰"></a>Repeatable read ï¼ˆé‡å¤è¯»ï¼‰</h2><p>é‡å¤è¯»ï¼Œä¿è¯äº†åœ¨åŒä¸€ä¸ªäº‹åŠ¡å†…è¯»å–åŒä¸€æ¡æ•°æ®æ˜¯ä¸å˜çš„ï¼Œä½†æ˜¯å´æ— æ³•ä¿è¯æˆ‘ä»¬è¯»å–ï¼ˆåŒä¸€äº‹åŠ¡å†…ï¼‰åŒä¸€è¡¨é‡Œçš„æ•°æ®é‡æ˜¯ä¸€è‡´çš„ã€‚ä½†æ˜¯å´ä¼šäº§ç”Ÿå¹»è¯»ï¼ˆå¹»è¡Œï¼‰ã€‚</p><p>ä¾‹å¦‚æ¶ˆè´¹è®°å½•è¡¨ï¼Œæˆ‘ä»¬åœ¨æ‰“å°ä¿¡ç”¨å¡çš„æ¶ˆè´¹è®°å½•æ—¶æŸ¥è¯¢å‡ºæ¥åªæœ‰ä¸€æ¡æ¶ˆè´¹è®°å½•80ï¼ˆè¿™æ˜¯å¦å¤–ä¸€ä¸ªäº‹åŠ¡æ— æ³•æ”¹å˜çš„ï¼‰ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬æ‰“å°çš„æ—¶å€™ï¼Œè€å©†åˆæ¶ˆè´¹äº†1000å…ƒï¼ˆå¦å¤–ä¸€ä¸ªäº‹åŠ¡ï¼Œä½†æ˜¯æ²¡æœ‰å¯¹åŸæ¥çš„80å…ƒè¿›è¡Œä¿®æ”¹ï¼‰ï¼Œæˆ‘ä»¬æ‰“å°å‡ºæ¥çš„ç»“æœæ˜¯ä¸¤æ¡è®°å½• 80 +1000ï¼Œè¿™å°±æ˜¯å¹»è¡Œã€‚</p><h2 id="Serializable-ï¼ˆåºåˆ—åŒ–ï¼‰"><a href="#Serializable-ï¼ˆåºåˆ—åŒ–ï¼‰" class="headerlink" title="Serializable ï¼ˆåºåˆ—åŒ–ï¼‰"></a>Serializable ï¼ˆåºåˆ—åŒ–ï¼‰</h2><p>Serializable é€šè¿‡å¼ºåˆ¶äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œé¿å…äº†æ¬¢è¯»ã€‚ä½†æ˜¯Serializableåœ¨æ‰§è¡Œçš„æ—¶å€™ä¼šå¯¹æ¯ä¸€æ ·çš„æ•°æ®éƒ½åŠ ä¸Šé”ï¼Œä¼šå¯¼è‡´å¤§é‡çš„è¶…æ—¶å’Œé”ç«äº‰ã€‚åªæœ‰åœ¨æ•°æ®ä¸€è‡´æ€§éå¸¸é‡è¦ï¼Œä¸”å¹¶å‘ä¸æ˜¯å¾ˆå¤§æƒ…å†µé€‰ï¼Œå¯ä»¥é€‰ç”¨è¿™ç§éš”ç¦»çº§åˆ«ã€‚</p><h2 id="å‡ ä¸ªåè¯"><a href="#å‡ ä¸ªåè¯" class="headerlink" title="å‡ ä¸ªåè¯"></a>å‡ ä¸ªåè¯</h2><h3 id="è„è¯»"><a href="#è„è¯»" class="headerlink" title="è„è¯»"></a>è„è¯»</h3><p>æŒ‡çš„æ˜¯åœ¨Aäº‹åŠ¡å†…ï¼Œå¤šæ¬¡è¯»å–åŒä¸€ä¸€ä¸ªæ•°æ®ã€‚ä¸æ­¤åŒæ—¶è¿˜æœ‰å¦å¤–ä¸€ä¸ªBäº‹åŠ¡å¯¹åŒä¸€æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ï¼Œä½†æ˜¯æœªæäº¤ã€‚è¿™æ—¶å°±ä¼šäº§ç”Ÿäº‹åŠ¡Aä¸¤æ¬¡è¯»å–çš„æ•°æ®ä¸ä¸€è‡´ï¼Œä¸€ä¸ªæ˜¯äº‹åŠ¡Bæœªæ‰§è¡Œå‰çš„æ•°æ®ï¼Œä¸€ä¸ªæ˜¯è¯»å–äº‹åŠ¡Bæœªæäº¤çš„æ•°æ®ã€‚</p><h3 id="ä¸å¯é‡å¤è¯»ã€‚"><a href="#ä¸å¯é‡å¤è¯»ã€‚" class="headerlink" title="ä¸å¯é‡å¤è¯»ã€‚"></a>ä¸å¯é‡å¤è¯»ã€‚</h3><p>æŒ‡çš„æ˜¯åŒä¸€äº‹åŠ¡å†…ï¼Œæ— æ³•å¯¹åŒä¸€ä¸ªæ•°æ®å¤šæ¬¡è¯»å–ï¼Œå› ä¸ºä¸¤æ¬¡è¯»å–å¯èƒ½æ˜¯ä¸ä¸€è‡´çš„ï¼ˆå› ä¸ºæ²¡æœ‰å¯¹ æ•°æ®å†™ åŠ é”ï¼‰ã€‚</p><h3 id="å¹»è¯»"><a href="#å¹»è¯»" class="headerlink" title="å¹»è¯»"></a>å¹»è¯»</h3><p>å¹»è¯»æ˜¯åœ¨<code>å¯é‡å¤è¯»</code>çš„éš”ç¦»çº§åˆ«ä¸‹äº§ç”Ÿçš„é—®é¢˜ã€‚<code>å¯é‡å¤è¯»</code>è™½ç„¶å¯¹æ•°æ®åŠ å†™é”ï¼Œä½†æ˜¯å´æ²¡å¯¹è¡¨åŠ é”ï¼Œé€ æˆæ¯æ¬¡è¯»å–è¡¨çš„æ•°æ®é‡æ˜¯ä¸ä¸€è‡´çš„ï¼Œæ‰€ä»¥åˆç§°<code>å¹»è¡Œ</code>ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;SQLæ ‡å‡†è§„èŒƒä¸­å®šä¹‰äº†å››ç§æ•°æ®åº“éš”ç¦»çº§åˆ«ã€‚æ¯ç§éš”ç¦»çº§åˆ«å¸¦æ¥çš„ç³»ç»Ÿå¼€é”€æ˜¯ä¸ä¸€æ ·çš„ã€‚é€šå¸¸è¾ƒä½çš„éš”ç¦»çº§åˆ«çš„ç³»ç»Ÿå¼€é”€ä¼šæ›´ä½ï¼Œå¯ä»¥æ‰§è¡Œæ›´é«˜çš„å¹¶å‘ã€‚&lt;/p&gt;
&lt;h2 id=&quot;READ-COMMITTED-æœªæäº¤è¯»&quot;&gt;&lt;a href=&quot;#READ-COMMITTED-æœªæäº¤è¯»&quot; clas
      
    
    </summary>
    
      <category term="æ•°æ®åº“" scheme="http://yoursite.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
      <category term="æ•°æ®åº“" scheme="http://yoursite.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>kong</title>
    <link href="http://yoursite.com/2018/12/02/kong/"/>
    <id>http://yoursite.com/2018/12/02/kong/</id>
    <published>2018-12-02T11:02:17.000Z</published>
    <updated>2019-01-08T10:54:35.667Z</updated>
    
    <content type="html"><![CDATA[<p>å½“å‰ç³»ç»Ÿï¼Œç¯å¢ƒcentos7<br>èµ·kongæœåŠ¡éœ€è¦åšï¼š</p><ul><li>å®‰è£…<ul><li>kong</li><li>pgsql</li><li>dashboard(å¯é€‰ï¼Œç”¨æ¥é€šè¿‡apiæ¥ç®¡ç†ç©º)</li></ul></li><li>é…ç½®<ul><li>kong.confï¼ˆé…ç½®æ•°æ®åº“ç­‰ï¼‰ã€é…ç½®è·¯ç”±ã€‚</li><li>pgsqlé…ç½®ï¼ˆæ–°å»ºæ•°æ®åº“ï¼‰</li><li>é…ç½®kongè·¯ç”±</li></ul></li><li>æ³¨æ„äº‹é¡¹<ul><li>å°½é‡å®‰è£…é«˜ç‰ˆæœ¬ï¼Œé˜²æ­¢å’Œpgsqlä¸å…¼å®¹ã€‚</li></ul></li></ul><h1 id="1-å®‰è£…kong"><a href="#1-å®‰è£…kong" class="headerlink" title="1.å®‰è£…kong"></a>1.å®‰è£…kong</h1><ul><li>éœ€è¦å®‰è£…kong</li><li>å®‰è£…pgsql</li></ul><p>å®˜æ–¹æ–‡æ¡£æä¾›çš„å¿«é€Ÿå®‰è£…åœ°å€<code>https://docs.konghq.com/install/centos/?_ga=2.182378343.1594956911.1543481061-735966922.1539239867</code></p><p>step1:<br><code>baseurl=https://kong.bintray.com/kong-community-edition-rpm/centos/7</code> å„ä¸ªç‰ˆæœ¬çš„åœ°å€ï¼Œä¸‹è½½è¦å®‰è£…çš„ç‰ˆæœ¬ã€‚<br>wget <code>https://kong.bintray.com/kong-community-edition-rpm/centos/7/kong-community-edition-0.14.1.el7.noarch.rpm</code><br>srep2:<br>æ‰§è¡Œä¸‹è¾¹å‘½ä»¤:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo yum install epel-release</div><div class="line">sudo yum install kong-community-edition-0.14.1.*.noarch.rpm --nogpgcheck</div></pre></td></tr></table></figure></p><p>å®‰è£…å®Œæˆï¼Œè¿™ä¸ªæ—¶å€™æ˜¯èµ·ä¸æ¥é¢ï¼Œå› ä¸ºæ²¡æœ‰å®‰è£…pgsqlã€‚</p><h1 id="2-å®‰è£…postgresql10"><a href="#2-å®‰è£…postgresql10" class="headerlink" title="2.å®‰è£…postgresql10"></a>2.å®‰è£…postgresql10</h1><p>å°½é‡å®‰è£…é«˜ç‰ˆæœ¬ï¼Œé˜²æ­¢å’Œpgsqlä¸å…¼å®¹,ä¸ºäº†é¿å…é‡‡å‘ï¼Œé€‰æ‹©<code>kong-community-edition-0.14.1.el7.noarch.rpm</code>ç‰ˆæœ¬ï¼Œå½“ç„¶ä¹Ÿåœ¨æµ‹è¯•æœºæµ‹è¯•æ²¡æœ‰é—®é¢˜ã€‚<br>å®˜æ–¹åœ°å€<code>https://www.postgresql.org/download/linux/redhat/</code> å¯ä»¥é€‰æ‹©å¯¹éœ€å®‰è£…çš„å¯¹åº”çš„ç‰ˆæœ¬ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆå®‰è£…å‘½ä»¤ï¼Œæˆ‘é€‰æ‹©çš„æ˜¯10.6</p><p>postgresql10å®‰è£…ä¸å¯åŠ¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">yum install https://download.postgresql.org/pub/repos/yum/10/redhat/rhel-7-x86_64/pgdg-centos10-10-2.noarch.rpm    </div><div class="line">yum install postgresql10    </div><div class="line">yum install postgresql10-server</div><div class="line">/usr/pgsql-10/bin/postgresql-10-setup initdb  </div><div class="line">systemctl enable postgresql-10  </div><div class="line">systemctl start postgresql-10</div></pre></td></tr></table></figure></p><p>å®‰è£…å®Œæˆåï¼Œè¿˜éœ€è¦åšï¼š</p><ol><li>é…ç½®postgrepsç”¨æˆ·ã€‚</li><li>æ–°å¢å’Œæ•°æ®åº“ã€‚</li><li>é…ç½®è¿œç¨‹è¿æ¥ã€‚</li></ol><p>æ·»åŠ ç”¨æˆ·ä»¥åŠæ–°å¢æ•°æ®ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">sudo -s  //å–å¾—rootæƒé™</div><div class="line">su - postgres </div><div class="line">psql -U postgres //è¿æ¥æœ¬åœ°æ•°æ®</div><div class="line"></div><div class="line">postgres=# CREATE USER kong WITH LOGIN PASSWORD &apos;kong&apos;;  //åˆ›å»ºç”¨æˆ·</div><div class="line">postgres-# CREATE ROLE //è¿”å›CREATE ROLEï¼Œè¡¨ç¤ºåˆ›å»ºç”¨æˆ·æˆåŠŸ</div><div class="line"></div><div class="line">postgres=# CREATE DATABASE kong; //åˆ›å»ºæ•°æ®åº“</div><div class="line">CREATE DATABASE //è¿”å›CREATE DATABASEï¼Œè¡¨ç¤ºåˆ›å»ºæ•°æ®åº“æˆåŠŸ.</div></pre></td></tr></table></figure></p><p>ç„¶ååˆå§‹åŒ–æ•°æ®åº“:<code>sudo /usr/local/bin/kong migrations up</code></p><p>ä¿®æ”¹pgsql,é…ç½®è¿œç¨‹è¿æ¥ï¼š<br>æ‰§è¡Œ<code>vim /var/lib/pgsql/10/data/pg_hba.conf</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//ä¿®æ”¹ 127.0.0.1/32 ä¸ºtrust</div><div class="line">host    all             all             127.0.0.1/32            trust</div><div class="line">//æ·»åŠ ä¸‹è¾¹è¿™æ¡è®°å½•ï¼Œç”¨äºsslè¿æ¥</div><div class="line">host    all             all             0.0.0.0/0               md5</div></pre></td></tr></table></figure></p><p><img src="/photo/img/kong/pg_hba.conf.png" alt="image"></p><p>æ‰§è¡Œ<code>vim /var/lib/pgsql/10/data/postgresql.conf</code><br>æ·»åŠ ä¸€ä¸‹ä¿¡æ¯:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">listen_addresses = &apos;*&apos; //å…è®¸æ‰€æœ‰çš„ipè®¿é—®postgres</div></pre></td></tr></table></figure></p><h1 id="3-é…ç½®kong-conf"><a href="#3-é…ç½®kong-conf" class="headerlink" title="3.é…ç½®kong.conf"></a>3.é…ç½®kong.conf</h1><p>æ‰§è¡Œ <code>vi /etc/kong/kong.conf</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">pg_host = 127.0.0.1             # The PostgreSQL host to connect to.</div><div class="line">pg_port = 5432                  # The port to connect to.</div><div class="line">pg_user = kong                  # The username to authenticate if required.</div><div class="line">pg_password = kong                  # The password to authenticate if required.</div><div class="line">pg_database = kong              # The database name to connect to.</div></pre></td></tr></table></figure><p>æ‰§è¡Œ<code>sudo /usr/local/bin/kong start -c /etc/kong/kong.conf</code>,æç¤º<code>Kong started</code>åˆ™ä»£è¡¨å¯åŠ¨æˆåŠŸ</p><p><code>curl -i http://localhost:8001/</code>,æµ‹è¯•kongæ˜¯å¦å¯åŠ¨ã€‚ä¹Ÿå¯ä»¥è®¿é—®<code>http://host:8000/</code>,æ¥ç¡®å®škongæ˜¯å¦èµ·æ¥ã€‚å› ä¸ºæ­¤æ—¶æˆ‘ä»¬å°šæœªé…ç½®ä»»ä½•æœåŠ¡ã€è·¯ç”±ï¼Œè®¿é—®ä¼šè¿”å›404ï¼Œå¦‚ä¸‹ï¼š<br><img src="/photo/img/kong/kong-404.png" alt="image"></p><h1 id="4-é…ç½®dashboard"><a href="#4-é…ç½®dashboard" class="headerlink" title="4.é…ç½®dashboard"></a>4.é…ç½®dashboard</h1><p>å‰ç½®æ“ä½œï¼šéœ€è¦å®‰è£…nodejs<br><code>sudo yum install nodejs</code></p><p>kongæä¾›ä¸€å¥—apiï¼Œç”¨äºåŠ¨æ€ç®¡æœåŠ¡ã€è·¯ç”±ã€æ’ä»¶ç­‰ã€‚å½“ç„¶æœ‰å¼€æºçš„dashboardï¼Œè¿™æ ·æˆ‘ä»¬æ“ä½œèµ·æ¥æ›´æ–¹ä¾¿ã€‚<br>å¼€æºé¡¹ç›®åœ°å€<code>https://github.com/PGBI/kong-dashboard</code></p><p>å®‰è£…å‘½ä»¤<code>npm install -g kong-dashboard</code></p><p>å¯åŠ¨å‘½ä»¤ï¼š<code>nohup kong-dashboard start --kong-url http://localhost:8001 /dev/null 2&gt;&amp;1 &amp;</code></p><p>ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå¯ä»¥å§å¯åŠ¨kongçš„è´¦æˆ·å¯†ç æ”¾åœ¨workçš„ç¯å¢ƒå˜é‡é‡Œã€‚<br>ä¿®æ”¹workçš„ç¯å¢ƒå˜é‡ vi ~.bash_profileï¼Œæ·»åŠ passwordå‚æ•°ã€‚<br>kong-dashboard start \<br>  â€“kong-url <a href="http://kong:8001" target="_blank" rel="noopener">http://kong:8001</a> \<br>  â€“basic-auth work=$password</p><h1 id="5-æ—¥å¿—ç›®å½•ä»¥åŠå¯åŠ¨ç›¸å…³"><a href="#5-æ—¥å¿—ç›®å½•ä»¥åŠå¯åŠ¨ç›¸å…³" class="headerlink" title="5.æ—¥å¿—ç›®å½•ä»¥åŠå¯åŠ¨ç›¸å…³"></a>5.æ—¥å¿—ç›®å½•ä»¥åŠå¯åŠ¨ç›¸å…³</h1><p>æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶<code>tail -f /usr/local/kong/logs/error.log</code></p><p>kongé…ç½®æ–‡ä»¶é»˜è®¤åœ°å€ä¸º /ect/kong/kong.conf<br>æƒ³è¦åˆ é™¤postgreSqlï¼Œéœ€è¦å…ˆæ–­å¼€æ‰€æœ‰è¿æ¥<code>sudo ps aux | grep scidb | xargs sudo kill -9</code></p><p>å¯åŠ¨å‘½ä»¤<code>sudo /usr/local/bin/kong start -c /etc/kong/kong.conf</code></p><h1 id="6-é‡åˆ°é—®é¢˜"><a href="#6-é‡åˆ°é—®é¢˜" class="headerlink" title="6.é‡åˆ°é—®é¢˜"></a>6.é‡åˆ°é—®é¢˜</h1><p>æ²™ç›’é¡¹ç›®éƒ¨ç½²çš„æ—¶å€™ï¼Œæˆ‘æŠŠé¡¹ç›®ä¸Šä¼ åˆ°äº† /home/work/kong/ç›®å½•ä¸‹ï¼Œå¹¶å°†å…¶è½¯è¿åˆ°äº†/usr/local/share/lua/ç›®å½•ä¸‹ã€‚ã€</p><p>å†å¯åŠ¨kongæ—¶ï¼ŒæŠ¥é”™:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">2018/12/06 15:26:01 [error] 7684#0: init_worker_by_lua error: /usr/local/share/lua/5.1/kong/init.lua:244: module &apos;resty.worker.events&apos; not found:Failed loading module resty.worker.events in LuaRocks rock lua-resty-worker-events 0.3.3-1</div><div class="line">no field package.preload[&apos;resty.worker.events&apos;]</div><div class="line">no file &apos;./resty/worker/events.lua&apos;</div><div class="line">no file &apos;./resty/worker/events/init.lua&apos;</div><div class="line">no file &apos;/usr/local/openresty/site/lualib/resty/worker/events.ljbc&apos;</div><div class="line">no file &apos;/usr/local/openresty/site/lualib/resty/worker/events/init.ljbc&apos;</div><div class="line">no file &apos;/usr/local/openresty/lualib/resty/worker/events.ljbc&apos;</div><div class="line">no file &apos;/usr/local/openresty/lualib/resty/worker/events/init.ljbc&apos;</div><div class="line">no file &apos;/usr/local/openresty/site/lualib/resty/worker/events.lua&apos;</div><div class="line">no file &apos;/usr/local/openresty/site/lualib/resty/worker/events/init.lua&apos;</div><div class="line">no file &apos;/usr/local/openresty/lualib/resty/worker/events.lua&apos;</div><div class="line">no file &apos;/usr/local/openresty/lualib/resty/worker/events/init.lua&apos;</div><div class="line">no file &apos;/usr/local/openresty/luajit/share/luajit-2.1.0-beta3/resty/worker/events.lua&apos;</div><div class="line">no file &apos;/usr/local/share/lua/5.1/resty/worker/events.lua&apos;</div><div class="line">no file &apos;/usr/local/share/lua/5.1/resty/worker/events/init.lua&apos;</div><div class="line">no file &apos;/usr/local/openresty/luajit/share/lua/5.1/resty/worker/events.lua&apos;</div><div class="line">no file &apos;/usr/local/openresty/luajit/share/lua/5.1/resty/worker/events/init.lua&apos;</div><div class="line">no file &apos;/root/.luarocks/share/lua/5.1/resty/worker/events.lua&apos;</div><div class="line">no file &apos;/root/.luarocks/share/lua/5.1/resty/worker/events/init.lua&apos;</div><div class="line">no file &apos;/usr/local/openresty/site/lualib/resty/worker/events.so&apos;</div><div class="line">no file &apos;/usr/local/openresty/lualib/resty/worker/events.so&apos;</div><div class="line">no file &apos;./resty/worker/events.so&apos;</div><div class="line">no file &apos;/usr/local/lib/lua/5.1/resty/worker/events.so&apos;</div><div class="line">no file &apos;/usr/local/openresty/luajit/lib/lua/5.1/resty/worker/events.so&apos;</div><div class="line">no file &apos;/usr/local/lib/lua/5.1/loadall.so&apos;</div><div class="line">no file &apos;/root/.luarocks/lib/lua/5.1/resty/worker/events.so&apos;</div><div class="line">no file &apos;/usr/local/openresty/site/lualib/resty.so&apos;</div><div class="line">no file &apos;/usr/local/openresty/lualib/resty.so&apos;</div><div class="line">no file &apos;./resty.so&apos;</div><div class="line">no file &apos;/usr/local/lib/lua/5.1/resty.so&apos;</div><div class="line">no file &apos;/usr/local/openresty/luajit/lib/lua/5.1/resty.so&apos;</div><div class="line">no file &apos;/usr/local/lib/lua/5.1/loadall.so&apos;</div><div class="line">no file &apos;/root/.luarocks/lib/lua/5.1/resty.so&apos;</div></pre></td></tr></table></figure><p>æœ€ç»ˆæˆ‘æŠŠé¡¹ç›®ä¸Šä¼ åˆ°äº†/usr/local/share/releas/ç›®å½•ä¸‹ï¼Œå¹¶å°†å…¶è½¯è¿åˆ°äº†/usr/local/share/lua/ä¸‹ï¼Œå¯åŠ¨å¹¶æ²¡æœ‰å‡ºç°æ”¹é—®é¢˜.</p><p>çº¿ç´¢ï¼š<br><code>https://github.com/Kong/kong/issues/2838</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å½“å‰ç³»ç»Ÿï¼Œç¯å¢ƒcentos7&lt;br&gt;èµ·kongæœåŠ¡éœ€è¦åšï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®‰è£…&lt;ul&gt;
&lt;li&gt;kong&lt;/li&gt;
&lt;li&gt;pgsql&lt;/li&gt;
&lt;li&gt;dashboard(å¯é€‰ï¼Œç”¨æ¥é€šè¿‡apiæ¥ç®¡ç†ç©º)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é…ç½®&lt;ul&gt;
      
    
    </summary>
    
      <category term="kong" scheme="http://yoursite.com/categories/kong/"/>
    
    
      <category term="kong" scheme="http://yoursite.com/tags/kong/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•å»ºç«‹ä¸€ä¸ªcomposerç§æœ‰åŒ…</title>
    <link href="http://yoursite.com/2018/09/28/%E5%A6%82%E4%BD%95%E5%BB%BA%E7%AB%8B%E4%B8%80%E4%B8%AAcomposer%E7%A7%81%E6%9C%89%E5%8C%85/"/>
    <id>http://yoursite.com/2018/09/28/å¦‚ä½•å»ºç«‹ä¸€ä¸ªcomposerç§æœ‰åŒ…/</id>
    <published>2018-09-28T09:11:00.000Z</published>
    <updated>2019-01-08T10:58:36.541Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘å‘ç°åˆ†å¸ƒå¼é”åœ¨å¾ˆå¤šé¡¹ç›®éƒ½æœ‰æ‰€ç”¨åˆ°,æ‰€ä»¥æƒ³æŠŠä¹‹å‰å®Œæˆçš„ä»£ç å°è£…æˆpearåŒ…,ä¾›å¤§å®¶ä½¿ç”¨ã€‚<br>ä½†æ˜¯å‘ç°è‡ªå·±å¯¹composerå¹¶ä¸æ˜¯å¾ˆç†Ÿæ‚‰,æ‰€ä»¥å­¦ä¹ ä¸€ç•ª,åœ¨æ­¤è®°å½•ä»¥é˜²è‡ªå·±å¿˜è®°ã€‚</p><h2 id="æ–°å»ºä»“åº“"><a href="#æ–°å»ºä»“åº“" class="headerlink" title="æ–°å»ºä»“åº“"></a>æ–°å»ºä»“åº“</h2><p>$ git clone git@gitlab.renrenche.com:web/jugg.git<br>$ cd jugg</p><h2 id="conmposer-åˆå§‹åŒ–"><a href="#conmposer-åˆå§‹åŒ–" class="headerlink" title="conmposer åˆå§‹åŒ–"></a>conmposer åˆå§‹åŒ–</h2><p>composer init </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">//åŒ…å</div><div class="line">Package name (&lt;vendor&gt;/&lt;name&gt;) [lijian/test_composer]: jugg/jugg</div><div class="line">//æè¿°</div><div class="line">Description []: åŸºäºredisçš„åˆ†å¸ƒå¼é”</div><div class="line">//ä½œè€…</div><div class="line">Author [, n to skip]: Maxie lj &lt;xiaolijian110@163.com&gt;</div><div class="line">//æœ€å°ç¨³å®šç‰ˆæœ¬</div><div class="line">Minimum Stability []: dev</div><div class="line">//éµå¾ªåè®®</div><div class="line">License []: MIT</div><div class="line"></div><div class="line">//ä¾èµ–</div><div class="line">Would you like to define your dependencies (require) interactively [yes]? yes</div><div class="line"></div><div class="line">Search for a package: php</div><div class="line"></div><div class="line">Enter the version constraint to require (or leave blank to use the latest version):</div><div class="line">Using version ^7.0 for php</div></pre></td></tr></table></figure><p>ç”Ÿæˆcomposer.jsonæ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;name&quot;: &quot;jugg/jugg&quot;,</div><div class="line">    &quot;description&quot;: &quot;åŸºäºredisçš„åˆ†å¸ƒå¼é”&quot;,</div><div class="line">    &quot;type&quot;: &quot;library&quot;,</div><div class="line">    &quot;require&quot;: &#123;</div><div class="line">        &quot;php&quot;: &quot;^7.0&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;require-dev&quot;: &#123;</div><div class="line">        &quot;php&quot;: &quot;7&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;license&quot;: &quot;MIT&quot;,</div><div class="line">    &quot;authors&quot;: [</div><div class="line">        &#123;</div><div class="line">            &quot;name&quot;: &quot;Maxie lj&quot;,</div><div class="line">            &quot;email&quot;: &quot;xiaolijian110@163.com&quot;</div><div class="line">        &#125;</div><div class="line">    ],</div><div class="line">    &quot;minimum-stability&quot;: &quot;dev&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="ç”Ÿæˆè‡ªåŠ¨åŠ è½½ï¼ˆpsr-4ï¼‰"><a href="#ç”Ÿæˆè‡ªåŠ¨åŠ è½½ï¼ˆpsr-4ï¼‰" class="headerlink" title="ç”Ÿæˆè‡ªåŠ¨åŠ è½½ï¼ˆpsr-4ï¼‰"></a>ç”Ÿæˆè‡ªåŠ¨åŠ è½½ï¼ˆpsr-4ï¼‰</h2><p>åœ¨composer.json æ–‡ä»¶é‡Œæ·»åŠ <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;name&quot;: &quot;jugg/jugg&quot;,</div><div class="line">    &quot;description&quot;: &quot;åŸºäºredisçš„åˆ†å¸ƒå¼é”&quot;,</div><div class="line">    &quot;type&quot;: &quot;library&quot;,</div><div class="line">    &quot;license&quot;: &quot;MIT&quot;,</div><div class="line">    &quot;authors&quot;: [</div><div class="line">        &#123;</div><div class="line">            &quot;name&quot;: &quot;Maxie lj&quot;,</div><div class="line">            &quot;email&quot;: &quot;xiaolijian110@163.com&quot;</div><div class="line">        &#125;</div><div class="line">    ],</div><div class="line">    &quot;autoload&quot;: &#123;</div><div class="line">    &quot;psr-4&quot;: &#123;</div><div class="line">      &quot;Jugg\\&quot;: &quot;jugg&quot;</div><div class="line">    &#125;</div><div class="line">    &#125;,</div><div class="line">    &quot;minimum-stability&quot;: &quot;dev&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>æ‰§è¡Œ<code>composer install</code></p><p>å°±ä¼šç”Ÿæˆä¸€ä¸ªè‡ªåŠ¨åŠ è½½æ–‡ä»¶</p><p><img src="/photo/img/åˆ›å»ºä¸€ä¸ªcomposeråŒ…/è‡ªåŠ¨åŠ è½½ç›®å½•.png" alt="image"></p><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥æŒ‰ç…§psr-4è§„èŒƒå¼€å‘æˆ‘ä»¬pearåŒ…äº†ã€‚</p><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>æˆ‘ä»¬å¯ä»¥åœ¨æµ‹è¯•æ–‡ä»¶é‡Œå¼•å…¥autoload.phpæ–‡ä»¶,è¿™æ ·å°±å®ç°äº†è‡ªåŠ¨åŠ è½½ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">require</span> <span class="string">'./vendor/autoload.php'</span>;</div></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥æ­£å¸¸çš„æµ‹è¯•äº†</p><h2 id="ä¸Šä¼ ä»£ç åˆ°gitlabæˆ–è€…github"><a href="#ä¸Šä¼ ä»£ç åˆ°gitlabæˆ–è€…github" class="headerlink" title="ä¸Šä¼ ä»£ç åˆ°gitlabæˆ–è€…github"></a>ä¸Šä¼ ä»£ç åˆ°gitlabæˆ–è€…github</h2><p>å½“æˆ‘ä»¬å¼€å®Œçš„æ—¶å€™,éœ€è¦å°†æˆ‘ä»¬çš„ä»£ç ä¸Šä¼ åˆ°è¿œç¨‹ä»£ç åº“ã€‚</p><p>éœ€è¦æ³¨æ„çš„äº‹ ä¸€å®šä¸è¦è®².gitæ–‡ä»¶ä¸Šä¼ ã€‚</p><h2 id="å…¶ä»–é¡¹ç›®å¼•å…¥"><a href="#å…¶ä»–é¡¹ç›®å¼•å…¥" class="headerlink" title="å…¶ä»–é¡¹ç›®å¼•å…¥"></a>å…¶ä»–é¡¹ç›®å¼•å…¥</h2><p>å› ä¸ºæ²¡æœ‰ä¸Šä¼ åˆ°pagelist,æ‰€ä»¥æˆ‘ä»¬æš‚æ—¶æ˜¯å…¬å¸ç§æœ‰åŒ…ã€‚</p><p>å¦‚æœéœ€è¦å†é¡¹ç›®é‡Œå¼•å…¥ç§æœ‰åŒ…,éœ€è¦åœ¨é¡¹ç›®çš„composer.jsonæ–‡ä»¶é‡Œæ·»åŠ ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&quot;jugg&quot;: &#123;</div><div class="line">        &quot;type&quot;:&quot;package&quot;,</div><div class="line">        &quot;package&quot;: &#123;</div><div class="line">          &quot;name&quot;: &quot;jugg&quot;,</div><div class="line">          &quot;version&quot;: &quot;v1.1&quot;,</div><div class="line">          &quot;source&quot;: &#123;</div><div class="line">            &quot;type&quot;: &quot;git&quot;,</div><div class="line">            &quot;url&quot;: &quot;git@gitlab.renrenche.com:web/jugg.git&quot;,</div><div class="line">            &quot;reference&quot;: &quot;master&quot;</div><div class="line">          &#125;,</div><div class="line">          &quot;autoload&quot;: &#123;</div><div class="line">            &quot;psr-4&quot;: &#123;</div><div class="line">              &quot;Jugg\\&quot;: &quot;jugg&quot;</div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div></pre></td></tr></table></figure><p>å®Œæ•´æ–‡ä»¶:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;name&quot;: &quot;laravel/lumen&quot;,</div><div class="line">    &quot;description&quot;: &quot;The Laravel Lumen Framework.&quot;,</div><div class="line">    &quot;keywords&quot;: [</div><div class="line">        &quot;framework&quot;,</div><div class="line">        &quot;laravel&quot;,</div><div class="line">        &quot;lumen&quot;</div><div class="line">    ],</div><div class="line">    &quot;license&quot;: &quot;MIT&quot;,</div><div class="line">    &quot;type&quot;: &quot;project&quot;,</div><div class="line">    &quot;repositories&quot;: &#123;</div><div class="line">      &quot;packagist&quot;: &#123;</div><div class="line">        &quot;type&quot;: &quot;composer&quot;,</div><div class="line">        &quot;url&quot;: &quot;https://packagist.phpcomposer.com&quot;</div><div class="line">      &#125;,</div><div class="line">        &quot;0&quot;: &#123;</div><div class="line">            &quot;type&quot;: &quot;package&quot;,</div><div class="line">            &quot;package&quot;: &#123;</div><div class="line">                &quot;name&quot;: &quot;sdk/clusterproxy&quot;,</div><div class="line">                &quot;version&quot;: &quot;1.0.3&quot;,</div><div class="line">                &quot;source&quot;: &#123;</div><div class="line">                    &quot;type&quot;: &quot;git&quot;,</div><div class="line">                    &quot;url&quot;: &quot;git@gitlab.renrenche.com:sdk/clusterproxy.git&quot;,</div><div class="line">                    &quot;reference&quot;: &quot;master&quot;</div><div class="line">                &#125;,</div><div class="line">                &quot;autoload&quot;: &#123;</div><div class="line">                    &quot;psr-4&quot;: &#123;</div><div class="line">                        &quot;Cluster\\&quot;: &quot;src/Cluster&quot;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">      &quot;1&quot;: &#123;</div><div class="line">        &quot;type&quot;: &quot;package&quot;,</div><div class="line">        &quot;package&quot;: &#123;</div><div class="line">          &quot;name&quot;: &quot;sdk/dingtalk-alarm-php-sdk&quot;,</div><div class="line">          &quot;version&quot;: &quot;1.0&quot;,</div><div class="line">          &quot;source&quot;: &#123;</div><div class="line">            &quot;type&quot;: &quot;git&quot;,</div><div class="line">            &quot;url&quot;: &quot;git@gitlab.renrenche.com:sdk/dingtalk-alarm-php-sdk.git&quot;,</div><div class="line">            &quot;reference&quot;: &quot;master&quot;</div><div class="line">          &#125;,</div><div class="line">          &quot;autoload&quot;: &#123;</div><div class="line">            &quot;psr-4&quot;: &#123;</div><div class="line">              &quot;Rrc\\&quot;: &quot;src/Rrc/&quot;</div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;,</div><div class="line">      &quot;2&quot;: &#123;</div><div class="line">        &quot;type&quot;:&quot;package&quot;,</div><div class="line">        &quot;package&quot;: &#123;</div><div class="line">          &quot;name&quot;: &quot;sdk/prometheus-php-sdk&quot;,</div><div class="line">          &quot;version&quot;: &quot;1.0&quot;,</div><div class="line">          &quot;source&quot;: &#123;</div><div class="line">            &quot;type&quot;: &quot;git&quot;,</div><div class="line">            &quot;url&quot;: &quot;git@gitlab.renrenche.com:sdk/prometheus-php-sdk.git&quot;,</div><div class="line">            &quot;reference&quot;: &quot;master&quot;</div><div class="line">          &#125;,</div><div class="line">          &quot;autoload&quot;: &#123;</div><div class="line">            &quot;psr-4&quot;: &#123;</div><div class="line">              &quot;Rrc\\&quot;: &quot;src/Rrc/&quot;</div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;,</div><div class="line">      &quot;jugg&quot;: &#123;</div><div class="line">        &quot;type&quot;:&quot;package&quot;,</div><div class="line">        &quot;package&quot;: &#123;</div><div class="line">          &quot;name&quot;: &quot;jugg&quot;,</div><div class="line">          &quot;version&quot;: &quot;v1.1&quot;,</div><div class="line">          &quot;source&quot;: &#123;</div><div class="line">            &quot;type&quot;: &quot;git&quot;,</div><div class="line">            &quot;url&quot;: &quot;git@gitlab.renrenche.com:web/jugg.git&quot;,</div><div class="line">            &quot;reference&quot;: &quot;master&quot;</div><div class="line">          &#125;,</div><div class="line">          &quot;autoload&quot;: &#123;</div><div class="line">            &quot;psr-4&quot;: &#123;</div><div class="line">              &quot;Jugg\\&quot;: &quot;jugg&quot;</div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line">    &quot;require&quot;: &#123;</div><div class="line">        &quot;php&quot;: &quot;&gt;=7.0&quot;,</div><div class="line">        &quot;laravel/lumen-framework&quot;: &quot;5.5.*&quot;,</div><div class="line">        &quot;vlucas/phpdotenv&quot;: &quot;~2.2&quot;,</div><div class="line">        &quot;guzzlehttp/guzzle&quot;: &quot;^6.2&quot;,</div><div class="line">        &quot;sdk/clusterproxy&quot;: &quot;^1.0&quot;,</div><div class="line">        &quot;illuminate/redis&quot;: &quot;^5.3&quot;,</div><div class="line">        &quot;peixinchen/mns&quot;: &quot;^1.0&quot;,</div><div class="line">        &quot;mockery/mockery&quot;: &quot;^0.9.5&quot;,</div><div class="line">        &quot;firebase/php-jwt&quot;: &quot;^4.0&quot;,</div><div class="line">        &quot;sdk/dingtalk-alarm-php-sdk&quot;: &quot;^1.0&quot;,</div><div class="line">        &quot;sdk/prometheus-php-sdk&quot;: &quot;^1.0&quot;,</div><div class="line">        &quot;predis/predis&quot;: &quot;^1.1&quot;,</div><div class="line">        &quot;solarium/solarium&quot;: &quot;^3.8&quot;,</div><div class="line">        &quot;mongodb/mongodb&quot;: &quot;^1.3&quot;,</div><div class="line">        &quot;jugg&quot;: &quot;^1.0&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;require-dev&quot;: &#123;</div><div class="line">        &quot;fzaninotto/faker&quot;: &quot;~1.4&quot;,</div><div class="line">        &quot;phpunit/phpunit&quot;: &quot;~6.0&quot;,</div><div class="line">        &quot;mockery/mockery&quot;: &quot;~0.9&quot;,</div><div class="line">        &quot;phpstan/phpstan&quot;: &quot;^0.9.2&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;autoload&quot;: &#123;</div><div class="line">        &quot;psr-4&quot;: &#123;</div><div class="line">            &quot;Rrc\\&quot;: &quot;./&quot;</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    &quot;autoload-dev&quot;: &#123;</div><div class="line">        &quot;classmap&quot;: [</div><div class="line">            &quot;tests/&quot;,</div><div class="line">            &quot;database/&quot;</div><div class="line">        ]</div><div class="line">    &#125;,</div><div class="line">    &quot;scripts&quot;: &#123;</div><div class="line">        &quot;post-root-package-install&quot;: [</div><div class="line">            &quot;php -r \&quot;copy(&apos;.env.example&apos;, &apos;.env&apos;);\&quot;&quot;</div><div class="line">        ]</div><div class="line">    &#125;,</div><div class="line">    &quot;minimum-stability&quot;: &quot;dev&quot;,</div><div class="line">    &quot;prefer-stable&quot;: true,</div><div class="line">    &quot;config&quot;: &#123;</div><div class="line">        &quot;optimize-autoloader&quot;: true</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œ<code>composer require jugg&lt;åŒ…å&gt;</code> å°±å¯ä»¥å¼•å…¥åˆ°é¡¹ç›®é‡Œäº†ã€‚ </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘å‘ç°åˆ†å¸ƒå¼é”åœ¨å¾ˆå¤šé¡¹ç›®éƒ½æœ‰æ‰€ç”¨åˆ°,æ‰€ä»¥æƒ³æŠŠä¹‹å‰å®Œæˆçš„ä»£ç å°è£…æˆpearåŒ…,ä¾›å¤§å®¶ä½¿ç”¨ã€‚&lt;br&gt;ä½†æ˜¯å‘ç°è‡ªå·±å¯¹composerå¹¶ä¸æ˜¯å¾ˆç†Ÿæ‚‰,æ‰€ä»¥å­¦ä¹ ä¸€ç•ª,åœ¨æ­¤è®°å½•ä»¥é˜²è‡ªå·±å¿˜è®°ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ–°å»ºä»“åº“&quot;&gt;&lt;a href=&quot;#æ–°å»ºä»“åº“&quot; class=&quot;header
      
    
    </summary>
    
      <category term="å·¥å…·" scheme="http://yoursite.com/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="composer" scheme="http://yoursite.com/tags/composer/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨guzzleå¹¶è¡Œè¯·æ±‚</title>
    <link href="http://yoursite.com/2018/09/28/%E4%BD%BF%E7%94%A8guzzle%E5%B9%B6%E8%A1%8C%E8%AF%B7%E6%B1%82/"/>
    <id>http://yoursite.com/2018/09/28/ä½¿ç”¨guzzleå¹¶è¡Œè¯·æ±‚/</id>
    <published>2018-09-28T09:10:05.000Z</published>
    <updated>2019-01-08T10:58:05.950Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>ç”±äºæ‹å–é¡¹ç›®ç‰¹æœ‰çš„ç‚¹ç‰¹, ä¼šå¯¼è‡´åœ¨å¼€æ‹æ˜¯æœ‰ç¬æ—¶çš„é«˜æµé‡ã€‚<br>åç«¯ç³»ç»Ÿä¼šæ¯ä¸ªå‡ºä»·æ’åº, ç”±äºé«˜qpså¯¼è‡´æ’åºä¼šæœ‰é‡å¤çš„æƒ…å†µ,ã€‚ä¸ºäº†è§£å†³é®æ©æ ·çš„é—®é¢˜,<br>å°±å†™äº†ä¸€ä¸ªåˆ†å¸ƒå¼é”, ç”¨äºè§£å†³æ’åºå†²çªã€‚ç”¨guzzleå†™äº†ä¸€ä¸ªå‹æµ‹è„šæœ¬ã€‚</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>é¦–å…ˆå‹æµ‹æ˜¯ä¸ºäº†åŒä¸€æ—¶åˆ»å‘é€æŒ‡å®šæ•°é‡çš„è¯·æ±‚åˆ°ç›®æ ‡æ¥å£ã€‚<br>æ‰€ä»¥ä¸²è¡Œè¯çš„è¯·æ±‚æ˜¯æ— æ³•<br>guzzle æ”¯æŒç”¨poolå®ç°å¹¶è¡Œçš„è¯·æ±‚ã€‚<br>å®˜æ–¹æ–‡æ¡£ :</p><p><a href="https://guzzle-cn.readthedocs.io/zh_CN/latest/quickstart.html?highlight=Pool" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£æ”¯æŒ</a></p><p>æ–‡æ¡£ä¸­å¹¶æ²¡æœ‰æç¤ºå¦‚ä½•å‘é€POSTè¯·æ±‚, é¡¾ç¢ç£¨ä¸€ä¸‹:</p><p>å¹¶è¡Œæ–¹å¼è¯·æ±‚:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">$client = <span class="keyword">new</span> Client([<span class="string">'base_uri'</span> =&gt; <span class="string">'10.171.22.45:5005'</span>, <span class="string">'timeout'</span> =&gt; <span class="number">10</span>]);</div><div class="line">  </div><div class="line">      $requests = <span class="function"><span class="keyword">function</span> <span class="params">($total)</span> </span>&#123;</div><div class="line">          $uri = <span class="string">'api/v1/bid'</span>;</div><div class="line">          <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $total; $i++) &#123;</div><div class="line">              <span class="keyword">yield</span> <span class="keyword">new</span> Request(<span class="string">'POST'</span>, $uri, [<span class="string">'Content-type'</span> =&gt; <span class="string">'application/json'</span>],json_encode([</div><div class="line">                  <span class="string">'car_dealer_id'</span>=&gt; (string)rand(<span class="number">1</span>,<span class="number">20000</span>),</div><div class="line">                  <span class="string">'bid_price'</span> =&gt; <span class="string">"4"</span>,</div><div class="line">                  <span class="string">'car_id'</span> =&gt; <span class="string">"206431344"</span>,</div><div class="line">                  <span class="string">'fr'</span> =&gt; <span class="string">'bd_other'</span>,</div><div class="line">                  <span class="string">'platform'</span> =&gt; <span class="string">'MO'</span>,</div><div class="line">                  <span class="string">'source'</span> =&gt; <span class="string">'C2Bç«ä»·'</span>,</div><div class="line">                  <span class="string">'sale_type'</span> =&gt; <span class="string">'å–è½¦'</span>,</div><div class="line">                  <span class="string">'car_dealer_city'</span> =&gt; <span class="string">'æ·±åœ³'</span>,</div><div class="line">                  <span class="string">'app_version'</span> =&gt; <span class="string">"3.2"</span></div><div class="line">              ]));</div><div class="line">          &#125;</div><div class="line">      &#125;;</div><div class="line">  </div><div class="line">      $pool = <span class="keyword">new</span> Pool($client, $requests(<span class="number">100</span>), [</div><div class="line">          <span class="string">'concurrency'</span> =&gt; <span class="number">5</span>,</div><div class="line">          <span class="string">'fulfilled'</span> =&gt; <span class="function"><span class="keyword">function</span> <span class="params">($response, $index)</span> </span>&#123;</div><div class="line">              var_dump($response-&gt;getBody()-&gt;getContents());</div><div class="line">          &#125;,</div><div class="line">          <span class="string">'rejected'</span> =&gt; <span class="function"><span class="keyword">function</span> <span class="params">($reason, $index)</span> </span>&#123;</div><div class="line">              var_dump($reason-&gt;getMessage());</div><div class="line">          &#125;,</div><div class="line">      ]);</div><div class="line">  </div><div class="line">      $promise = $pool-&gt;promise();</div><div class="line">      $promise-&gt;wait();</div></pre></td></tr></table></figure><p><img src="/photo/img/guzzleå‹æµ‹/å¹¶è¡Œ.png" alt="image"><br><img src="/photo/img/guzzleå‹æµ‹/é€»è¾‘ä¸Šå¹¶è¡Œ-100æ¬¡.png" alt="image"><br><img src="/photo/img/guzzleå‹æµ‹/é€»è¾‘ä¸Šå¹¶è¡Œ-100æ¬¡ç»“æŸ.png" alt="image"></p><p>ä¸²è¡Œ:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> ($i =<span class="number">1</span> ; $i&lt;<span class="number">20</span>;$i++) &#123;</div><div class="line">    <span class="keyword">echo</span> time();</div><div class="line">    $org_res[] = <span class="keyword">$this</span>-&gt;client-&gt;request(<span class="string">'POST'</span>, <span class="string">'api/v1/bid'</span>,[<span class="string">'form_params'</span>=&gt;</div><div class="line">        [</div><div class="line">            <span class="string">'car_dealer_id'</span>=&gt; rand(<span class="number">1</span>,<span class="number">20000</span>),</div><div class="line">            <span class="string">'bid_price'</span> =&gt; <span class="number">4</span>,</div><div class="line">            <span class="string">'car_id'</span> =&gt; <span class="number">206431332</span>,</div><div class="line">            <span class="string">'fr'</span> =&gt; <span class="string">'bd_other'</span>,</div><div class="line">            <span class="string">'platform'</span> =&gt; <span class="string">'MO'</span>,</div><div class="line">            <span class="string">'source'</span> =&gt; <span class="string">'C2Bç«ä»·'</span>,</div><div class="line">            <span class="string">'sale_type'</span> =&gt; <span class="string">'å–è½¦'</span>,</div><div class="line">            <span class="string">'car_dealer_city'</span> =&gt; <span class="string">'æ·±åœ³'</span>,</div><div class="line">            <span class="string">'app_version'</span> =&gt; <span class="number">3.2</span></div><div class="line">        ]]);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">foreach</span> ($org_res <span class="keyword">as</span> $val) &#123;</div><div class="line">    $resdata = $val-&gt;getBody()-&gt;getContents();</div><div class="line">&#125;</div><div class="line">var_dump($resdata);</div><div class="line"><span class="keyword">die</span>;</div></pre></td></tr></table></figure><p>è¯·æ±‚ç»“æœ:</p><p><img src="/photo/img/guzzleå‹æµ‹/ä¸²è¡Œ.png" alt="image"></p><p><img src="/photo/img/guzzleå‹æµ‹/é€»è¾‘ä¸Šçš„ä¸²è¡Œ-100æ¬¡.png" alt="image"></p><h2 id="ä¸¤è€…åŒºåˆ«"><a href="#ä¸¤è€…åŒºåˆ«" class="headerlink" title="ä¸¤è€…åŒºåˆ«"></a>ä¸¤è€…åŒºåˆ«</h2><ul><li>ä»æ€§èƒ½ä¸Šæ¥çœ‹,20æ¬¡è¯·æ±‚, å¹¶è¡Œè¯·æ±‚è€—æ—¶2ç§’, ä¸²è¡Œè¯·æ±‚3ç§’ã€‚</li><li>å½“è¯·æ±‚åŠ åˆ°100æ¬¡çš„æ—¶å€™, å¹¶è¡Œè¯·æ±‚è€—æ—¶6ç§’, ä¸²è¡Œè¯·æ±‚è€—æ—¶27ç§’,è¿™ä¸ªæ—¶å€™å°±èƒ½ä½“ç°å‡ºå¹¶è¡Œå’Œä¸²è¡Œçš„å´åˆ«ç›¸å·®21ç§’ã€‚</li></ul><p>ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆå·®è·,å†ä¸Šä¸€å¼ å›¾å’Œä»£ç ,æ‰“å°å‡ºæ¥å¼€å§‹ç»“æŸæ—¶é—´ã€‚</p><p>å¹¶è¡Œ:<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">å¹¶è¡Œè¯·æ±‚</div><div class="line"> <span class="keyword">echo</span> <span class="string">'æ€»çš„å¼€å§‹:'</span>.microtime().<span class="string">'&lt;br&gt;'</span>;</div><div class="line"> $client = <span class="keyword">new</span> Client([<span class="string">'base_uri'</span> =&gt; <span class="string">'10.171.22.45:5005'</span>, <span class="string">'timeout'</span> =&gt; <span class="number">10</span>]);</div><div class="line"> $requests = <span class="function"><span class="keyword">function</span> <span class="params">($total)</span> </span>&#123;</div><div class="line">     $uri = <span class="string">'api/v1/bid'</span>;</div><div class="line">     <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $total; $i++) &#123;</div><div class="line">         $car_dealer_id = (string)rand(<span class="number">1</span>,<span class="number">1000000</span>);</div><div class="line">         <span class="keyword">echo</span> <span class="string">'å¼€å§‹'</span>.microtime().<span class="string">' car_dealer_id:'</span>.$car_dealer_id.<span class="string">"&lt;br&gt;"</span>;</div><div class="line">         <span class="keyword">yield</span> <span class="keyword">new</span> Request(<span class="string">'POST'</span>, $uri, [<span class="string">'Content-type'</span> =&gt; <span class="string">'application/json'</span>],json_encode([</div><div class="line">             <span class="string">'car_dealer_id'</span>=&gt; (string)$car_dealer_id,</div><div class="line">             <span class="string">'bid_price'</span> =&gt; <span class="string">"4"</span>,</div><div class="line">             <span class="string">'car_id'</span> =&gt; <span class="string">"206431344"</span>,</div><div class="line">             <span class="string">'fr'</span> =&gt; <span class="string">'bd_other'</span>,</div><div class="line">             <span class="string">'platform'</span> =&gt; <span class="string">'MO'</span>,</div><div class="line">             <span class="string">'source'</span> =&gt; <span class="string">'C2Bç«ä»·'</span>,</div><div class="line">             <span class="string">'sale_type'</span> =&gt; <span class="string">'å–è½¦'</span>,</div><div class="line">             <span class="string">'car_dealer_city'</span> =&gt; <span class="string">'æ·±åœ³'</span>,</div><div class="line">             <span class="string">'app_version'</span> =&gt; <span class="string">"3.2"</span></div><div class="line">         ]));</div><div class="line">     &#125;</div><div class="line"> &#125;;</div><div class="line"></div><div class="line"> $pool = <span class="keyword">new</span> Pool($client, $requests(<span class="number">100</span>), [</div><div class="line">     <span class="string">'concurrency'</span> =&gt; <span class="number">5</span>,</div><div class="line">     <span class="string">'fulfilled'</span> =&gt; <span class="function"><span class="keyword">function</span> <span class="params">($response, $index)</span> </span>&#123;</div><div class="line">         var_dump($response-&gt;getBody()-&gt;getContents());</div><div class="line">         <span class="keyword">echo</span> microtime().<span class="string">"&lt;br&gt;"</span>;</div><div class="line">     &#125;,</div><div class="line">     <span class="string">'rejected'</span> =&gt; <span class="function"><span class="keyword">function</span> <span class="params">($reason, $index)</span> </span>&#123;</div><div class="line">         var_dump($reason-&gt;getMessage());</div><div class="line">         <span class="keyword">echo</span> microtime();</div><div class="line">     &#125;,</div><div class="line"> ]);</div><div class="line"></div><div class="line"> $promise = $pool-&gt;promise();</div><div class="line"></div><div class="line"> $promise-&gt;wait();</div><div class="line"> <span class="keyword">echo</span> <span class="string">'æ€»çš„ç»“æŸ:'</span>.microtime().<span class="string">'&lt;br&gt;'</span>;</div></pre></td></tr></table></figure></p><p>100æ¬¡è¯·æ±‚çš„è¿”å›ç»“æœ</p><p><img src="/photo/img/guzzleå‹æµ‹/å¸¦æ—¶é—´çš„å¹¶è¡Œè¯·æ±‚ç»“æœ.png" alt="image"></p><p>ä¸²è¡Œ:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">for</span> ($i =<span class="number">1</span> ; $i&lt;<span class="number">100</span>;$i++) &#123;</div><div class="line">            <span class="keyword">echo</span> <span class="string">'å¼€å§‹æ—¶é—´'</span>.microtime().<span class="string">"&lt;br&gt;"</span>;</div><div class="line">            $ret = <span class="keyword">$this</span>-&gt;client-&gt;request(<span class="string">'POST'</span>, <span class="string">'api/v1/bid'</span>,[<span class="string">'form_params'</span>=&gt;</div><div class="line">                [</div><div class="line">                    <span class="string">'car_dealer_id'</span>=&gt; rand(<span class="number">1</span>,<span class="number">2000000</span>),</div><div class="line">                    <span class="string">'bid_price'</span> =&gt; <span class="number">4</span>,</div><div class="line">                    <span class="string">'car_id'</span> =&gt; <span class="number">206431332</span>,</div><div class="line">                    <span class="string">'fr'</span> =&gt; <span class="string">'bd_other'</span>,</div><div class="line">                    <span class="string">'platform'</span> =&gt; <span class="string">'MO'</span>,</div><div class="line">                    <span class="string">'source'</span> =&gt; <span class="string">'C2Bç«ä»·'</span>,</div><div class="line">                    <span class="string">'sale_type'</span> =&gt; <span class="string">'å–è½¦'</span>,</div><div class="line">                    <span class="string">'car_dealer_city'</span> =&gt; <span class="string">'æ·±åœ³'</span>,</div><div class="line">                    <span class="string">'app_version'</span> =&gt; <span class="number">3.2</span></div><div class="line">                ]]);</div><div class="line">            $org_res[] = $ret;</div><div class="line">            <span class="keyword">echo</span> <span class="string">'ç»“æŸæ—¶é—´'</span>.microtime().<span class="string">"&lt;br&gt;"</span>;</div><div class="line">            var_export($ret-&gt;getBody()-&gt;getContents());</div><div class="line">        &#125;</div><div class="line"></div><div class="line"><span class="comment">//        foreach ($org_res as $val) &#123;</span></div><div class="line"><span class="comment">//            $resdata[] = $val-&gt;getBody()-&gt;getContents();</span></div><div class="line"><span class="comment">//        &#125;</span></div><div class="line"><span class="comment">//        var_dump($resdata);</span></div><div class="line">        <span class="keyword">die</span>;</div></pre></td></tr></table></figure><p>100æ¬¡è¯·æ±‚çš„è¿”å›ç»“æœ</p><p><img src="/photo/img/guzzleå‹æµ‹/å¸¦æ—¶é—´çš„ä¸²è¡Œè¯·æ±‚ç»“æœ.png" alt="image"></p><ul><li>æ‰€ä»¥å¯ä»¥çœ‹å‡º,å¹¶è¡Œè¯·æ±‚æ˜¯å…ˆç”Ÿæˆæ‰€æœ‰è¯·æ±‚ï¼ˆè¿™ä¸ªä¸Šé™å’Œconcurrency å‚æ•°æœ‰å…³ï¼‰,å†ç­‰å¾…ç»“æœã€‚å¦‚æœè¾¾åˆ°å½“å‰å¹¶è¡Œçš„ä¸Šçº¿,å°±ç­‰å¾…è¯·æ±‚ç»“æŸå†ç”Ÿæˆæ–°çš„è¯·æ±‚ã€‚</li><li>ä¸²è¡Œè¯·æ±‚ä¸ºè¯·æ±‚,ç­‰å¾…ç»“æœç„¶ååœ¨è¯·æ±‚ã€‚</li></ul><p>æ‰€ä»¥å¦‚æœè¯·æ±‚é‡å¾ˆå¤§çš„è¯,å°½é‡è¿˜æ˜¯ç”¨å¹¶è¡Œè¯·æ±‚ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;ç”±äºæ‹å–é¡¹ç›®ç‰¹æœ‰çš„ç‚¹ç‰¹, ä¼šå¯¼è‡´åœ¨å¼€æ‹æ˜¯æœ‰ç¬æ—¶çš„é«˜æµé‡ã€‚&lt;br&gt;åç«¯ç³»ç»Ÿä¼šæ¯ä¸ªå‡ºä»·æ’åº, ç”±äºé«˜qpså¯¼è‡´æ’åºä¼šæœ‰é‡å¤çš„æƒ…å†µ,ã€‚ä¸ºäº†è§£å†³é®æ©
      
    
    </summary>
    
      <category term="php" scheme="http://yoursite.com/categories/php/"/>
    
    
      <category term="php" scheme="http://yoursite.com/tags/php/"/>
    
  </entry>
  
  <entry>
    <title>phpåƒåœ¾å›æ”¶</title>
    <link href="http://yoursite.com/2018/09/12/php%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/"/>
    <id>http://yoursite.com/2018/09/12/phpåƒåœ¾å›æ”¶/</id>
    <published>2018-09-12T13:28:00.000Z</published>
    <updated>2019-01-08T10:53:43.066Z</updated>
    
    <content type="html"><![CDATA[<p>phpæ˜¯å¦‚ä½•å®ç°å†…å­˜ç®¡ç†çš„?å†…å­˜ç®¡ç†æ— éåŒ…æ‹¬å†…å­˜åˆ†é…ã€å†…å­˜å›æ”¶ã€ä»¥åŠå†…å­˜ä½¿ç”¨ä¼˜åŒ–ã€‚</p><ul><li>å†…å­˜ä½¿ç”¨çš„ä¼˜åŒ–</li><li>åƒåœ¾å›æ”¶æœºåˆ¶</li><li>åº•å±‚å†…å­˜åˆ†é…</li></ul><h2 id="å†…å­˜ä½¿ç”¨çš„ä¼˜åŒ–"><a href="#å†…å­˜ä½¿ç”¨çš„ä¼˜åŒ–" class="headerlink" title="å†…å­˜ä½¿ç”¨çš„ä¼˜åŒ–"></a>å†…å­˜ä½¿ç”¨çš„ä¼˜åŒ–</h2><h3 id="å¼•ç”¨è®¡æ•°"><a href="#å¼•ç”¨è®¡æ•°" class="headerlink" title="å¼•ç”¨è®¡æ•°"></a>å¼•ç”¨è®¡æ•°</h3><p>phpçš„å¼•ç”¨ä¸­æœ‰ä¸ªå¼•ç”¨ç»“æ„ä½“</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">```c</div><div class="line">struct _zend_reference &#123;</div><div class="line">    zend_refcondted_h gc;</div><div class="line">    zval              val;  æŒ‡å‘åŸæ¥çš„value.</div><div class="line">&#125;;</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">å…¶ä¸­`zend_refcondted_h` ä¾¿æ˜¯gcä¾¿æ˜¯å½“å‰å˜é‡è¢«å¼•ç”¨çš„æ¬¡æ•°,è¿™ä¸ªå‚æ•°ä¼šåœ¨å˜é‡å›æ”¶çš„æ—¶å€™ç”¨åˆ°ã€‚</div><div class="line"></div><div class="line"></div><div class="line">zend_refcondted_h :</div><div class="line"></div><div class="line">```c</div><div class="line">typedef struct _zend_refcounted_h &#123;</div><div class="line">uint32_t         refcount;/* reference counter 32-bit */</div><div class="line">union &#123;</div><div class="line">struct &#123;</div><div class="line">ZEND_ENDIAN_LOHI_3(</div><div class="line">zend_uchar    type,</div><div class="line">zend_uchar    flags,    /* used for strings &amp; objects */</div><div class="line">uint16_t      gc_info)  /* keeps GC root number (or 0) and color */</div><div class="line">&#125; v;</div><div class="line">uint32_t type_info;</div><div class="line">&#125; u;</div><div class="line">&#125; zend_refcounted_h;</div></pre></td></tr></table></figure><p>åœ¨å®é™…ä¸­è¿™ä¸ªç»“æ„ä½“åˆ°åº•æ˜¯ä»€ä¹ˆæ ·çš„? å…·ä½“å¯ä»¥ä¸¾ä¾‹æ¥çœ‹ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$a = <span class="string">'this is string'</span>; <span class="comment">// zend_array (refcount = 1)  åªæœ‰$aå¼•ç”¨äº†zend_array</span></div><div class="line">$b = &amp;$a; <span class="comment">//   zend_array (refcount = 2)  $aã€$bå¼•ç”¨äº†zend_array</span></div><div class="line">$c = $b; <span class="comment">// zend_array (refcount = 3)  $aã€$bã€$cå¼•ç”¨äº†zend_array</span></div><div class="line"><span class="keyword">unset</span>($b); <span class="comment">// zend_array (refcount = 2)  $aã€$cå¼•ç”¨äº†zend_array</span></div></pre></td></tr></table></figure><blockquote><p>å¹¶ä¸æ˜¯æ‰€æœ‰çš„å˜é‡ç±»å‹éƒ½ä¼šä½¿ç”¨å¼•ç”¨è®¡æ•°, ä¾‹å¦‚ <code>æ•´å½¢</code>ã€<code>æµ®ç‚¹å‹</code>ã€<code>å¸ƒå°”å‹</code>ã€<code>NUll</code>(åœ¨phpä¸­è¿™æ˜¯ä¸€ä¸ªå˜é‡ç±»å‹)ç­‰é‡‡ç”¨äº†æ·±æ‹·è´,<br>å³åªè¦è¿™å‡ ç§å˜é‡èµ‹å€¼, å°±ä¼šç”³è¯·ä¸€æ¬¾ä¸€å—å†…å­˜å†™å…¥ä¸€ä¸ªæ–°çš„å˜é‡ç»“æ„ï¼ˆæ³¨æ„è¿™é‡Œä¸æ˜¯å¼•ç”¨ç»“æ„ï¼‰,å½“ç„¶è¿™äº›ç±»å‹ä¸ä¼šå…¬ç”¨valueã€‚</p></blockquote><h3 id="å†™æ—¶å¤åˆ¶"><a href="#å†™æ—¶å¤åˆ¶" class="headerlink" title="å†™æ—¶å¤åˆ¶"></a>å†™æ—¶å¤åˆ¶</h3><p>å½“ç„¶åªæœ‰å¼•ç”¨è®¡æ•°æ˜¯ä¸å¤Ÿçš„, å› ä¸ºå˜é‡ä¼šå‘ç”Ÿèµ‹å€¼çš„æƒ…å†µã€‚æ‰€ä»¥åœ¨æ›´æ”¹æŸä¸€ä¸ªå˜é‡æ—¶, ä¼šå¯¹åŸæ¥çš„å˜é‡è¿›è¡Œæ‹·è´å¹¶èµ‹å€¼ã€‚</p><p>ä¸¾ä¸ªæ —å­:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$foo = time();</div><div class="line">$bar = &amp;$b;</div><div class="line">$si = $a;</div><div class="line"></div><div class="line">$c = &apos;123&apos;;</div></pre></td></tr></table></figure><p>å…·ä½“æ•°æ®ç»“æ„çš„å¼•ç”¨è®¡æ•°æƒ…å†µå¦‚ä¸‹å›¾:</p><p><img src="/photo/img/phpå†…å­˜ç®¡ç†/å†™æ—¶å¤åˆ¶.png" alt="image"></p><h2 id="å†…å­˜å›æ”¶"><a href="#å†…å­˜å›æ”¶" class="headerlink" title="å†…å­˜å›æ”¶"></a>å†…å­˜å›æ”¶</h2><h3 id="è‡ªåŠ¨gc"><a href="#è‡ªåŠ¨gc" class="headerlink" title="è‡ªåŠ¨gc"></a>è‡ªåŠ¨gc</h3><p>åœ¨zendæ•°æ®æ¥å£ä¸­æœ‰ä¸€ä¸ªgc.refount,ä»–æ˜¯è‡ªåŠ¨gcçš„å…³é”®ã€‚</p><p>åœ¨è‡ªåŠ¨gcæœºåˆ¶ä¸­,å¦‚æœzvalä¸åœ¨æŒ‡å‘valueä¸”å½“å‰valueçš„gc.refountä¸º0æ—¶,ä¼šç›´æ¥é‡Šæ”¾valueã€‚è¿™ç§æƒ…å†µå¤šå‘ç”Ÿäºå‡½æ•°è¿”å›æ—¶ï¼ˆé”€æ¯æ‰€æœ‰å±€éƒ¨å˜é‡ï¼‰ã€å˜é‡ä¿®æ”¹æ—¶ã€ä»¥åŠunsetæ“ä½œçš„æ—¶å€™ã€‚</p><h3 id="è¾£é¸¡å›æ”¶"><a href="#è¾£é¸¡å›æ”¶" class="headerlink" title="è¾£é¸¡å›æ”¶"></a>è¾£é¸¡å›æ”¶</h3><p>é™¤äº†è‡ªåŠ¨gc,è¿˜æœ‰ä¸€ç§æ˜¯è‡ªåŠ¨gcæ— æ³•å¤„ç†çš„åƒåœ¾, è¿™ç§æƒ…å†µç§°ä¸º<code>å¾ªç¯å¼•ç”¨</code>ã€‚é¡¾åæ€ä¹‰ä¹Ÿå°±æ˜¯è‡ªèº«å†…éƒ¨å˜é‡å¼•ç”¨äº†è‡ªèº«, è¿™ç§æƒ…å†µå¸¸å‡ºç°ä¸objectå’Œarrayã€‚å½“æˆ‘è¯¥å˜é‡zvalè¢«é”€æ¯æ˜¯, ä¸å…¶å¯¹åº”çš„value gc.refcount -1,<br>ä½†æ˜¯å› ä¸ºæœ‰è‡ªèº«å˜é‡æŒ‡å‘è‡ªèº«, æ‰€ä»¥å°±é™·å…¥äº†ä¸€ä¸ªå¾ªç¯:å¦‚æœä¸é”€æ¯è‡ªèº«å˜é‡ value gc.refcountå°±æ— æ³•è‡ªåŠ¨gc, åªæœ‰è‡ªåŠ¨gcæ‰ä¼šé”€æ¯valueã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$a = [<span class="number">1</span>];</div><div class="line">$a[] = &amp;$a;</div><div class="line"><span class="keyword">unset</span>($a);</div></pre></td></tr></table></figure><p><img src="/photo/img/phpå†…å­˜ç®¡ç†/è‡ªèº«å¼•ç”¨.png" alt="image"></p><p><code>unset($a)</code>æ‰§è¡Œä»¥å</p><p><img src="/photo/img/phpå†…å­˜ç®¡ç†/é‡Šæ”¾.png" alt="image"></p><p>ç”±äºä¸Šè¿°æƒ…å†µå¯¼è‡´æ— æ³•è‡ªåŠ¨gc,æ‰€ä»¥éœ€è¦å¼•å…¥å¦å¤–ä¸€é’Ÿåƒåœ¾å›æ”¶æœºåˆ¶-åƒåœ¾å›æ”¶å™¨ã€‚<br>ç°åœ¨ä¼šå­˜åœ¨ä¸¤ç§æƒ…å†µçš„æ•°æ®éœ€è¦å›æ”¶ï¼š</p><ul><li>å½“valueçš„gc.refcount =0 æ˜¯éœ€è¦å›æ”¶ã€‚</li><li>å½“valueçš„gc.refcount å‡å°‘ä¸ç­‰äº0ï¼Œä½†æ˜¯å­˜åœ¨å¾ªç¯å¼•ç”¨æ—¶ã€‚</li></ul><h3 id="å›æ”¶æœºåˆ¶"><a href="#å›æ”¶æœºåˆ¶" class="headerlink" title="å›æ”¶æœºåˆ¶"></a>å›æ”¶æœºåˆ¶</h3><p>å½“å‘ç”Ÿvalue gc.refcountå‡å°‘æ—¶ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶ä¼šæŠŠå¯èƒ½æ˜¯åƒåœ¾çš„valueå­˜èµ·æ¥ï¼Œ å½“å¯èƒ½æ˜¯è¾£é¸¡çš„valueåˆ°è¾¾ä¸€å®šæ•°é‡çš„æ—¶å€™å¯åŠ¨åƒåœ¾é‰´åˆ«ç¨‹åºï¼Œç»Ÿä¸€å¤„ç†åƒåœ¾ã€‚å½“ç„¶è¿™é‡Œçš„valueç±»å‹åªæœ‰objectå’Œarrayã€‚</p><p>åƒåœ¾å…¼å¤‡ç¨‹åºï¼š<br>å…¶å®åƒåœ¾é‰´åˆ«ç¨‹åºå¾ˆç®€å•ï¼Œé€’å½’éå†è‡ªèº«valueï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨æŒ‡å‘è‡ªèº«çš„å³å¯ã€‚</p><p>code:<br>gc åˆå§‹åŒ–<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">ZEND_API void gc_init(void)</div><div class="line">&#123;</div><div class="line"><span class="keyword">if</span> (GC_G(buf) == <span class="keyword">NULL</span> &amp;&amp; GC_G(gc_enabled)) &#123;</div><div class="line"><span class="comment">//åˆå§‹åŒ–bufå†…å­˜åŒºåŸŸï¼Œå¤§å°ä¸ºsizeof(gc_root_buffer) * //GC_ROOT_BUFFER_MAX_ENTRIES</span></div><div class="line">GC_G(buf) = (gc_root_buffer*) malloc(sizeof(gc_root_buffer) * GC_ROOT_BUFFER_MAX_ENTRIES);</div><div class="line"><span class="comment">//è®¾ç½®_zend_gc_globals.last_unusedä¸ºbugå…¥å£ä½ç½®</span></div><div class="line">GC_G(last_unused) = &amp;GC_G(buf)[GC_ROOT_BUFFER_MAX_ENTRIES];</div><div class="line"><span class="comment">//åˆå§‹åŒ–_zend_gc_globalsçš„å‚æ•°</span></div><div class="line">gc_reset();</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>åƒåœ¾å›æ”¶åŠå…¶ä¾èµ– <code>_zend_gc_globals</code></p><p><code>_zend_gc_globals</code><br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> _zend_gc_globals &#123;</div><div class="line">zend_bool         gc_enabled;</div><div class="line">zend_bool         gc_active;</div><div class="line">zend_bool         gc_full;</div><div class="line"></div><div class="line">gc_root_buffer   *buf;<span class="comment">/* preallocated arrays of buffers   */</span></div><div class="line">gc_root_buffer    roots;<span class="comment">/* list of possible roots of cycles */</span></div><div class="line">gc_root_buffer   *unused;<span class="comment">/* list of unused buffers           */</span></div><div class="line">gc_root_buffer   *first_unused;<span class="comment">/* pointer to first unused buffer   */</span></div><div class="line">gc_root_buffer   *last_unused;<span class="comment">/* pointer to last unused buffer    */</span></div><div class="line"></div><div class="line">gc_root_buffer    to_free;<span class="comment">/* list to free                     */</span></div><div class="line">gc_root_buffer   *next_to_free;</div><div class="line"></div><div class="line"><span class="keyword">uint32_t</span> gc_runs;</div><div class="line"><span class="keyword">uint32_t</span> collected;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">if</span> GC_BENCH</span></div><div class="line"><span class="keyword">uint32_t</span> root_buf_length;</div><div class="line"><span class="keyword">uint32_t</span> root_buf_peak;</div><div class="line"><span class="keyword">uint32_t</span> zval_possible_root;</div><div class="line"><span class="keyword">uint32_t</span> zval_buffered;</div><div class="line"><span class="keyword">uint32_t</span> zval_remove_from_buffer;</div><div class="line"><span class="keyword">uint32_t</span> zval_marked_grey;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"></div><div class="line">gc_additional_buffer *additional_buffer;</div><div class="line"></div><div class="line">&#125; zend_gc_globals;</div></pre></td></tr></table></figure></p><ul><li><code>gc_enabled</code> æ˜¯å¦ä½¿ä½¿ç”¨gc</li><li><code>gc_active</code>  æ˜¯å¦åœ¨åƒåœ¾æ£€æŸ¥çš„è¿‡ç¨‹ä¸­</li><li><code>gc_full</code> bufç¼“å†²åŒºæ˜¯å¦å·²æ»¡</li><li><code>*buf</code> ä¸åˆ†é…ç”¨äºä¿å­˜å¯èƒ½ä¸ºåƒåœ¾çš„value</li><li><code>roots</code> æŒ‡å‘bufæœ€æ–°åŠ å…¥çš„ä¸€ä¸ªå¯èƒ½åƒåœ¾</li><li><code>unused</code> æŒ‡å‘ç¬¬æœªä½¿ç”¨çš„buffer</li><li><code>*first_unused</code> æŒ‡å‘ç¬¬ä¸€ä¸ªæ²¡ç”¨ä½¿ç”¨buffer</li><li><code>*last_unused</code> æŒ‡å‘bufferçš„å°¾éƒ¨</li><li><code>to_free</code> ç­‰å¾…é‡Šæ”¾çš„buffer</li><li><code>gc_runs</code>  ç»Ÿè®¡gcè¿è¡Œçš„æ¬¡æ•°</li><li><code>collected</code>  ç»Ÿè®¡å·²ç»é‡Šæ”¾çš„åƒåœ¾æ•°</li></ul><p>phpåƒåœ¾å›æ”¶ä¸­å‡ ä¸ªé‡è¦çš„é¢œè‰²å†™åœ¨zeng_gcçš„å¤‡æ³¨ä¸­ã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">* BLACK  (GC_BLACK)   - In use or <span class="built_in">free</span>.</div><div class="line">* GREY   (GC_GREY)    - Possible member of cycle.</div><div class="line">* WHITE  (GC_WHITE)   - Member of garbage cycle.</div><div class="line">* PURPLE (GC_PURPLE)  - Possible root of cycle.</div></pre></td></tr></table></figure></p><ul><li>GC_WHITE ç™½è‰²è¡¨ç¤ºåƒåœ¾</li><li>GC_PURPLE ç´«è‰²è¡¨ç¤ºå·²æ”¾å…¥ç¼“å†²åŒº</li><li>GC_GREY ç°è‰²è¡¨ç¤ºå·²ç»è¿›è¡Œäº†ä¸€æ¬¡refcountçš„å‡ä¸€æ“ä½œ</li><li>GC_BLACK é»‘è‰²æ˜¯é»˜è®¤é¢œè‰²ï¼Œæ­£å¸¸</li></ul><p>gcè¿‡ç¨‹ä¸­ä¸»è¦å¤„ç†åŠŸèƒ½çš„å‡½æ•°<code>zend_gc_collect_cycles</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="function">ZEND_API <span class="keyword">void</span> ZEND_FASTCALL <span class="title">gc_possible_root</span><span class="params">(zend_refcounted *ref)</span></span></div><div class="line">&#123;</div><div class="line">gc_root_buffer *newRoot;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (UNEXPECTED(CG(unclean_shutdown)) || UNEXPECTED(GC_G(gc_active))) &#123;</div><div class="line"><span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">ZEND_ASSERT(GC_TYPE(ref) == IS_ARRAY || GC_TYPE(ref) == IS_OBJECT);</div><div class="line">ZEND_ASSERT(EXPECTED(GC_REF_GET_COLOR(ref) == GC_BLACK));</div><div class="line">ZEND_ASSERT(!GC_ADDRESS(GC_INFO(ref)));</div><div class="line"></div><div class="line">GC_BENCH_INC(zval_possible_root);</div><div class="line"></div><div class="line">newRoot = GC_G(unused);</div><div class="line"><span class="keyword">if</span> (newRoot) &#123;</div><div class="line">GC_G(unused) = newRoot-&gt;prev;</div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (GC_G(first_unused) != GC_G(last_unused)) &#123;</div><div class="line">newRoot = GC_G(first_unused);</div><div class="line">GC_G(first_unused)++;</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line"><span class="comment">//åƒåœ¾å¤„ç†ï¼Œå½“ç¼“å†²åŒºæ»¡æ—¶ï¼Œç¨‹åºè°ƒç”¨gc_collect_cycleså‡½æ•°ï¼Œæ‰§è¡Œåƒåœ¾å›æ”¶æ“ä½œã€‚ å…¶ä¸­æœ€å…³é”®çš„å‡ æ­¥å°±æ˜¯</span></div><div class="line"><span class="comment">//å¦‚æœå½“å‰å¤„äºå¯ä»¥gcçš„çŠ¶æ€</span></div><div class="line"><span class="keyword">if</span> (!GC_G(gc_enabled)) &#123;</div><div class="line"><span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line">GC_REFCOUNT(ref)++;</div><div class="line"><span class="comment">//åƒåœ¾å›æ”¶</span></div><div class="line">gc_collect_cycles();</div><div class="line">GC_REFCOUNT(ref)--;</div><div class="line"><span class="keyword">if</span> (UNEXPECTED(GC_REFCOUNT(ref)) == <span class="number">0</span>) &#123;</div><div class="line">zval_dtor_func(ref);</div><div class="line"><span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (UNEXPECTED(GC_INFO(ref))) &#123;</div><div class="line"><span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line">newRoot = GC_G(unused);</div><div class="line"><span class="keyword">if</span> (!newRoot) &#123;</div><div class="line"><span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line">GC_G(unused) = newRoot-&gt;prev;</div><div class="line">&#125;</div><div class="line"></div><div class="line">GC_TRACE_SET_COLOR(ref, GC_PURPLE);</div><div class="line">GC_INFO(ref) = (newRoot - GC_G(buf)) | GC_PURPLE;</div><div class="line">newRoot-&gt;ref = ref;</div><div class="line"></div><div class="line">newRoot-&gt;next = GC_G(roots).next;</div><div class="line">newRoot-&gt;prev = &amp;GC_G(roots);</div><div class="line">GC_G(roots).next-&gt;prev = newRoot;</div><div class="line">GC_G(roots).next = newRoot;</div><div class="line"></div><div class="line">GC_BENCH_INC(zval_buffered);</div><div class="line">GC_BENCH_INC(root_buf_length);</div><div class="line">GC_BENCH_PEAK(root_buf_peak, root_buf_length);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>debugä»£ç å·²åˆ é™¤</p><ol><li>æ·±åº¦ä¼˜å…ˆå¯¹å¯¹è±¡æˆ–è€…æ•°æ®çš„æ¯ä¸€ä¸ªå…ƒç´ çš„<code>refcount--</code>å¹¶å°†å…¶æ ‡è®°ä¸ºç°è‰²</li><li>æ·±åº¦éå†rootçš„æ¯ä¸ªæ¯ä¸ªå˜é‡ï¼Œå¦‚æœæ­¤æ—¶å˜é‡çš„<code>refcount</code>ä¸º0ï¼Œåˆ™ä»£è¡¨ç€æ”¹å˜é‡ä¸ºåƒåœ¾ï¼Œå°†å…¶æ ‡è®°ä¸ºåƒåœ¾ï¼Œå¦‚æœä¸ä¸º0ï¼Œåˆ™å°†å…¶æ ‡è®°ä¸ºé»‘è‰²ï¼ˆæ­£å¸¸ï¼‰ã€‚</li><li>æ£€æŸ¥rootsæ¸…é™¤æ ‡è®°ä¸ºç™½è‰²çš„åƒåœ¾ã€‚</li></ol><p>//TODO åƒåœ¾å›æ”¶æŠ½å‡ºæ¥å‡ºæ¥å†™ã€‚</p><p>å…·ä½“ä»£ç ï¼š<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div></pre></td><td class="code"><pre><div class="line">ZEND_API int zend_gc_collect_cycles(void)</div><div class="line">&#123;</div><div class="line">int count = <span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (GC_G(roots).next != &amp;GC_G(roots)) &#123;</div><div class="line">gc_root_buffer *current, *next, *orig_next_to_free;</div><div class="line">zend_refcounted *p;</div><div class="line">gc_root_buffer to_free;</div><div class="line">uint32_t gc_flags = <span class="number">0</span>;</div><div class="line">gc_additional_buffer *additional_buffer_snapshot;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> (GC_G(gc_active)) &#123;</div><div class="line"><span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">GC_TRACE(<span class="string">"Collecting cycles"</span>);</div><div class="line"><span class="comment">//æ ‡è¯†gcè¿è¡Œäº†å¤šå°‘æ¬¡</span></div><div class="line">GC_G(gc_runs)++;</div><div class="line"><span class="comment">//æ ‡è¯†å½“å‰æ­£åœ¨gc</span></div><div class="line">GC_G(gc_active) = <span class="number">1</span>;</div><div class="line"></div><div class="line">GC_TRACE(<span class="string">"Marking roots"</span>);</div><div class="line"><span class="comment">//é‡ç‚¹</span></div><div class="line">gc_mark_roots();</div><div class="line">GC_TRACE(<span class="string">"Scanning roots"</span>);</div><div class="line"><span class="comment">//é‡ç‚¹</span></div><div class="line">gc_scan_roots();</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">GC_TRACE(<span class="string">"Collecting roots"</span>);</div><div class="line">additional_buffer_snapshot = GC_G(additional_buffer);</div><div class="line">count = gc_collect_roots(&amp;gc_flags);</div><div class="line"></div><div class="line">GC_G(gc_active) = <span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (GC_G(to_free).next == &amp;GC_G(to_free)) &#123;</div><div class="line"><span class="comment">/* nothing to free */</span></div><div class="line">GC_TRACE(<span class="string">"Nothing to free"</span>);</div><div class="line"><span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* Copy global to_free list into local list */</span></div><div class="line">to_free.next = GC_G(to_free).next;</div><div class="line">to_free.prev = GC_G(to_free).prev;</div><div class="line">to_free.next-&gt;prev = &amp;to_free;</div><div class="line">to_free.prev-&gt;next = &amp;to_free;</div><div class="line"></div><div class="line"><span class="comment">/* Free global list */</span></div><div class="line">GC_G(to_free).next = &amp;GC_G(to_free);</div><div class="line">GC_G(to_free).prev = &amp;GC_G(to_free);</div><div class="line"></div><div class="line">orig_next_to_free = GC_G(next_to_free);</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> (gc_flags &amp; GC_HAS_DESTRUCTORS) &#123;</div><div class="line">GC_TRACE(<span class="string">"Calling destructors"</span>);</div><div class="line"></div><div class="line"><span class="comment">/* Remember reference counters before calling destructors */</span></div><div class="line">current = to_free.next;</div><div class="line"><span class="keyword">while</span> (current != &amp;to_free) &#123;</div><div class="line">current-&gt;refcount = GC_REFCOUNT(current-&gt;ref);</div><div class="line">current = current-&gt;next;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* Call destructors */</span></div><div class="line">current = to_free.next;</div><div class="line"><span class="keyword">while</span> (current != &amp;to_free) &#123;</div><div class="line">p = current-&gt;ref;</div><div class="line">GC_G(next_to_free) = current-&gt;next;</div><div class="line"><span class="keyword">if</span> (GC_TYPE(p) == IS_OBJECT) &#123;</div><div class="line">zend_object *obj = (zend_object*)p;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (!(GC_FLAGS(obj) &amp; IS_OBJ_DESTRUCTOR_CALLED)) &#123;</div><div class="line">GC_TRACE_REF(obj, <span class="string">"calling destructor"</span>);</div><div class="line">GC_FLAGS(obj) |= IS_OBJ_DESTRUCTOR_CALLED;</div><div class="line"><span class="keyword">if</span> (obj-&gt;handlers-&gt;dtor_obj</div><div class="line"> &amp;&amp; (obj-&gt;handlers-&gt;dtor_obj != zend_objects_destroy_object</div><div class="line">  || obj-&gt;ce-&gt;destructor)) &#123;</div><div class="line">GC_REFCOUNT(obj)++;</div><div class="line">obj-&gt;handlers-&gt;dtor_obj(obj);</div><div class="line">GC_REFCOUNT(obj)--;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">current = GC_G(next_to_free);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* Remove values captured in destructors */</span></div><div class="line">current = to_free.next;</div><div class="line"><span class="keyword">while</span> (current != &amp;to_free) &#123;</div><div class="line">GC_G(next_to_free) = current-&gt;next;</div><div class="line"><span class="keyword">if</span> (GC_REFCOUNT(current-&gt;ref) &gt; current-&gt;refcount) &#123;</div><div class="line">gc_remove_nested_data_from_buffer(current-&gt;ref, current);</div><div class="line">&#125;</div><div class="line">current = GC_G(next_to_free);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* Destroy zvals */</span></div><div class="line">GC_TRACE(<span class="string">"Destroying zvals"</span>);</div><div class="line">GC_G(gc_active) = <span class="number">1</span>;</div><div class="line">current = to_free.next;</div><div class="line"><span class="keyword">while</span> (current != &amp;to_free) &#123;</div><div class="line">p = current-&gt;ref;</div><div class="line">GC_G(next_to_free) = current-&gt;next;</div><div class="line">GC_TRACE_REF(p, <span class="string">"destroying"</span>);</div><div class="line"><span class="keyword">if</span> (GC_TYPE(p) == IS_OBJECT) &#123;</div><div class="line">zend_object *obj = (zend_object*)p;</div><div class="line"></div><div class="line">EG(objects_store).object_buckets[obj-&gt;handle] = SET_OBJ_INVALID(obj);</div><div class="line">GC_TYPE(obj) = IS_NULL;</div><div class="line"><span class="keyword">if</span> (!(GC_FLAGS(obj) &amp; IS_OBJ_FREE_CALLED)) &#123;</div><div class="line">GC_FLAGS(obj) |= IS_OBJ_FREE_CALLED;</div><div class="line"><span class="keyword">if</span> (obj-&gt;handlers-&gt;free_obj) &#123;</div><div class="line">GC_REFCOUNT(obj)++;</div><div class="line">obj-&gt;handlers-&gt;free_obj(obj);</div><div class="line">GC_REFCOUNT(obj)--;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">SET_OBJ_BUCKET_NUMBER(EG(objects_store).object_buckets[obj-&gt;handle], EG(objects_store).free_list_head);</div><div class="line">EG(objects_store).free_list_head = obj-&gt;handle;</div><div class="line">p = current-&gt;ref = (zend_refcounted*)(((char*)obj) - obj-&gt;handlers-&gt;offset);</div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (GC_TYPE(p) == IS_ARRAY) &#123;</div><div class="line">zend_array *arr = (zend_array*)p;</div><div class="line"></div><div class="line">GC_TYPE(arr) = IS_NULL;</div><div class="line"></div><div class="line"><span class="comment">/* GC may destroy arrays with rc&gt;1. This is valid and safe. */</span></div><div class="line">HT_ALLOW_COW_VIOLATION(arr);</div><div class="line"></div><div class="line">zend_hash_destroy(arr);</div><div class="line">&#125;</div><div class="line">current = GC_G(next_to_free);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* Free objects */</span></div><div class="line">current = to_free.next;</div><div class="line"><span class="keyword">while</span> (current != &amp;to_free) &#123;</div><div class="line">next = current-&gt;next;</div><div class="line">p = current-&gt;ref;</div><div class="line"><span class="keyword">if</span> (EXPECTED(current &gt;= GC_G(buf) &amp;&amp; current &lt; GC_G(buf) + GC_ROOT_BUFFER_MAX_ENTRIES)) &#123;</div><div class="line">current-&gt;prev = GC_G(unused);</div><div class="line">GC_G(unused) = current;</div><div class="line">&#125;</div><div class="line">efree(p);</div><div class="line">current = next;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">while</span> (GC_G(additional_buffer) != additional_buffer_snapshot) &#123;</div><div class="line">gc_additional_buffer *next = GC_G(additional_buffer)-&gt;next;</div><div class="line">efree(GC_G(additional_buffer));</div><div class="line">GC_G(additional_buffer) = next;</div><div class="line">&#125;</div><div class="line"></div><div class="line">GC_TRACE(<span class="string">"Collection finished"</span>);</div><div class="line">GC_G(collected) += count;</div><div class="line">GC_G(next_to_free) = orig_next_to_free;</div><div class="line">GC_G(gc_active) = <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">return</span> count;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">gc_mark_roots</span><span class="params">(<span class="keyword">void</span>)</span></span></div><div class="line">&#123;</div><div class="line">gc_root_buffer *current = GC_G(roots).next;</div><div class="line"></div><div class="line"><span class="keyword">while</span> (current != &amp;GC_G(roots)) &#123;</div><div class="line"><span class="comment">//GC_PURPLE æ ‡è¯†åœ¨ç¼“å†²åŒº</span></div><div class="line"><span class="keyword">if</span> (GC_REF_GET_COLOR(current-&gt;ref) == GC_PURPLE) &#123;</div><div class="line">gc_mark_grey(current-&gt;ref);</div><div class="line">&#125;</div><div class="line">current = current-&gt;next;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">gc_mark_grey</span><span class="params">(zend_refcounted *ref)</span></span></div><div class="line">&#123;</div><div class="line">    HashTable *ht;</div><div class="line">Bucket *p, *end;</div><div class="line">zval *zv;</div><div class="line"></div><div class="line">tail_call:</div><div class="line"><span class="keyword">if</span> (GC_REF_GET_COLOR(ref) != GC_GREY) &#123;</div><div class="line">ht = <span class="literal">NULL</span>;</div><div class="line">GC_BENCH_INC(zval_marked_grey);</div><div class="line">GC_REF_SET_COLOR(ref, GC_GREY);</div><div class="line"></div><div class="line"><span class="keyword">if</span> (GC_TYPE(ref) == IS_OBJECT) &#123;</div><div class="line"><span class="keyword">zend_object_get_gc_t</span> get_gc;</div><div class="line">zend_object *obj = (zend_object*)ref;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (EXPECTED(!(GC_FLAGS(ref) &amp; IS_OBJ_FREE_CALLED) &amp;&amp;</div><div class="line">                 (get_gc = obj-&gt;handlers-&gt;get_gc) != <span class="literal">NULL</span>)) &#123;</div><div class="line"><span class="keyword">int</span> n;</div><div class="line">zval *zv, *end;</div><div class="line">zval tmp;</div><div class="line"></div><div class="line">ZVAL_OBJ(&amp;tmp, obj);</div><div class="line">ht = get_gc(&amp;tmp, &amp;zv, &amp;n);</div><div class="line">end = zv + n;</div><div class="line"><span class="keyword">if</span> (EXPECTED(!ht)) &#123;</div><div class="line"><span class="keyword">if</span> (!n) <span class="keyword">return</span>;</div><div class="line"><span class="keyword">while</span> (!Z_REFCOUNTED_P(--end)) &#123;</div><div class="line"><span class="comment">//è¡¨æ˜å½“å‰object sizeä¸º0</span></div><div class="line"><span class="keyword">if</span> (zv == end) <span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">while</span> (zv != end) &#123;</div><div class="line"><span class="comment">//å¾ªç¯å¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œ--</span></div><div class="line"><span class="keyword">if</span> (Z_REFCOUNTED_P(zv)) &#123;</div><div class="line">ref = Z_COUNTED_P(zv);</div><div class="line">GC_REFCOUNT(ref)--;</div><div class="line"><span class="comment">//refcountå·²ç»å‡è¿‡ï¼Œæ ‡è®°ä¸ºç°è‰²</span></div><div class="line">gc_mark_grey(ref);</div><div class="line">&#125;</div><div class="line">zv++;</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (EXPECTED(!ht)) &#123;</div><div class="line">ref = Z_COUNTED_P(zv);</div><div class="line">GC_REFCOUNT(ref)--;</div><div class="line"><span class="keyword">goto</span> tail_call;</div><div class="line">&#125;</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line"><span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (GC_TYPE(ref) == IS_ARRAY) &#123;</div><div class="line"><span class="keyword">if</span> (((zend_array*)ref) == &amp;EG(symbol_table)) &#123;</div><div class="line"><span class="comment">//æ ‡è¯†æ˜¯æ­£å¸¸éåƒåœ¾</span></div><div class="line">GC_REF_SET_BLACK(ref);</div><div class="line"><span class="keyword">return</span>;</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">ht = (zend_array*)ref;</div><div class="line">&#125;</div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (GC_TYPE(ref) == IS_REFERENCE) &#123;</div><div class="line"><span class="keyword">if</span> (Z_REFCOUNTED(((zend_reference*)ref)-&gt;val)) &#123;</div><div class="line">ref = Z_COUNTED(((zend_reference*)ref)-&gt;val);</div><div class="line">GC_REFCOUNT(ref)--;</div><div class="line"><span class="keyword">goto</span> tail_call;</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span>;</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line"><span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (!ht-&gt;nNumUsed) <span class="keyword">return</span>;</div><div class="line">p = ht-&gt;arData;</div><div class="line">end = p + ht-&gt;nNumUsed;</div><div class="line"><span class="keyword">while</span> (<span class="number">1</span>) &#123;</div><div class="line">end--;</div><div class="line">zv = &amp;end-&gt;val;</div><div class="line"><span class="keyword">if</span> (Z_TYPE_P(zv) == IS_INDIRECT) &#123;</div><div class="line">zv = Z_INDIRECT_P(zv);</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (Z_REFCOUNTED_P(zv)) &#123;</div><div class="line"><span class="keyword">break</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (p == end) <span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">while</span> (p != end) &#123;</div><div class="line">zv = &amp;p-&gt;val;</div><div class="line"><span class="keyword">if</span> (Z_TYPE_P(zv) == IS_INDIRECT) &#123;</div><div class="line">zv = Z_INDIRECT_P(zv);</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (Z_REFCOUNTED_P(zv)) &#123;</div><div class="line">ref = Z_COUNTED_P(zv);</div><div class="line">GC_REFCOUNT(ref)--;</div><div class="line">gc_mark_grey(ref);</div><div class="line">&#125;</div><div class="line">p++;</div><div class="line">&#125;</div><div class="line">zv = &amp;p-&gt;val;</div><div class="line"><span class="keyword">if</span> (Z_TYPE_P(zv) == IS_INDIRECT) &#123;</div><div class="line">zv = Z_INDIRECT_P(zv);</div><div class="line">&#125;</div><div class="line">ref = Z_COUNTED_P(zv);</div><div class="line">GC_REFCOUNT(ref)--;</div><div class="line"><span class="keyword">goto</span> tail_call;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">gc_scan</span><span class="params">(zend_refcounted *ref)</span></span></div><div class="line">&#123;</div><div class="line">    HashTable *ht;</div><div class="line">Bucket *p, *end;</div><div class="line">zval *zv;</div><div class="line"></div><div class="line">tail_call:</div><div class="line"><span class="keyword">if</span> (GC_REF_GET_COLOR(ref) == GC_GREY) &#123;</div><div class="line"><span class="keyword">if</span> (GC_REFCOUNT(ref) &gt; <span class="number">0</span>) &#123;</div><div class="line"><span class="comment">//æ‰€æœ‰refount--ä»¥åå¦‚æœè¿˜&gt;0ï¼Œè¯´æ˜éåƒåœ¾</span></div><div class="line">gc_scan_black(ref);</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line"><span class="comment">//å¦åˆ™åˆ™ä¸ºåƒåœ¾</span></div><div class="line">GC_REF_SET_COLOR(ref, GC_WHITE);</div><div class="line"><span class="keyword">if</span> (GC_TYPE(ref) == IS_OBJECT) &#123;</div><div class="line"><span class="keyword">zend_object_get_gc_t</span> get_gc;</div><div class="line">zend_object *obj = (zend_object*)ref;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (EXPECTED(!(GC_FLAGS(ref) &amp; IS_OBJ_FREE_CALLED) &amp;&amp;</div><div class="line">             (get_gc = obj-&gt;handlers-&gt;get_gc) != <span class="literal">NULL</span>)) &#123;</div><div class="line"><span class="keyword">int</span> n;</div><div class="line">zval *zv, *end;</div><div class="line">zval tmp;</div><div class="line"></div><div class="line">ZVAL_OBJ(&amp;tmp, obj);</div><div class="line">ht = get_gc(&amp;tmp, &amp;zv, &amp;n);</div><div class="line">end = zv + n;</div><div class="line"><span class="keyword">if</span> (EXPECTED(!ht)) &#123;</div><div class="line"><span class="keyword">if</span> (!n) <span class="keyword">return</span>;</div><div class="line"><span class="keyword">while</span> (!Z_REFCOUNTED_P(--end)) &#123;</div><div class="line"><span class="keyword">if</span> (zv == end) <span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">while</span> (zv != end) &#123;</div><div class="line"><span class="keyword">if</span> (Z_REFCOUNTED_P(zv)) &#123;</div><div class="line">ref = Z_COUNTED_P(zv);</div><div class="line">gc_scan(ref);</div><div class="line">&#125;</div><div class="line">zv++;</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (EXPECTED(!ht)) &#123;</div><div class="line">ref = Z_COUNTED_P(zv);</div><div class="line"><span class="keyword">goto</span> tail_call;</div><div class="line">&#125;</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line"><span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (GC_TYPE(ref) == IS_ARRAY) &#123;</div><div class="line"><span class="keyword">if</span> ((zend_array*)ref == &amp;EG(symbol_table)) &#123;</div><div class="line">GC_REF_SET_BLACK(ref);</div><div class="line"><span class="keyword">return</span>;</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">ht = (zend_array*)ref;</div><div class="line">&#125;</div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (GC_TYPE(ref) == IS_REFERENCE) &#123;</div><div class="line"><span class="keyword">if</span> (Z_REFCOUNTED(((zend_reference*)ref)-&gt;val)) &#123;</div><div class="line">ref = Z_COUNTED(((zend_reference*)ref)-&gt;val);</div><div class="line"><span class="keyword">goto</span> tail_call;</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span>;</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line"><span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (!ht-&gt;nNumUsed) <span class="keyword">return</span>;</div><div class="line">p = ht-&gt;arData;</div><div class="line">end = p + ht-&gt;nNumUsed;</div><div class="line"><span class="keyword">while</span> (<span class="number">1</span>) &#123;</div><div class="line">end--;</div><div class="line">zv = &amp;end-&gt;val;</div><div class="line"><span class="keyword">if</span> (Z_TYPE_P(zv) == IS_INDIRECT) &#123;</div><div class="line">zv = Z_INDIRECT_P(zv);</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (Z_REFCOUNTED_P(zv)) &#123;</div><div class="line"><span class="keyword">break</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (p == end) <span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">while</span> (p != end) &#123;</div><div class="line">zv = &amp;p-&gt;val;</div><div class="line"><span class="keyword">if</span> (Z_TYPE_P(zv) == IS_INDIRECT) &#123;</div><div class="line">zv = Z_INDIRECT_P(zv);</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (Z_REFCOUNTED_P(zv)) &#123;</div><div class="line">ref = Z_COUNTED_P(zv);</div><div class="line">gc_scan(ref);</div><div class="line">&#125;</div><div class="line">p++;</div><div class="line">&#125;</div><div class="line">zv = &amp;p-&gt;val;</div><div class="line"><span class="keyword">if</span> (Z_TYPE_P(zv) == IS_INDIRECT) &#123;</div><div class="line">zv = Z_INDIRECT_P(zv);</div><div class="line">&#125;</div><div class="line">ref = Z_COUNTED_P(zv);</div><div class="line"><span class="keyword">goto</span> tail_call;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>ä¸»è¦ä¸ºä¸‰ä¸ªå‡½æ•°ï¼š</p><ul><li><code>gc_mark_roots</code>é˜Ÿè§„éå†ï¼Œå¯¹objectã€arrayæ‰€æœ‰å…ƒç´ çš„refcountâ€“å¹¶å°†å…¶æ ‡è®°ä¸ºç°è‰²</li><li><code>gc_scan_roots</code>è¿™ä¸ªå‡½æ•°å¯¹èŠ‚ç‚¹ä¿¡æ¯çš„é“¾è¡¨å†æ¬¡è¿›è¡Œæ·±åº¦ä¼˜å…ˆéå†ï¼Œå¦‚æœå‘ç°zvalçš„refcountå¤§äºç­‰äº1ï¼Œåˆ™å¯¹è¯¥zvalå’Œå…¶åŒ…å«çš„zvalçš„refcountåŠ 1æ“ä½œï¼Œè¿™ä¸ªæ˜¯å¯¹éåƒåœ¾çš„ä¸€ä¸ªä¿¡æ¯è¿˜åŸï¼Œç„¶åå°†è¿™äº›zvalé¢œè‰²å±æ€§å»æ‰(è®¾ç½®æˆblack)ã€‚å¦‚æœå‘ç°zvalçš„refcountç­‰äº0ï¼Œåˆ™å°±æ ‡è®°æˆç™½è‰²ï¼Œè¿™äº›æ˜¯åé¢å°†è¦æ¸…ç†æ‰çš„åƒåœ¾ã€‚</li><li><code>gc_collect_roots</code> éå†èŠ‚ç‚¹ä¿¡æ¯é“¾è¡¨,å°†å‰é¢ä¸€ä¸ªæ­¥éª¤ä¸­æ ‡è®°ä¸ºç™½è‰²çš„èŠ‚ç‚¹ä¿¡æ¯æ”¾åˆ°GC_G(zval_to_free)ä¸ºå…¥å£çš„é“¾è¡¨ä¸­ï¼Œè¿™ä¸ªé“¾è¡¨ç”¨æ¥å­˜æ”¾å°†è¦é‡Šæ”¾çš„åƒåœ¾ã€‚ ç„¶åé‡Šæ”¾æ‰å…¨éƒ¨çš„èŠ‚ç‚¹ä¿¡æ¯ï¼Œç¼“å†²åŒºè¢«æ¸…ç©ºã€‚åˆ†æç»“æŸåå°†é‡æ–°æ”¶é›†èŠ‚ç‚¹ä¿¡æ¯ã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;phpæ˜¯å¦‚ä½•å®ç°å†…å­˜ç®¡ç†çš„?å†…å­˜ç®¡ç†æ— éåŒ…æ‹¬å†…å­˜åˆ†é…ã€å†…å­˜å›æ”¶ã€ä»¥åŠå†…å­˜ä½¿ç”¨ä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†…å­˜ä½¿ç”¨çš„ä¼˜åŒ–&lt;/li&gt;
&lt;li&gt;åƒåœ¾å›æ”¶æœºåˆ¶&lt;/li&gt;
&lt;li&gt;åº•å±‚å†…å­˜åˆ†é…&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;å†…å­˜ä½¿ç”¨çš„ä¼˜åŒ–&quot;&gt;&lt;a href=&quot;#å†…å­˜ä½¿ç”¨
      
    
    </summary>
    
      <category term="phpæºç å­¦ä¹ " scheme="http://yoursite.com/categories/php%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="phpæºç " scheme="http://yoursite.com/tags/php%E6%BA%90%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>å¾®æœåŠ¡æ•°æ®ä¸€è‡´æ€§å’ŒæœåŠ¡å¯é æ€§</title>
    <link href="http://yoursite.com/2018/09/12/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7%E5%92%8C%E6%9C%8D%E5%8A%A1%E5%8F%AF%E9%9D%A0%E6%80%A7/"/>
    <id>http://yoursite.com/2018/09/12/å¾®æœåŠ¡æ•°æ®ä¸€è‡´æ€§å’ŒæœåŠ¡å¯é æ€§/</id>
    <published>2018-09-12T13:28:00.000Z</published>
    <updated>2019-01-08T10:58:52.015Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/photo/img/2018-06-19/servicePic1.png" alt="image"></p><h2 id="å­˜åœ¨é—®é¢˜"><a href="#å­˜åœ¨é—®é¢˜" class="headerlink" title="å­˜åœ¨é—®é¢˜"></a>å­˜åœ¨é—®é¢˜</h2><p>  æˆ‘ä»¬çš„ä¿è¯é‡‘æœåŠ¡ç°æœ‰ç»“æ„æ˜¯è¿™ä¸ªæ ·å­ã€‚<br>åœ¨ 1ã€2ã€3ã€4ã€5ã€6 å„ä¸ªé˜¶æ®µéƒ½ä¼šå­˜åœ¨è¶…æ—¶å’Œå¼‚å¸¸é—®é¢˜ï¼Œå½“è´Ÿè½½å°‘æ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ‰‹åŠ¨äººå·¥å¤„ç†ï¼Œä½†æ˜¯å½“æ•°æ®é‡å¤§çš„æ—¶å€™ï¼Œé—®é¢˜æˆ–å¤šçš„ä»¤äººå‘æŒ‡ï¼Œæ²‰æµ¸äºæ´—æ•°æ®ï¼Œæ— æ³•è‡ªæ‹”ã€‚ã€‚<br>è¶…æ—¶å­˜åœ¨é—®é¢˜ï¼š<br>1.å½“1ã€2ã€3 æ­¥éª¤è¶…æ—¶æ—¶ï¼Œä¸‹æ¸¸æœåŠ¡å¯ä»¥å¿½ç•¥ï¼Œå½“åšæ‰§è¡Œå¤±è´¥ï¼Œé‡è¯•ã€‚<br>2.å½“åœ¨ç¯èŠ‚4ã€5ã€6è¶…æ—¶æ—¶ï¼Œå¯¹äºä¸‹æ¸¸æœåŠ¡æ˜¯ä¹Ÿæ˜¯æ‰§è¡Œå¤±è´¥ï¼Œä½†æ˜¯è¿˜å¯ä»¥é‡è¯•ä¹ˆï¼Ÿ</p><h2 id="å¦‚ä½•æé«˜æœåŠ¡å¯é æ€§"><a href="#å¦‚ä½•æé«˜æœåŠ¡å¯é æ€§" class="headerlink" title="å¦‚ä½•æé«˜æœåŠ¡å¯é æ€§"></a>å¦‚ä½•æé«˜æœåŠ¡å¯é æ€§</h2><p>å¯¹äºä¸Šæ¸¸æœåŠ¡ï¼Œå¦‚ä½•ä¿è¯å¯¹ä¸‹æ¸¸æä¾›å¯é çš„æœåŠ¡ã€‚</p><h3 id="è¡¥å¿æœºåˆ¶"><a href="#è¡¥å¿æœºåˆ¶" class="headerlink" title="è¡¥å¿æœºåˆ¶"></a>è¡¥å¿æœºåˆ¶</h3><p> <img src="/photo/img/2018-06-19/servicePic5.png" alt="image"><br> åœ¨æœåŠ¡é—´çš„è°ƒç”¨å¤±è´¥æ—¶ï¼Œå¯ä»¥è®°å½•å¤±è´¥è°ƒç”¨ï¼Œå¦‚é˜Ÿåˆ—ï¼Œæ¶ˆè´¹é‡è¯•ã€‚ä½†æ˜¯å‰æä¸€å®šæ˜¯æ¥å£å¹‚ç­‰ã€‚<br> ä½†æ˜¯è¿™æ ·å¹¶ä¸èƒ½è§£å†³æ ¹æœ¬æ€§é—®é¢˜ï¼Œå¦‚æœæˆ‘ä»¬åœ¨è°ƒç”¨ä¿è¯é‡‘å†»ç»“æœåŠ¡æ—¶ï¼Œå¤±è´¥æ­¤æ—¶æˆ‘ä»¬å†»ç»“æ—¶æŠ¥æ“ä½œå…¥é˜Ÿåˆ—ï¼Œè®©é˜Ÿåˆ—å¼‚æ­¥æ¶ˆè´¹ï¼Œå¦‚æœæ­¤æ—¶è¦è§£å†»ä¿è¯é‡‘ï¼Œå°±ä¼šå‡ºç°ä¸šåŠ¡å¼‚å¸¸ã€‚</p><p> <strong>æ‰€ä»¥</strong>è¡¥å¿æœºåˆ¶å»ºè®®ä½¿ç”¨åœ¨ <code>ä¸å¯é¿å…çš„ä¸šåŠ¡å¼‚å¸¸æƒ…å†µä¸‹ä½¿ç”¨</code>ï¼Œæˆ‘ä»¬åº”è¯¥å°½å¯èƒ½çš„ä¼˜åŒ–æŠ€æœ¯æ–¹æ¡ˆï¼Œæ¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œæœ€åå†é‡‡ç”¨è¡¥å¿æœºåˆ¶ã€‚</p><h3 id="ä¸¤æ®µæäº¤åè®®ï¼ˆ2pcï¼‰"><a href="#ä¸¤æ®µæäº¤åè®®ï¼ˆ2pcï¼‰" class="headerlink" title="ä¸¤æ®µæäº¤åè®®ï¼ˆ2pcï¼‰"></a>ä¸¤æ®µæäº¤åè®®ï¼ˆ2pcï¼‰</h3><p><img src="/photo/img/2018-06-19/servicePic4.png" alt="image"></p><p>preOperation æ‰§è¡Œè¯·æ±‚ï¼Œåœ¨è°ƒç”¨å¾®æœåŠ¡å‰ï¼Œæ‰§è¡Œé¢„æ“ä½œæˆåŠŸåˆ™è¡¨ç¤ºæ­¤æ¬¡æ“ä½œå¯è¡Œã€‚<br>å¦‚æœcommitå¤±è´¥è¯¥å¦‚ä½•å¤„ç†ï¼Ÿé‡æ–°preOperetionå˜›ï¼Ÿå¦‚æœæ¥å£å¹‚ç­‰æ˜¯å¦å¯ä»¥é‡å¤ï¼Œcommitï¼Ÿå¦‚ä½•ä¿è¯é¿å…é‡å¤æäº¤ï¼Ÿ<br>åœ¨preOperationæ—¶ï¼Œè¿”å›å”¯ä¸€æ“ä½œIDï¼Œä¸šåŠ¡é€»è¾‘æ¯ä¸ªæ“ä½œå¯¹åº”ä¸€ä¸ªæ“ä½œIDï¼Œcommitå¤±è´¥å°±é‡è¯•ï¼Œå½“ç„¶å‰ææ˜¯æˆ‘ä»¬çš„ä¸Šæœ‰æœåŠ¡æ¥å£å¹‚ç­‰ã€‚</p><p><img src="/photo/img/2018-06-19/servicePic3.png" alt="image"><br>å³ä½¿æ˜¯è¿™æ ·ä¹Ÿä¼šå­˜åœ¨é—®é¢˜ï¼Œå¦‚æœä¿è¯é‡‘é¢„æ“ä½œæˆåŠŸï¼Œä½†æ˜¯æ‰§è¡Œä¸€ç›´å¤±è´¥å‘¢ï¼Ÿæˆ‘ä»¬å¿…é¡»æä¾›å›æ»šæœºåˆ¶ã€‚<br><img src="/photo/img/2018-06-19/servicePic2.png" alt="image"></p><ol><li>å¤§é‡åŒæ­¥RPCä¾èµ–ï¼Œå¦‚ä½•ä¿è¯è‡ªèº«æœåŠ¡å¯é æ€§ï¼Ÿ<br>  æœåŠ¡ä¹‹é—´åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œä¼šå­˜åœ¨å¤§é‡å¼‚å¸¸ã€è¶…æ—¶ã€‚æˆ‘è¯¥å¦‚ä½•å¤„ç†ï¼Œè®¤ä¸ºè¿™æ¬¡æ˜¯å¤±è´¥çš„ï¼Ÿè¿˜æ˜¯æˆåŠŸçš„ï¼Ÿå¦‚æœä¾èµ–çš„æœåŠ¡è¿”å›æˆåŠŸï¼Œæ‰ç®—æˆåŠŸçš„è¯ï¼Œæˆ‘æ”¹å¦‚ä½•ä¿è¯æœåŠ¡å¯é æ€§ï¼Œè¯¥å¦‚ä½•å¯¹æˆ‘çš„ä¸‹æ¸¸æœåŠ¡æä¾›å¯é çš„æœåŠ¡ã€‚</li><li>è°ƒç”¨ä¾èµ–æœåŠ¡å¤±è´¥ï¼Œå¦‚ä½•é™çº§å¤„ç†ï¼Ÿ<br>  åœ¨æœåŠ¡è°ƒç”¨å¤±è´¥çš„æ—¶å€™ï¼Œæˆ‘çš„ä¸Šæ¸¸å‡ºé”™äº†ï¼Œæˆ‘è¯¥å¦‚ä½•é™çº§å¤„ç†ï¼Œæˆ‘è¯¥é‡è¯•ï¼Ÿè¿˜æ˜¯ç›´æ¥è·³è¿‡ï¼Œè·³è¿‡åæ˜¯å¦ä¼šé€ æˆå¾®æœåŠ¡ä¹‹é—´æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚å¦‚æœé‡è¯•æ˜¯å¦ä¼šé€ æˆé‡å¤æäº¤ï¼Œæ¥å£æ˜¯å¦å¹‚ç­‰ï¼Ÿ</li><li>æ˜¯å¦è¿˜æ¬ ç¼ºå›æ»šæœºåˆ¶ï¼Ÿ </li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;/photo/img/2018-06-19/servicePic1.png&quot; alt=&quot;image&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;å­˜åœ¨é—®é¢˜&quot;&gt;&lt;a href=&quot;#å­˜åœ¨é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;å­˜åœ¨é—®é¢˜&quot;&gt;&lt;/a&gt;å­˜åœ¨é—®é¢˜&lt;
      
    
    </summary>
    
      <category term="å¾®æœåŠ¡" scheme="http://yoursite.com/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    
      <category term="å¾®æœåŠ¡" scheme="http://yoursite.com/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>phpé—­åŒ…</title>
    <link href="http://yoursite.com/2018/08/25/php%E9%97%AD%E5%8C%85/"/>
    <id>http://yoursite.com/2018/08/25/phpé—­åŒ…/</id>
    <published>2018-08-25T06:50:55.000Z</published>
    <updated>2019-01-08T10:56:58.022Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨çœ‹guzzleåŒ…çš„æ—¶å€™çœ‹å¤§åˆ°äº†ä¸€æ®µæœ‰æ„æ€çš„ä»£ç , ç®€åŒ–ä»¥åç±»ä¼¼äºä¸‹è¾¹:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="comment">/**</span></div><div class="line">* </div><div class="line">*/</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span> </span></div><div class="line">&#123;</div><div class="line"><span class="keyword">public</span>  $handler;</div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(callable $handler = null)</span></span></div><div class="line">&#123;</div><div class="line"><span class="keyword">$this</span>-&gt;handler = $handler;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">create</span><span class="params">(callable $handler)</span></span></div><div class="line">&#123;</div><div class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">self</span>($handler);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span><span class="params">($request,$options)</span></span></div><div class="line">&#123;</div><div class="line">$func = <span class="keyword">$this</span>-&gt;handler;</div><div class="line">    <span class="keyword">return</span> $func($request, $options);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test1</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line"><span class="keyword">return</span> [<span class="keyword">$this</span>, <span class="string">'exec1'</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">exec1</span><span class="params">($a,$b)</span></span></div><div class="line">&#123;</div><div class="line"><span class="keyword">echo</span> ($a+$b);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$test = <span class="keyword">new</span> test();</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">$obj = test::create($test-&gt;test1());</div><div class="line"></div><div class="line">$obj(<span class="number">1</span>,<span class="number">4</span>);</div></pre></td></tr></table></figure><ul><li>phpæ–‡æ¡£æ˜¯è¿™æ ·æè¿°é—­åŒ…çš„</li></ul><p>`PHPæ˜¯å°†å‡½æ•°ä»¥stringå½¢å¼ä¼ é€’çš„ã€‚ å¯ä»¥ä½¿ç”¨ä»»ä½•å†…ç½®æˆ–ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼Œä½†é™¤äº†è¯­è¨€ç»“æ„ä¾‹å¦‚ï¼šarray()ï¼Œechoï¼Œempty()ï¼Œeval()ï¼Œexit()ï¼Œisset()ï¼Œlist()ï¼Œprint æˆ– unset()ã€‚</p><p> ä¸€ä¸ªå·²å®ä¾‹åŒ–çš„ object çš„æ–¹æ³•è¢«ä½œä¸º array ä¼ é€’ï¼Œä¸‹æ ‡ 0 åŒ…å«è¯¥ objectï¼Œä¸‹æ ‡ 1 åŒ…å«æ–¹æ³•åã€‚ åœ¨åŒä¸€ä¸ªç±»é‡Œå¯ä»¥è®¿é—® protected å’Œ private æ–¹æ³•ã€‚</p><p> é™æ€ç±»æ–¹æ³•ä¹Ÿå¯ä¸ç»å®ä¾‹åŒ–è¯¥ç±»çš„å¯¹è±¡è€Œä¼ é€’ï¼Œåªè¦åœ¨ä¸‹æ ‡ 0 ä¸­åŒ…å«ç±»åè€Œä¸æ˜¯å¯¹è±¡ã€‚è‡ª PHP 5.2.3 èµ·ï¼Œä¹Ÿå¯ä»¥ä¼ é€’ â€˜ClassName::methodNameâ€™ã€‚</p><p> é™¤äº†æ™®é€šçš„ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°å¤–ï¼Œä¹Ÿå¯ä¼ é€’ åŒ¿åå‡½æ•° ç»™å›è°ƒå‚æ•°ã€‚`</p><p> é™¤äº†ä¸Šè¾¹çš„è¿™äº›å¯ä»¥ä½œä¸ºcallableå‚æ•°çš„ç±»å‹,è¿˜æœ‰ä¸€ä¸ªæ˜¯æ‹¥æœ‰__invoke()çš„å®ä¾‹åŒ–å¯¹è±¡ã€‚</p><p>æ‰€ä»¥å®ä¾‹åŒ–çš„å¯¹è±¡å¯ä»¥ä½¿ç”¨ <code>[$obj,&#39;functionName&#39;]</code> å½“åšé—­åŒ…å»ä¼ é€’ã€‚<br><code>$obj = test::create($test-&gt;test1());</code>å°†æˆ‘ä»¬çš„<code>test1</code>æ–¹æ³•èµ‹å€¼ç»™æ–°å®ä¾‹åŒ–çš„å¯¹è±¡é‡Œã€‚</p><ul><li>é­”æœ¯æ–¹æ³•<code>__invoke()</code>è¡¨ç¤º:</li></ul><p>å½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œ__invoke() æ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬è°ƒç”¨<code>$obj()</code>å‡½æ•°æ—¶ä¼šè°ƒç”¨åˆ°__invoke()é‡Œ,æœ€åè°ƒç”¨åˆ°æˆ‘ä»¬ä¸€å¼€å§‹æ³¨å†Œçš„å‡½æ•°ã€‚</p><p>ps<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">class test </div><div class="line">&#123;</div><div class="line">public  $handler;</div><div class="line">public function __construct(callable $handler = null)</div><div class="line">&#123;</div><div class="line">$this-&gt;handler = $handler;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public static function create(callable $handler)</div><div class="line">&#123;</div><div class="line">return new self($handler);</div><div class="line">&#125;</div><div class="line"></div><div class="line">public function __invoke($request,$options)</div><div class="line">&#123;</div><div class="line">$func = $this-&gt;handler;</div><div class="line">    return $func($request, $options);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">public function test1()</div><div class="line">&#123;</div><div class="line">return [$this, &apos;exec1&apos;];</div><div class="line">&#125;</div><div class="line"></div><div class="line">public function exec1($a,$b)</div><div class="line">&#123;</div><div class="line">echo ($a+$b);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$test = new test();</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">$blj = test::create($test-&gt;test1());</div><div class="line">$blj(1,4);</div><div class="line">//æµ‹è¯•å¯¹è±¡æ˜¯å¦å¯ä»¥ä½œä¸ºcallableç±»å‹å‚æ•°</div><div class="line"></div><div class="line"></div><div class="line">$test = test::create(new test());</div></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åœ¨çœ‹guzzleåŒ…çš„æ—¶å€™çœ‹å¤§åˆ°äº†ä¸€æ®µæœ‰æ„æ€çš„ä»£ç , ç®€åŒ–ä»¥åç±»ä¼¼äºä¸‹è¾¹:&lt;/p&gt;
&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div c
      
    
    </summary>
    
      <category term="php" scheme="http://yoursite.com/categories/php/"/>
    
    
      <category term="php" scheme="http://yoursite.com/tags/php/"/>
    
  </entry>
  
  <entry>
    <title>phpæ•°ç»„å®ç°</title>
    <link href="http://yoursite.com/2018/08/20/php%E6%95%B0%E7%BB%84%E5%AE%9E%E7%8E%B0/"/>
    <id>http://yoursite.com/2018/08/20/phpæ•°ç»„å®ç°/</id>
    <published>2018-08-20T12:00:08.000Z</published>
    <updated>2019-01-08T10:55:28.931Z</updated>
    
    <content type="html"><![CDATA[<p>phpçš„æ•°ç»„ä¾èµ–äºhashtableå®ç°çš„ã€‚</p><p>Times33çš„ç®—æ³•å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸æ–­çš„ä¹˜33,ä¸‹è¾¹æ˜¯times33ç®—æ³•:</p><h2 id="Times33-hash"><a href="#Times33-hash" class="headerlink" title="Times33(hash)"></a>Times33(hash)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">myHash</span><span class="params">($str)</span> </span>&#123;</div><div class="line">    <span class="comment">// hash(i) = hash(i-1) * 33 + str[i]</span></div><div class="line">    $hash = <span class="number">5381</span>;</div><div class="line">    $s    = md5($str); <span class="comment">//ç›¸æ¯”å…¶å®ƒç‰ˆæœ¬ï¼Œè¿›è¡Œäº†md5åŠ å¯†</span></div><div class="line">    $seed = <span class="number">5</span>;</div><div class="line">    $len  = <span class="number">32</span>;<span class="comment">//åŠ å¯†åé•¿åº¦32</span></div><div class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $len; $i++) &#123;</div><div class="line">        <span class="comment">// (hash &lt;&lt; 5) + hash ç›¸å½“äº hash * 33</span></div><div class="line">        <span class="comment">//$hash = sprintf("%u", $hash * 33) + ord($s&#123;$i&#125;);</span></div><div class="line">        <span class="comment">//$hash = ($hash * 33 + ord($s&#123;$i&#125;)) &amp; 0x7FFFFFFF;</span></div><div class="line">        $hash = ($hash &lt;&lt; $seed) + $hash + ord($s&#123;$i&#125;);</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="keyword">return</span> $hash &amp; <span class="number">0x7FFFFFFF</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>å…¶ä¸­<code>&lt;&lt;</code> è¡¨ç¤ºå·¦ç§»,æ¯æ¬¡å·¦ç§»è¡¨ç¤ºx2ä¾‹å¦‚:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">$num = <span class="number">2</span>;</div><div class="line"></div><div class="line"><span class="keyword">echo</span> $num &lt;&lt; <span class="number">2</span>;</div></pre></td></tr></table></figure><p>æ‰€ä»¥($hash &lt;&lt; $seed)è¡¨ç¤º <code>$hash * 32</code> ,åŒæ—¶åŠ ä¸Š$hash,ä¹Ÿå°±è¡¨ç¤º <code>$hash * 33</code>äº†ã€‚ord()å‡½æ•°è¿”å›å­—ç¬¦ä¸²çš„é¦–ä¸ªå­—ç¬¦çš„ ASCII å€¼ã€‚<br>æœ€å<code>$hash &amp; 0x7FFFFFFF</code> è¡¨ç¤ºä¸æ•´å½¢çš„æœ€å¤§å€¼ä¸æ“ä½œ(<code>0x7FFFF111FFF</code>äºŒè¿›åˆ¶ä¸º<code>1111111111111111111111111111</code>),<br>è¿™ä¸ªä¸æ“ä½œä¼šæˆªå–è¶…è¿‡æ•´å½¢äºŒè¿›åˆ¶éƒ¨åˆ†,æ‰€ä»¥times33è®¡ç®—å‡ºæ¥çš„å€¼ä¸ä¼šè¶…è¿‡æ•´å½¢çš„æœ€å¤§å€¼ã€‚</p><h2 id="ä¸ºä»€ä¹ˆè¦ç”¨hashtableå®ç°phpæ•°ç»„"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨hashtableå®ç°phpæ•°ç»„" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨hashtableå®ç°phpæ•°ç»„?"></a>ä¸ºä»€ä¹ˆè¦ç”¨hashtableå®ç°phpæ•°ç»„?</h2><p>å› ä¸ºæ•£åˆ—è¡¨æ˜¯æ ¹æ®å…³é”®å»ºç å€¼ç›´æ¥è¿›é¡¹è®¿é—®çš„æ•°æ®ç»“æ„ã€‚åœ¨keyå’Œvalueä¹‹é—´æœ‰ä¸€ä¸ªæ˜ å°„å‡½æ•°,å¯ä»¥æ ¹æ®keyç›´æ¥ç´¢å¼•åˆ°å¯¹åº”çš„valueå€¼,å®ƒå¹¶<br>ä¸ä¼šä½¿ç”¨ä¸€èˆ¬çš„å¯¹æ¯”æ“ä½œ,è€Œæ˜¯ç›´æ¥ä½¿ç”¨<code>å†…å­˜çš„èµ·å§‹ä½ç½®å’Œåç§»ä½ç½®</code>è¿›è¡Œå¯»å€,æ‰€ä»¥ä¼šæ¯”æ­£å¸¸çš„å¯»å€è¦å¿«ã€‚</p><h2 id="æ•£åˆ—è¡¨ç»“æ„"><a href="#æ•£åˆ—è¡¨ç»“æ„" class="headerlink" title="æ•£åˆ—è¡¨ç»“æ„"></a>æ•£åˆ—è¡¨ç»“æ„</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> _zend_array &#123;</div><div class="line">zend_refcounted_h gc;</div><div class="line"><span class="keyword">union</span> &#123;</div><div class="line"><span class="keyword">struct</span> &#123;</div><div class="line">ZEND_ENDIAN_LOHI_4(</div><div class="line">zend_uchar    flags,</div><div class="line">zend_uchar    nApplyCount,</div><div class="line">zend_uchar    nIteratorsCount,</div><div class="line">zend_uchar    reserve)</div><div class="line">&#125; v;</div><div class="line"><span class="keyword">uint32_t</span> flags;</div><div class="line">&#125; u;</div><div class="line"><span class="keyword">uint32_t</span>          nTableMask;</div><div class="line">Bucket           *arData;</div><div class="line"><span class="keyword">uint32_t</span>          nNumUsed;</div><div class="line"><span class="keyword">uint32_t</span>          nNumOfElements;</div><div class="line"><span class="keyword">uint32_t</span>          nTableSize;</div><div class="line"><span class="keyword">uint32_t</span>          nInternalPointer;</div><div class="line">zend_long         nNextFreeElement;</div><div class="line"><span class="keyword">dtor_func_t</span>       pDestructor;</div><div class="line">&#125;;</div></pre></td></tr></table></figure><p>ä¸»è¦å­—æ®µä»‹ç»:</p><ul><li>gc å¼•ç”¨æ¬¡æ•°,åƒåœ¾å›æ”¶æ—¶ä¼šç”¨åˆ°ã€‚</li><li>union u å°±ä¸ä»‹ç»äº†ã€‚</li><li>arData å­˜å‚¨å…ƒç´ çš„æ•°ç»„,å†…å­˜æ˜¯è¿ç»­çš„,arDataæŒ‡å‘ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚</li><li>nTableMask nTableSizeçš„è´Ÿæ•°ã€‚</li><li>nTableSize æ•°ç»„é•¿åº¦,ä¸º2çš„næ­¤æˆ¿ã€‚</li><li>nNumUsed å½“å‰ä½¿ç”¨çš„Bucketæ•°ã€‚</li><li>nNumOfElements å½“å‰æ‰€æœ‰çš„Bucketæ•°ã€‚</li><li>nNextFreeElement ä¸‹ä¸€ä¸ªè¢«ä½¿ç”¨çš„Bucket($a[] = â€˜â€™)</li><li>pDestructor åˆ é™¤æŸä¸ªå…ƒç´ æ˜¯ä¼šä½¿ç”¨</li></ul><h2 id="Bucketç»“æ„"><a href="#Bucketç»“æ„" class="headerlink" title="Bucketç»“æ„"></a>Bucketç»“æ„</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> _Bucket &#123;</div><div class="line">zval              val;</div><div class="line">zend_ulong        h;                <span class="comment">/* hash value (or numeric index)   */</span></div><div class="line">zend_string      *key;              <span class="comment">/* string key or NULL for numerics */</span></div><div class="line">&#125; Bucket;</div></pre></td></tr></table></figure><ul><li>h hashå‡ºæ¥çš„å€¼(times33)</li><li>*key å­˜å‚¨å…ƒç´ çš„key</li><li>val å…·ä½“å€¼,æ˜¯ä¸ªzval</li></ul><h2 id="å¦‚ä½•å®ç°"><a href="#å¦‚ä½•å®ç°" class="headerlink" title="å¦‚ä½•å®ç°"></a>å¦‚ä½•å®ç°</h2><p>phpä¸­å®ç°æ•£åˆ—è¡¨å®ç°ä¸»è¦ä½¿ç”¨<code>å­˜å‚¨å…ƒç´ æ•°ç»„</code>å’Œ <code>æ˜ å°„å‡½æ•°</code>ï¼ˆä¹Ÿå¯ä»¥ç§°ä½œæ•£åˆ—å‡½æ•°ï¼‰å’Œ<code>æ˜ å°„è¡¨</code></p><h4 id="ä¸¾ä¸ªå…·ä½“çš„æ —å­"><a href="#ä¸¾ä¸ªå…·ä½“çš„æ —å­" class="headerlink" title="ä¸¾ä¸ªå…·ä½“çš„æ —å­:"></a>ä¸¾ä¸ªå…·ä½“çš„æ —å­:</h4><p> å¦‚æœæˆ‘ä»¬è¦åœ¨phpä»£ç ä¸­å£°æ˜ä¸€ä¸ªæ•°ç»„ä¼šå‘ç”Ÿä»€ä¹ˆ?ä¸‹è¾¹åˆ†æä¸‹phpæ˜¯å¦‚ä½•å®ç°æ•°ç»„çš„ã€‚<br> <figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">$arr= [</div><div class="line"><span class="string">'a'</span> =&gt; <span class="string">'111'</span>,</div><div class="line"><span class="string">'b'</span> =&gt; <span class="string">'222'</span>,</div><div class="line"><span class="string">'c'</span> =&gt; <span class="string">'ccc'</span></div><div class="line">];</div></pre></td></tr></table></figure></p><ol><li>é¦–å…ˆè‚¯å®šæ˜¯åˆå§‹åŒ–ã€‚</li><li>æ¥ä¸‹æ¥å°†æ¯ä¸ªå…ƒç´ å¯¹åº”çš„å€¼ä¾ç…§é¡ºåºæ‹·è´åˆ° Bucketé‡Œã€‚</li><li>ç„¶ååˆ©ç”¨æ˜ å°„å‡½æ•°å¯¹æ±‚å€¼,æ ¹æ®ç®—å‡ºæ¥çš„å€¼å°†å…¶å¯¹åº”çš„bucketçš„åœ°å€å†™åˆ°è¯¥å€¼å¯¹åº”çš„æ˜ å°„è¿™è¡¨é‡Œã€‚</li></ol><p>å…·ä½“æ“ä½œå¦‚ä¸‹å›¾:<br><img src="/photo/img/phpæ•°ç»„å®ç°/phpæ•°ç»„å…·ä½“å®ç°.png" alt="image"></p><p>å½“ç„¶æˆ‘ä»¬è¿™é‡Œçš„æ˜ å°„æ˜¯ç†æƒ³æ˜ å°„,å› ä¸ºåœ¨æ˜ å°„çš„è®¡ç®—è¿‡ç¨‹ä¸­å¯èƒ½å­˜åœ¨å†²çª,åç»­ä¼šä»‹ç»æ˜ å°„å‡½æ•°,ä»¥åŠå¦‚ä½•è§£æ˜ å°„å‡½æ•°è®¡ç®—åçš„å†²çªã€‚</p><h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">ZEND_API <span class="keyword">void</span> ZEND_FASTCALL _zend_hash_init(HashTable *ht, <span class="keyword">uint32_t</span> nSize, <span class="keyword">dtor_func_t</span> pDestructor, zend_bool persistent ZEND_FILE_LINE_DC)</div><div class="line">&#123;</div><div class="line">GC_REFCOUNT(ht) = <span class="number">1</span>; <span class="comment">//è®¾ç½®å¼•ç”¨æ¬¡æ•°</span></div><div class="line">GC_TYPE_INFO(ht) = IS_ARRAY; <span class="comment">//è®¾ç½®æ•°æ®ç±»å‹</span></div><div class="line">ht-&gt;u.flags = (persistent ? HASH_FLAG_PERSISTENT : <span class="number">0</span>) | HASH_FLAG_APPLY_PROTECTION | HASH_FLAG_STATIC_KEYS;</div><div class="line">ht-&gt;nTableMask = HT_MIN_MASK;</div><div class="line">HT_SET_DATA_ADDR(ht, &amp;uninitialized_bucket);</div><div class="line">ht-&gt;nNumUsed = <span class="number">0</span>;</div><div class="line">ht-&gt;nNumOfElements = <span class="number">0</span>;</div><div class="line">ht-&gt;nInternalPointer = HT_INVALID_IDX;</div><div class="line">ht-&gt;nNextFreeElement = <span class="number">0</span>;</div><div class="line">ht-&gt;pDestructor = pDestructor;</div><div class="line">ht-&gt;nTableSize = zend_hash_check_size(nSize);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>åˆå§‹åŒ–çš„æ—¶å€™ä¸»è¦æ˜¯å¯¹hashtableä¸­å„ä¸ªæˆå‘˜çš„è¿›è¡Œåˆå§‹åŒ–è®¾ç½®,è€Œä¸”åœ¨è¿™ä¸ªæ—¶å€™ä¸ä¼šç»™arDataåˆ†é…å†…å­˜,åªæœ‰åœ¨å¼€å§‹æ’å…¥æ•°æ®çš„æ—¶å€™æ‰ä¼š<br>ä¸ºarDataåˆ†é…å†…å­˜ã€‚</p><h2 id="æ˜ å°„å‡½æ•°"><a href="#æ˜ å°„å‡½æ•°" class="headerlink" title="æ˜ å°„å‡½æ•°"></a>æ˜ å°„å‡½æ•°</h2><p>æ˜ å°„å‡½æ•°å…¶å®å°±æ˜¯ä¸€æ¬¡<code>hash</code>æ“ä½œå’Œå’Œä¸€æ¬¡<code>|</code>æ“ä½œ.<br>hashæ“ä½œå°±æ˜¯ä¸Šè¾¹é”æåˆ°å¾—åˆ°times33æ“ä½œ,<code>|</code>æ“ä½œæ˜¯è®¡ç®—å‡ºæ¥çš„hashå€¼ä¸nTableSizeè¿›è¡Œè®¡ç®—ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nIndex = ket-&gt;h | nTableMask;</div></pre></td></tr></table></figure></p><p>å› ä¸ºnTableMaskæ˜¯nTableSizeçš„è´Ÿæ•°,æ‰€ä»¥è®¡ç®—å‡ºæ¥çš„nIndexå€¼åŒºé—´åº”è¯¥ä¸º[-1,nTableMask]ã€‚</p><p>æ­¤å¤„å¾…è¡¥å…… ä¸ºä»€ä¹ˆä¼šåœ¨[-1, nTableMask] åŒºé—´å†…ã€‚</p><h3 id="å†™å…¥æ•°æ®"><a href="#å†™å…¥æ•°æ®" class="headerlink" title="å†™å…¥æ•°æ®"></a>å†™å…¥æ•°æ®</h3><p>åœ¨åˆå§‹åŒ–çš„æ—¶å€™å¹¶ä¸ä¼šå¯¹arDataåˆ†é…å†…å­˜,åªæœ‰åœ¨å†™å…¥çš„æ—¶å€™æ‰ä¼šçœŸæ­£åˆ†é…å†…å­˜</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> zend_always_inline <span class="title">zend_hash_real_init_ex</span><span class="params">(HashTable *ht, <span class="keyword">int</span> packed)</span></span></div><div class="line">&#123;</div><div class="line">HT_ASSERT(GC_REFCOUNT(ht) == <span class="number">1</span>);</div><div class="line">ZEND_ASSERT(!((ht)-&gt;u.flags &amp; HASH_FLAG_INITIALIZED));</div><div class="line"><span class="keyword">if</span> (packed) &#123;</div><div class="line">HT_SET_DATA_ADDR(ht, pemalloc(HT_SIZE(ht), (ht)-&gt;u.flags &amp; HASH_FLAG_PERSISTENT));</div><div class="line">(ht)-&gt;u.flags |= HASH_FLAG_INITIALIZED | HASH_FLAG_PACKED;</div><div class="line">HT_HASH_RESET_PACKED(ht);</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">(ht)-&gt;nTableMask = -(ht)-&gt;nTableSize;</div><div class="line">HT_SET_DATA_ADDR(ht, pemalloc(HT_SIZE(ht), (ht)-&gt;u.flags &amp; HASH_FLAG_PERSISTENT));</div><div class="line">(ht)-&gt;u.flags |= HASH_FLAG_INITIALIZED;</div><div class="line"><span class="keyword">if</span> (EXPECTED(ht-&gt;nTableMask == <span class="number">-8</span>)) &#123;</div><div class="line">Bucket *arData = ht-&gt;arData;</div><div class="line"></div><div class="line">HT_HASH_EX(arData, <span class="number">-8</span>) = <span class="number">-1</span>;</div><div class="line">HT_HASH_EX(arData, <span class="number">-7</span>) = <span class="number">-1</span>;</div><div class="line">HT_HASH_EX(arData, <span class="number">-6</span>) = <span class="number">-1</span>;</div><div class="line">HT_HASH_EX(arData, <span class="number">-5</span>) = <span class="number">-1</span>;</div><div class="line">HT_HASH_EX(arData, <span class="number">-4</span>) = <span class="number">-1</span>;</div><div class="line">HT_HASH_EX(arData, <span class="number">-3</span>) = <span class="number">-1</span>;</div><div class="line">HT_HASH_EX(arData, <span class="number">-2</span>) = <span class="number">-1</span>;</div><div class="line">HT_HASH_EX(arData, <span class="number">-1</span>) = <span class="number">-1</span>;</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">HT_HASH_RESET(ht);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>åˆ†é…å…·ä½“çš„å†…å­˜</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> HT_SIZE_EX(nTableSize, nTableMask) \</span></div><div class="line">(HT_DATA_SIZE((nTableSize)) + HT_HASH_SIZE((nTableMask)))</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#define HT_HASH_SIZE(nTableMask) \</div><div class="line">(((size_t)(uint32_t)-(int32_t)(nTableMask)) * sizeof(uint32_t))</div><div class="line"></div><div class="line">#define HT_DATA_SIZE(nTableSize) \</div><div class="line">((size_t)(nTableSize) * sizeof(Bucket))</div></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åœ¨åˆ†é…å…·ä½“åˆ†é…å†…å­˜çš„æ—¶å€™ä¼šåˆ†é… nTableSize<em>(Bucket+uint32_t)å¤§å°çš„å†…å­˜ã€‚<br>è®²é“ç†åªéœ€è¦åˆ†é…nTableSize</em>Bucketå¤§å°å†…å­˜å°±å¯ä»¥äº†,ä¸ºä»€ä¹ˆä¼šå¤šä½™å‡ºæ¥ nTableSize<em>uint32_tå†…å­˜å‘¢?<br>å› ä¸ºnTableSize</em>uint32_tå°±æ˜¯<code>æ˜ å°„è¡¨</code>æ‰€å å†…å­˜å¤§å°ã€‚æ‰€ä»¥è¯´Bucketä¼šå’Œæ˜ å°„è¡¨ä¸€æ¬¡ç”³è¯·å†…å­˜ã€‚<br>å†™å®Œæˆå†™å…¥æ“ä½œä»¥åä¼šå°†<code>*arData</code> æŒ‡å‘ç¬¬ä¸€ä¸ªBucketã€‚</p><p>å…·ä½“åœ¨å†…å­˜é‡Œçš„ç»“æœå¦‚å›¾æ‰€ç¤º:<br><img src="/photo/img/phpæ•°ç»„å®ç°/hashtable.png" alt="image"></p><p><code>æ˜ å°„è¡¨</code>åœ¨åˆå§‹åŒ–çš„æ—¶å€™æ‰€æœ‰å€¼éƒ½æ˜¯-1,åªæœ‰åœ¨è¢«èµ‹å€¼æ—¶å€™ä¼šå†™å…¥å¯¹åº”<code>Bucket</code>æ‰€åœ¨é“¾è¡¨çš„åç§»é‡ã€‚;<br>ht-&gt;arData æŒ‡å‘ç¬¬ä¸€ä¸ª<code>Bucket</code>çš„ä½ç½®,åœ¨èµ‹å€¼çš„æ—¶å€™ä¼šæŒ‰ç…§åˆ—è¡¨é¡ºåº,å°†å€¼å†™å…¥<code>Bucket</code>çš„valueé‡Œ,ç„¶åä¼šæ ¹æ®<br>æ˜ å°„å‡½æ•°ç®—å‡ºå€¼å½“åšåç§»é‡æ‰¾åˆ°å¯¹åº”<code>æ˜ å°„è¡¨</code>çš„å…ƒç´ ,ç„¶åå°†å½“å‰<code>Bucket</code>å†™å…¥æ­¤å…ƒç´ ã€‚</p><p>ps nTableSize ä¸º2çš„æ¬¡æ–¹å€ã€‚</p><h2 id="å†²çª"><a href="#å†²çª" class="headerlink" title="å†²çª"></a>å†²çª</h2><p>å¦‚æœ<code>nIndex = ket-&gt;h | nTableMask</code> ç®—å‡ºæ¥çš„å€¼å†²çªäº†æ€ä¹ˆåŠ? é¦–å…ˆ<code>æ˜ å°„è¡¨</code>çš„æ¯ä¸ªå…ƒç´ ä¸æ˜¯é“¾è¡¨,æ‰€ä»¥å¯¼è‡´æ— æ³•å­˜å‚¨å¤šä¸ªå…ƒç´ ã€‚<br>åœ¨phpä¸­æ˜¯è¿™æ ·å¤„ç†å†²çªçš„:<br>é¦–å…ˆ<code>æ˜ å°„è¡¨</code>çš„æ‰€æœ‰å…ƒç´ åˆå§‹åŒ–å€¼ä¸º -1 ,å½“å‰<br>å¦‚æœç”¨å†²çªä¼šå°†æ–°ç®—å‡ºæ¥çš„å€¼å¯¹åº”çš„<code>Bucket</code>è¦†ç›–åŸæ¥æ—§çš„<code>Bucket</code>,ç„¶åå°†æ—§çš„<code>Bucket</code>è¿ç§»åˆ°æ–°çš„<code>Bucket</code>,<br>å¹¶å°†æ—§çš„<code>Bucket</code>çš„u2.next(é»˜è®¤ä¸º-1) æŒ‡å‘æ–°<code>Bucket</code>ã€‚</p><p>å¦‚å›¾<br><img src="/photo/img/phpæ•°ç»„å®ç°/é“¾è¡¨å†²çª.png" alt="image"></p><h2 id="æŸ¥æ‰¾"><a href="#æŸ¥æ‰¾" class="headerlink" title="æŸ¥æ‰¾"></a>æŸ¥æ‰¾</h2><p>phpå†æŸ¥æ‰¾ä¸€ä¸ªæ•°ç»„å…ƒç´ æ˜¯,é¦–å…ˆä¼šæ ¹æ®å…¶key è·å–åˆ°è®¡ç®—åhashå€¼â€™ket-&gt;hâ€™,ç„¶åæ ¹æ®æ˜ å°„å‡½æ•°ç®—å‡ºå½“å‰å…ƒç´ åœ¨<code>æ˜ å°„è¡¨</code>ä¸­çš„åç§»é‡,åˆ©ç”¨å½“å‰ä½ç½®+åç§»é‡æ‰¾åˆ°<code>æ˜ å°„è¡¨</code>çš„å…ƒç´ ,å†æ ¹æ®å…¶å†…çš„åé‡æ‰¾åˆ°å¯¹åº”<code>Bucket</code>é“¾è¡¨çš„é¦–ä¸ªå…ƒç´ ä½ç½®,æœ€åéå†è¯¥é“¾è¡¨æ ¸å¯¹keyå€¼,æ‰¾åˆ°å¯¹åº”çš„å€¼ã€‚</p><p>å…·ä½“å®ç°å‡½æ•°:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> zend_always_inline Bucket *<span class="title">zend_hash_find_bucket</span><span class="params">(<span class="keyword">const</span> HashTable *ht, zend_string *key)</span></span></div><div class="line">&#123;</div><div class="line">zend_ulong h;</div><div class="line"><span class="keyword">uint32_t</span> nIndex;</div><div class="line"><span class="keyword">uint32_t</span> idx;</div><div class="line">Bucket *p, *arData;</div><div class="line"></div><div class="line">h = zend_string_hash_val(key);</div><div class="line">arData = ht-&gt;arData;</div><div class="line">nIndex = h | ht-&gt;nTableMask;</div><div class="line">idx = HT_HASH_EX(arData, nIndex);</div><div class="line"><span class="keyword">while</span> (EXPECTED(idx != HT_INVALID_IDX)) &#123;</div><div class="line">p = HT_HASH_TO_BUCKET_EX(arData, idx);</div><div class="line"><span class="keyword">if</span> (EXPECTED(p-&gt;key == key)) &#123; <span class="comment">/* check for the same interned string */</span></div><div class="line"><span class="keyword">return</span> p;</div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (EXPECTED(p-&gt;h == h) &amp;&amp;</div><div class="line">     EXPECTED(p-&gt;key) &amp;&amp;</div><div class="line">     EXPECTED(ZSTR_LEN(p-&gt;key) == ZSTR_LEN(key)) &amp;&amp;</div><div class="line">     EXPECTED(<span class="built_in">memcmp</span>(ZSTR_VAL(p-&gt;key), ZSTR_VAL(key), ZSTR_LEN(key)) == <span class="number">0</span>)) &#123;</div><div class="line"><span class="keyword">return</span> p;</div><div class="line">&#125;</div><div class="line">idx = Z_NEXT(p-&gt;val);</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><h2 id="æ‰©å®¹"><a href="#æ‰©å®¹" class="headerlink" title="æ‰©å®¹"></a>æ‰©å®¹</h2><p>æ•°ç»„çš„å®¹é‡åœ¨åˆå§‹åŒ–çš„æ—¶å€™å·²ç»ç¡®å®šäº†å¤§å°,å°±æ˜¯nTableSizeã€‚å½“ç„¶æ˜ å°„å‡½æ•°ä¹Ÿæ˜¯æ ¹æ® nTableMask æ¥è®¡ç®—çš„ã€‚<br>æ‰€ä»¥æˆ‘ä»¬æ‰©å®¹æ—¶å€™å¿…é¡»é‡æ–°è®¡ç®—ç´¢å¼•,ä¹Ÿå°±æ˜¯<code>æ˜ å°„è¡¨</code>é‡Œçš„å€¼ã€‚<br>å…·ä½“æ‰©å®¹è§„åˆ™:<br>é¦–å…ˆå½“éœ€è¦æ‰©å®¹æ—¶,ä¼šè®¡ç®—å½“å‰<code>Bucket</code>é“¾è¡¨é‡Œåˆ é™¤å…ƒç´ æ•°é‡å æ€»è¡¨å…ƒç´ æ•°é‡çš„æ¯”ä¾‹,å¦‚æœæ²¡æœ‰è¶…è¿‡é˜ˆå€¼åˆ™ç”³è¯·åˆ†é…ä¸€ä¸ªåŸæ¥æ•°ç»„å¤§å°ä¸¤å€çš„æ–°ç´ ç»„,æŠŠå…ƒç´ å¤åˆ¶åˆ°æ–°æ•°ç»„ä¸Š,ç„¶åé‡æ–°å»ºç«‹ç´¢å¼•ã€‚</p><p>é˜ˆå€¼åˆ¤æ–­:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ht-&gt;nNumUsed &gt; ht-&gt;nNumOfElements + (ht-&gt;nNumOfElements &gt;&gt; <span class="number">5</span></div></pre></td></tr></table></figure></p><p>å¤„ç†è¿‡ç¨‹:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> ZEND_FASTCALL <span class="title">zend_hash_do_resize</span><span class="params">(HashTable *ht)</span></span></div><div class="line">&#123;</div><div class="line"></div><div class="line">IS_CONSISTENT(ht);</div><div class="line">HT_ASSERT(GC_REFCOUNT(ht) == <span class="number">1</span>);</div><div class="line"></div><div class="line"><span class="keyword">if</span> (ht-&gt;nNumUsed &gt; ht-&gt;nNumOfElements + (ht-&gt;nNumOfElements &gt;&gt; <span class="number">5</span>)) &#123; <span class="comment">/* additional term is there to amortize the cost of compaction */</span></div><div class="line">HANDLE_BLOCK_INTERRUPTIONS();</div><div class="line">zend_hash_rehash(ht);</div><div class="line">HANDLE_UNBLOCK_INTERRUPTIONS();</div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (ht-&gt;nTableSize &lt; HT_MAX_SIZE) &#123;<span class="comment">/* Let's double the table size */</span></div><div class="line"><span class="keyword">void</span> *new_data, *old_data = HT_GET_DATA_ADDR(ht);</div><div class="line"><span class="keyword">uint32_t</span> nSize = ht-&gt;nTableSize + ht-&gt;nTableSize;</div><div class="line">Bucket *old_buckets = ht-&gt;arData;</div><div class="line"></div><div class="line">HANDLE_BLOCK_INTERRUPTIONS();</div><div class="line">new_data = pemalloc(HT_SIZE_EX(nSize, -nSize), ht-&gt;u.flags &amp; HASH_FLAG_PERSISTENT);</div><div class="line">ht-&gt;nTableSize = nSize;</div><div class="line">ht-&gt;nTableMask = -ht-&gt;nTableSize;</div><div class="line">HT_SET_DATA_ADDR(ht, new_data);</div><div class="line"><span class="built_in">memcpy</span>(ht-&gt;arData, old_buckets, <span class="keyword">sizeof</span>(Bucket) * ht-&gt;nNumUsed);</div><div class="line">pefree(old_data, ht-&gt;u.flags &amp; HASH_FLAG_PERSISTENT);</div><div class="line">zend_hash_rehash(ht);</div><div class="line">HANDLE_UNBLOCK_INTERRUPTIONS();</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">zend_error_noreturn(E_ERROR, <span class="string">"Possible integer overflow in memory allocation (%zu * %zu + %zu)"</span>, ht-&gt;nTableSize * <span class="number">2</span>, <span class="keyword">sizeof</span>(Bucket) + <span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>), <span class="keyword">sizeof</span>(Bucket));</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>åœ¨å¤„ç†çš„è¿‡ç¨‹ä¸­è¿˜ä¼šæŠŠå·²ç»åˆ é™¤çš„<code>Bucket</code>ç»™åˆ é™¤ã€‚</p><p>å…·ä½“çš„æ“ä½œåœ¨<code>zend_hash.c</code>æ–‡ä»¶é‡Œã€‚<br>å¦‚æœè¶…è¿‡é˜ˆå€¼,åˆ™ä¼šæŠŠå·²ç»åˆ é™¤<code>Bucket</code>ç§»é™¤,ç„¶åæŠŠåˆæœ‰åè¾¹çš„å…ƒç´ å¾€å‰ç§»åŠ¨,è¡¥ä¸Šç©ºç¼ºçš„<code>Bucket</code>,å½“ç„¶ç´¢å¼•ä¹Ÿä¼šé‡å»ºã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://www.cnblogs.com/52fhy/p/5007456.html" target="_blank" rel="noopener">time33 </a></li><li><a href="https://github.com/pangudashu/php7-internal/blob/master/2/zval.md" target="_blank" rel="noopener">2.1 å˜é‡çš„å†…éƒ¨å®ç°</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;phpçš„æ•°ç»„ä¾èµ–äºhashtableå®ç°çš„ã€‚&lt;/p&gt;
&lt;p&gt;Times33çš„ç®—æ³•å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸æ–­çš„ä¹˜33,ä¸‹è¾¹æ˜¯times33ç®—æ³•:&lt;/p&gt;
&lt;h2 id=&quot;Times33-hash&quot;&gt;&lt;a href=&quot;#Times33-hash&quot; class=&quot;headerlink&quot; t
      
    
    </summary>
    
      <category term="phpæºç å­¦ä¹ " scheme="http://yoursite.com/categories/php%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="phpæºç " scheme="http://yoursite.com/tags/php%E6%BA%90%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>phpæ•°æ®ç»“æ„</title>
    <link href="http://yoursite.com/2018/08/19/php%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    <id>http://yoursite.com/2018/08/19/phpæ•°æ®ç»“æ„/</id>
    <published>2018-08-19T12:30:34.000Z</published>
    <updated>2019-01-08T10:55:19.888Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h2><p>phpæ˜¯å¦‚ä½•ç»Ÿä¸€å®ç°å„ç§å˜é‡ç±»å‹çš„? è¿™å’Œphpå˜é‡ç±»å‹çš„å®ç°æ˜¯å¯†ä¸å¯åˆ†çš„ã€‚<br>ä¸€ä¸ªå˜é‡ä¸»è¦æœ‰ä¸‰ä¸ªè¦ç´ :<code>å˜é‡å``å˜é‡ç±»å‹``å˜é‡å€¼</code>,ä»–ä»¬åœ¨phpå˜é‡ç±»å‹å®ç°ä¸­ä¸»è¦å¯¹åº” zval zend_value å’Œ<br>zendçš„å„ç§æ•°æ®ç±»å‹ã€‚<br>phpä¸­ç”¨$å»å£°æ˜ä¸€ä¸ªå˜é‡,åœ¨å£°æ˜çš„æ—¶å€™å¯ä»¥è¿›è¡Œåˆå§‹åŒ–,å½“ç„¶ä¹Ÿå¯ä»¥ä¸å£°æ˜ç›´æ¥ä½¿ç”¨ã€‚ä¸€èˆ¬æ¥è¯´,ä¸€ä¸ªå˜é‡çš„å®šä¹‰åŒ…å«<br>ä¸¤æ­¥:å˜é‡å®šä¹‰å’Œå˜é‡åˆå§‹åŒ–,åœ¨phpä¸­åªå®šä¹‰ä¸åˆå§‹åŒ–æ˜¯å¯ä»¥çš„ã€‚</p><h2 id="å˜é‡ç»“æ„ä½“"><a href="#å˜é‡ç»“æ„ä½“" class="headerlink" title="å˜é‡ç»“æ„ä½“"></a>å˜é‡ç»“æ„ä½“</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// php zvalç»“æ„</span></div><div class="line"><span class="keyword">struct</span> _zval_struct &#123;</div><div class="line">zend_value        value; æŒ‡å‘å…·ä½“çš„value<span class="comment">/* value */</span></div><div class="line"><span class="keyword">union</span> &#123;</div><div class="line"><span class="keyword">struct</span> &#123;</div><div class="line">ZEND_ENDIAN_LOHI_4(</div><div class="line">zend_uchar    type,<span class="comment">/* active type */</span></div><div class="line">zend_uchar    type_flags,</div><div class="line">zend_uchar    const_flags,</div><div class="line">zend_uchar    reserved)    <span class="comment">/* call info for EX(This) */</span></div><div class="line">&#125; v;</div><div class="line"><span class="keyword">uint32_t</span> type_info;</div><div class="line">&#125; u1;</div><div class="line"><span class="keyword">union</span> &#123;</div><div class="line"><span class="keyword">uint32_t</span>     var_flags;</div><div class="line"><span class="keyword">uint32_t</span>     next;                 <span class="comment">/* hash collision chain */</span></div><div class="line"><span class="keyword">uint32_t</span>     cache_slot;           <span class="comment">/* literal cache slot */</span></div><div class="line"><span class="keyword">uint32_t</span>     lineno;               <span class="comment">/* line number (for ast nodes) */</span></div><div class="line"><span class="keyword">uint32_t</span>     num_args;             <span class="comment">/* arguments number for EX(This) */</span></div><div class="line"><span class="keyword">uint32_t</span>     fe_pos;               <span class="comment">/* foreach position */</span></div><div class="line"><span class="keyword">uint32_t</span>     fe_iter_idx;          <span class="comment">/* foreach iterator index */</span></div><div class="line">&#125; u2;</div><div class="line">&#125;;</div></pre></td></tr></table></figure><h2 id="å˜é‡ç±»å‹"><a href="#å˜é‡ç±»å‹" class="headerlink" title="å˜é‡ç±»å‹"></a>å˜é‡ç±»å‹</h2><p>å…¶ä¸­type è¡¨ç¤ºå½“å‰å˜é‡çš„ç±»å‹,ä¾‹å¦‚string array intç­‰,ä»¥ä¸‹ä¸ºphpä¸­å…¨éƒ¨å˜é‡ç±»å‹ã€‚<br>å…¶ä¸­type æ˜¯ä¸€ä¸ªæ— ç¬¦å·ç±»å‹çš„char,ä»–çš„å®šä¹‰æ˜¯è¿™æ ·çš„<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> zend_uchar;</div></pre></td></tr></table></figure></p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">union</span> _zend_value &#123;</div><div class="line">    zend_long         lval;<span class="comment">/* long value */</span></div><div class="line">    <span class="keyword">double</span>            dval;<span class="comment">/* double value */</span></div><div class="line">    zend_refcounted  *counted;</div><div class="line">    zend_string      *str;</div><div class="line">    zend_array       *arr;</div><div class="line">    zend_object      *obj;</div><div class="line">    zend_resource    *res;</div><div class="line">    zend_reference   *ref;</div><div class="line">    zend_ast_ref     *ast;</div><div class="line">    zval             *zv;</div><div class="line">    <span class="keyword">void</span>             *ptr;</div><div class="line">    zend_class_entry *ce;</div><div class="line">    zend_function    *func;</div><div class="line">    <span class="keyword">struct</span> &#123;</div><div class="line">    <span class="keyword">uint32_t</span> w1;</div><div class="line">    <span class="keyword">uint32_t</span> w2;</div><div class="line">    &#125; ww;</div><div class="line">    &#125; zend_value;</div></pre></td></tr></table></figure><ul><li>åœ¨è¿™äº›ç±»å‹é‡Œä¸å­˜åœ¨booleanç±»å‹,å› ä¸ºåœ¨php7ä¸­å·²ç»å°†booleanæ‹†åˆ†ä¸ºtrueå’Œfalse.ç›´æ¥ä¿å­˜åœ¨typeä¸­,ä¹Ÿå°±æ˜¯è¯´<br>booleanæ²¡æœ‰_zend_valueç»“æ„,ç›´æ¥é€šè¿‡typeå­—æ®µå°±å¯ä»¥ç¡®å®šbooleançš„å€¼ã€‚</li><li>ä»ä¸Šè¾¹çš„ç»“æ„ä½“å¯ä»¥çœ‹å‡ºæ¥ <code>zend_long</code>ã€<code>double</code> ç±»å‹ä¸æ˜¯æŒ‡é’ˆç±»å‹,ä¹Ÿå°±æ˜¯è¯´æ•´å½¢å’Œæµ®ç‚¹å‹æ­£èƒ½è¿›è¡Œæ·±æ‹·è´,<br>å¹¶ä¸èƒ½å’Œå…¶ä»–è¯´å¥ç±»å‹ä¸€æ ·è¿›è¡Œ <code>å¼•ç”¨è®¡æ•°</code>å’Œ<code>å†™æ—¶å¤åˆ¶</code>ã€‚å› ä¸ºæœ‰<code>å¼•ç”¨è®¡æ•°</code>å’Œ<code>å†™æ—¶å¤åˆ¶</code>åœ¨å˜é‡èµ‹å€¼ä¸”ä¸åšä¿®æ”¹æ—¶<br>æ‰èƒ½å¤§é‡èŠ‚çœå†…å­˜ã€‚</li></ul><p>ä»¥stringç±»å‹ä¸ºä¾‹,å®ƒåœ¨phpä¸­çš„ç»“æ„ç±»å‹åº”è¯¥æ˜¯è¿™æ ·çš„:</p><p><img src="/photo/img/phpæ•°æ®ç»“æ„/phpæ•°æ®ç»“æ„.png" alt="image"></p><p>_zend_string:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> _zend_string &#123;</div><div class="line">zend_refcounted_h gc;</div><div class="line">zend_ulong        h;                <span class="comment">/* hash value */</span></div><div class="line"><span class="keyword">size_t</span>            len;</div><div class="line"><span class="keyword">char</span>              val[<span class="number">1</span>];          <span class="comment">/*å­—ç¬¦ä¸²èµ·å§‹åœ°å€*/</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure></p><ul><li>å…¶ä¸­<code>gc</code> å­—æ®µè¡¨ç¤ºè¿™ä¸ªç»“æ„ä½“è¢«å¼•ç”¨çš„æ¬¡æ•°,åƒåœ¾å›æ”¶çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚</li><li>h å­—ç¬¦ä¸²é€šè¿‡Times33è®¡ç®—å‡ºæ¥çš„hashcode</li><li>len å­—ç¬¦ä¸²é•¿åº¦</li><li>val å­—ç¬¦ä¸²å†…å®¹</li></ul><p>æˆ‘ä»¬åœ¨è¿™é‡Œéƒ½ä¼šæœ‰ç–‘é—®,ä¸ºä»€ä¹ˆå­˜å‚¨å­—ç¬¦ä¸²å†…å®¹çš„æ—¶å€™æ²¡æœ‰ä½¿ç”¨char*ç±»å‹,è€Œç”¨äº†ä¸€ä¸ªæ•°ç»„ç±»å‹æ¥å­˜å‚¨ã€‚zend_string<br>åœ¨ç”³è¯·å†…å­˜çš„æ—¶å€™ä¼šä¼šç”³è¯·malloc(sizeof(zend_string)+å­—ç¬¦ä¸²é•¿åº¦),ä¸”val[0]å­˜çš„æ˜¯å­—ç¬¦ä¸²æœ€åä¸€ä¸ªå­—ç¬¦å®‰â€œ\0â€</p><p>zend_stringç»“æ„åœ¨å†…å­˜ä¸­å¦‚ä¸‹æ‰€ç¤º:</p><p><img src="/photo/img/phpæ•°æ®ç»“æ„/zend_stirngå†…å­˜ä¸­ç»“æ„.png" alt="image"></p><p>å½“æ—¶ä¹Ÿåœ¨char val[1]çš„åœ°æ–¹ç–‘æƒ‘äº†å¾ˆä¹…,å†å¾€ä¸Šæ‰¾äº†å¾ˆå¤šæ–‡ç« ,å…¶ä¸­<br>Nikita Popov(nikicï¼ŒPHP å®˜æ–¹å¼€å‘ç»„æˆå‘˜ï¼ŒæŸæ—ç§‘æŠ€å¤§å­¦çš„å­¦ç”Ÿ) è¿™æ ·è§£é‡Š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">å¦‚æœä½ å¯¹ C è¯­è¨€äº†è§£çš„ä¸æ˜¯å¾ˆæ·±å…¥çš„è¯ï¼Œå¯èƒ½ä¼šè§‰å¾— val çš„å®šä¹‰æœ‰äº›å¥‡æ€ªï¼šè¿™ä¸ªå£°æ˜åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œä½†æ˜¯æ˜¾ç„¶æˆ‘ä»¬æƒ³å­˜å‚¨çš„å­—ç¬¦ä¸²é•¿åº¦è‚¯å®šå¤§äºä¸€ä¸ªå­—ç¬¦çš„é•¿åº¦ã€‚è¿™é‡Œå…¶å®ä½¿ç”¨çš„æ˜¯ç»“æ„ä½“çš„ä¸€ä¸ªã€é»‘ã€æ–¹æ³•ï¼šåœ¨å£°æ˜æ•°ç»„æ—¶åªå®šä¹‰ä¸€ä¸ªå…ƒç´ ï¼Œä½†æ˜¯å®é™…åˆ›å»º zend_string æ—¶å†åˆ†é…è¶³å¤Ÿçš„å†…å­˜æ¥å­˜å‚¨æ•´ä¸ªå­—ç¬¦ä¸²ã€‚è¿™æ ·æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥é€šè¿‡ val è®¿é—®å®Œæ•´çš„å­—ç¬¦ä¸²ã€‚</div></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ:"></a>å‚è€ƒ:</h2><ul><li><a href="https://nikic.github.io/2015/06/19/Internal-value-representation-in-PHP-7-part-2.html" target="_blank" rel="noopener">Internal value representation in PHP 7 - Part 2 </a></li><li><a href="https://0x1.im/blog/php/Internal-value-representation-in-PHP-7-part-2.html" target="_blank" rel="noopener">[è¯‘]å˜é‡åœ¨ PHP7 å†…éƒ¨çš„å®ç°ï¼ˆäºŒï¼‰</a></li><li><a href="https://www.kancloud.cn/nickbai/php7/363268" target="_blank" rel="noopener">phpå†…æ ¸åˆ†æâ€”â€”2.1 å˜é‡çš„å†…éƒ¨å®ç°</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å˜é‡&quot;&gt;&lt;a href=&quot;#å˜é‡&quot; class=&quot;headerlink&quot; title=&quot;å˜é‡&quot;&gt;&lt;/a&gt;å˜é‡&lt;/h2&gt;&lt;p&gt;phpæ˜¯å¦‚ä½•ç»Ÿä¸€å®ç°å„ç§å˜é‡ç±»å‹çš„? è¿™å’Œphpå˜é‡ç±»å‹çš„å®ç°æ˜¯å¯†ä¸å¯åˆ†çš„ã€‚&lt;br&gt;ä¸€ä¸ªå˜é‡ä¸»è¦æœ‰ä¸‰ä¸ªè¦ç´ :&lt;code&gt;å˜é‡å``å˜é‡ç±»å‹`
      
    
    </summary>
    
      <category term="phpæºç å­¦ä¹ " scheme="http://yoursite.com/categories/php%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="phpæºç " scheme="http://yoursite.com/tags/php%E6%BA%90%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>phpçš„å¼•ç”¨</title>
    <link href="http://yoursite.com/2018/08/12/php%E7%9A%84&amp;%E7%AC%A6%E5%8F%B7/"/>
    <id>http://yoursite.com/2018/08/12/phpçš„&amp;ç¬¦å·/</id>
    <published>2018-08-12T14:18:07.000Z</published>
    <updated>2019-01-08T10:56:48.506Z</updated>
    
    <content type="html"><![CDATA[<h3 id="amp"><a href="#amp" class="headerlink" title="&amp;"></a>&amp;</h3><p>&amp;æ˜¯phpä¸­çš„å¼•ç”¨,ä»–å¹¶ä¸ä¸€ç§ç‹¬ç«‹çš„æ•°æ®ç±»å‹,è€Œæ˜¯æŒ‡å‘å…¶ä»–æ•°æ®ç±»å‹çš„æ•°æ®ç»“æ„,å’ŒCè¯­è¨€çš„æŒ‡é’ˆç±»ä¼¼ã€‚</p><p>å…·ä½“ä½œç”¨ä¸º:å½“æˆ‘ä»¬ä¿®æ”¹å¼•ç”¨ç±»å‹å˜é‡æ˜¯,å…¶ä¿®æ”¹çš„å°†ä½œç”¨äºå®é™…å¼•ç”¨çš„å˜é‡ä¸Šã€‚</p><p>å¦‚æœå½“æˆ‘ä»¬ä½¿ç”¨&amp;ç¬¦å·ç”Ÿæˆä¸€ä¸ªå¼•ç”¨å˜é‡æ—¶,é¦–å…ˆä¼šä¸º&amp;æ“ä½œç”Ÿæˆä¸€ä¸ªzend_referenceç»“æ„,zend_referenceå°±æ˜¯å¼•ç”¨<br>ç±»å‹çš„ç»“æ„ä½“,ä»–å†…åµŒä¸€ä¸ªzval,ç„¶åæ­¤ç»“æ„çš„ä½“zvalçš„valueæŒ‡å‘åŸæ¥zvalçš„valueä¸Šã€‚ç„¶åå°†åŸæ¥zvalçš„å˜é‡<br>ç±»å‹å˜ä¸ºIS_REFERENCE,åŸæ¥zvalçš„valueæ‰§è¡Œæ–°åˆ›å»ºzend_referenceç»“æ„ã€‚<br>ç´¢å¼•&amp;çš„ä½œç”¨å°±æ˜¯æ–°ç”Ÿæˆzend_reference,ç„¶åå°†å…¶æŒ‡å‘åŸæ¥çš„zvalçš„valueä¸Š,é¡ºä¾¿æŠŠåŸæ¥zvalçš„å˜é‡ç±»å‹å˜åŒ–ä¸ºå¼•ç”¨ç±»å‹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> _zend_reference &#123;</div><div class="line">    zend_refcondted_h gc;</div><div class="line">    zval              val;  æŒ‡å‘åŸæ¥çš„value.</div><div class="line">&#125;;</div></pre></td></tr></table></figure><h3 id="ä¸¾ä¸ªæ —å­"><a href="#ä¸¾ä¸ªæ —å­" class="headerlink" title="ä¸¾ä¸ªæ —å­"></a>ä¸¾ä¸ªæ —å­</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$a = time(); //æ­¥éª¤1</div><div class="line">$b = &amp;$a;    //æ­¥éª¤2</div></pre></td></tr></table></figure><p><strong>æ­¥éª¤1</strong></p><p>ç°åœ¨<code>$a = time()</code>æ˜¯ä»–ä»¬çš„æ•°æ®ç»“æ„æŒ‡å‘ä¸º:</p><p><img src="/photo/img/phpå¼•ç”¨/æœªå¼•ç”¨å‰.png" alt="image"></p><p>æ­¤æ—¶æ•°æ®ç»“æ„,ä¸€ç›´æŒ‡é’ˆæŒ‡å‘æ˜¯è¿™ä¸ªæ ·å­ã€‚</p><p><strong>æ­¥éª¤2</strong></p><p><img src="/photo/img/phpå¼•ç”¨/å¼•ç”¨å.png" alt="image"></p><p>ä¹Ÿå°±æ˜¯è¯´PHPçš„å¼•ç”¨åœ¨ä½¿ç”¨åæ–°ç”Ÿæˆä¸€ä¸ªå¼•ç”¨ç±»å‹æœºæ„,ç„¶åå°†å¼•ç”¨ç±»å‹ç»“æ„æŒ‡å‘è¶Šæ¥çš„value,æœ€åå°†åŸæ¥zvalçš„value<br>æŒ‡å‘æ–°ç”Ÿæˆçš„ç»“æ„ä½“,å¹¶å°†å…¶å˜é‡ç±»å‹å˜ä¸ºå¼•ç”¨ç±»å‹,IS_REFERENCEã€‚å½“ç„¶éšä¹‹æ”¹å˜çš„è¿˜æœ‰è®¡æ•°ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;amp&quot;&gt;&lt;a href=&quot;#amp&quot; class=&quot;headerlink&quot; title=&quot;&amp;amp;&quot;&gt;&lt;/a&gt;&amp;amp;&lt;/h3&gt;&lt;p&gt;&amp;amp;æ˜¯phpä¸­çš„å¼•ç”¨,ä»–å¹¶ä¸ä¸€ç§ç‹¬ç«‹çš„æ•°æ®ç±»å‹,è€Œæ˜¯æŒ‡å‘å…¶ä»–æ•°æ®ç±»å‹çš„æ•°æ®ç»“æ„,å’ŒCè¯­è¨€çš„æŒ‡é’ˆç±»ä¼¼ã€‚&lt;/p&gt;
&lt;p&gt;å…·
      
    
    </summary>
    
      <category term="phpæºç å­¦ä¹ " scheme="http://yoursite.com/categories/php%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="phpæºç " scheme="http://yoursite.com/tags/php%E6%BA%90%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>swagger</title>
    <link href="http://yoursite.com/2018/08/06/swagger/"/>
    <id>http://yoursite.com/2018/08/06/swagger/</id>
    <published>2018-08-06T07:30:13.000Z</published>
    <updated>2019-01-08T10:57:25.327Z</updated>
    
    <content type="html"><![CDATA[<p>swagger æ˜¯ä»€ä¹ˆé¬¼?<br>swaggeråƒæ˜¯ä¸ªæ¥å£ç”Ÿæˆã€ç®¡ç†ã€mockã€æµ‹è¯•çš„æ¡†æ¶ã€‚ä¸»è¦åŠŸèƒ½:</p><ul><li>æ”¯æŒAPIè‡ªåŠ¨ç”ŸæˆåŒæ­¥çš„åœ¨çº¿æ–‡æ¡£</li><li>è¿™äº›æ–‡æ¡£å¯ç”¨äºé¡¹ç›®å†…éƒ¨APIå®¡æ ¸</li><li>æ–¹ä¾¿æµ‹è¯•äººå‘˜äº†è§£API</li><li>è¿™äº›æ–‡æ¡£å¯ä½œä¸ºå®¢æˆ·äº§å“æ–‡æ¡£çš„ä¸€éƒ¨åˆ†è¿›è¡Œå‘å¸ƒ</li><li>å¯ä»¥mockæ¥å£æ–¹ä¾¿è°ƒè¯•<br>æ”¯æŒAPIè§„èŒƒç”Ÿæˆä»£ç ï¼Œç”Ÿæˆçš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éª¨æ¶ä»£ç å¯ä»¥åŠ é€Ÿå¼€å‘å’Œæµ‹è¯•é€Ÿåº¦<br>##<br>swagger-ui ä¸€ä¸ªæ˜¯ä¸€ä¸ªç®¡ç†æ¥å£çš„æœåŠ¡,å®ƒå¯ä»¥æ ¹æ®swagger.jsonæ¨¡æ‹Ÿæ¥å£è¿”å›ã€‚<h3 id="æ­å»ºswagger-ui"><a href="#æ­å»ºswagger-ui" class="headerlink" title="æ­å»ºswagger-ui"></a>æ­å»ºswagger-ui</h3></li></ul><p>å…‹éš†swagger-ui</p><p><code>git clone https://github.com/swagger-api/swagger-ui.git</code></p><p>é…ç½®nginx æœåŠ¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">       listen       8090;</div><div class="line">       server_name  www.swagger-ui.com;</div><div class="line">       autoindex on;</div><div class="line">       #charset koi8-r;</div><div class="line"></div><div class="line">      # access_log  logs/host.access.log  main;</div><div class="line">       root  /Users/lijian/Desktop/code/web_code/swagger/swagger-ui/dist;</div><div class="line">       location / &#123;</div><div class="line"></div><div class="line">           index  index.php index.html index.htm;</div><div class="line">           try_files $uri $uri/ /index.php?$query_string;</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       #error_page  404              /404.html;</div><div class="line"></div><div class="line">       # redirect server error pages to the static page /50x.html</div><div class="line">       #</div><div class="line">       error_page   500 502 503 504  /50x.html;</div><div class="line">       location = /50x.html &#123;</div><div class="line">           root   html;</div><div class="line">       &#125;</div><div class="line">       location ~ \.php$ &#123;</div><div class="line"></div><div class="line">           fastcgi_pass   127.0.0.1:9000;</div><div class="line">           fastcgi_index  index.php;</div><div class="line">           fastcgi_split_path_info    ^(.+\.php)(/.+)$;</div><div class="line">           fastcgi_param PATH_TRANSLATED $document_root$fastcgi_path_info;</div><div class="line">   fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</div><div class="line">           include        fastcgi_params;</div><div class="line">       &#125;</div><div class="line"></div><div class="line">   &#125;</div></pre></td></tr></table></figure><p>é‡å¯NGINX<br><code>nginx -s reload</code></p><p>æ ·å­å¦‚ä¸‹:</p><p><img src="/photo/img/swagger-ui/WX20180807-095949.png" alt="image"></p><h2 id="swagger-json"><a href="#swagger-json" class="headerlink" title="swagger.json"></a>swagger.json</h2><p>swagger.json,swagger-uièƒ½å¤Ÿå°†swagger.jsonè§£æä¸ºå¯¹åº”çš„å¯å¤„ç†çš„æ¥å£æ–‡æ¡£ã€‚</p><p>æ•ˆæœå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚<br>æœ€ç»ˆè¦çš„ä¸€ç‚¹åœ¨äº <code>http://localhost:8091/swagger.json</code>è¯¥urlä¸ºè¢«è§£æçš„jsonåœ°å€ã€‚</p><p>å½“ç„¶å¦‚æœæˆ‘ä»¬éœ€è¦ç®¡ç†ä¸åŒé¡¹ç›®çš„é¡¹ç›®,å¯ä»¥å•ç‹¬é…ç½®ä¸ªæœåŠ¡ç”¨æ¥ç®¡ç†swagger.jsonã€‚</p><h2 id="swagger-php"><a href="#swagger-php" class="headerlink" title="swagger-php"></a>swagger-php</h2><p>github åœ°å€: <code>https://github.com/zircote/swagger-php</code></p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®é‡Œå¼•å…¥swagger-php æ‰©å±•åŒ…ã€‚</p><p><code>composer global require zircote/swagger-php</code></p><p>æŒ‰ç…§swaggeræ–‡æ¡£å†™swaggerå¤‡æ³¨:<br>eg:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * @SWG\Post(</div><div class="line"> *     path=&quot;/guestbook/appmsg&quot;,</div><div class="line"> *     summary=&quot;è®¿å®¢ç•™è¨€&quot;,</div><div class="line"> *     tags=&#123;&quot;new&quot;, &quot;guests&quot;&#125;,</div><div class="line"> *     description=&quot;è®¿å®¢ç•™è¨€&quot;,</div><div class="line"> *     operationId=&quot;appmsg&quot;,</div><div class="line"> *     @SWG\Parameter(</div><div class="line"> *         description=&quot;msg&quot;,</div><div class="line"> *         format=&quot;string&quot;,</div><div class="line"> *         in=&quot;formData&quot;,</div><div class="line"> *         name=&quot;msg&quot;,</div><div class="line"> *         required=true,</div><div class="line"> *         type=&quot;string&quot;,</div><div class="line"> *     ),</div><div class="line"> *     @SWG\Parameter(</div><div class="line"> *         description=&quot;email&quot;,</div><div class="line"> *         format=&quot;string&quot;,</div><div class="line"> *         in=&quot;formData&quot;,</div><div class="line"> *         name=&quot;email&quot;,</div><div class="line"> *         required=true,</div><div class="line"> *         type=&quot;string&quot;,</div><div class="line"> *</div><div class="line"> *     ),</div><div class="line"> *     consumes=&#123;&quot;multipart/form-data&quot;, &quot;application/x-www-form-urlencoded&quot;&#125;,</div><div class="line"> *     produces=&#123;&quot;application/json&quot;&#125;,</div><div class="line"> *     @SWG\Response(</div><div class="line"> *         response=&quot;200&quot;,</div><div class="line"> *         description=&quot;è¿”å›æˆåŠŸ&quot;,</div><div class="line"> *     ),</div><div class="line"> * )</div><div class="line"> *</div><div class="line"> */</div><div class="line"></div><div class="line">/**</div><div class="line"> *   @SWG\Get(</div><div class="line"> *     path=&quot;/get/feedback&quot;,</div><div class="line"> *     summary=&quot;ç•™è¨€è¡¨&quot;,</div><div class="line"> *     tags=&#123;&quot;getList&quot;&#125;,</div><div class="line"> *     descriptionId=&quot;appmsglist&quot;,</div><div class="line"> *     @SWG\Parameter(</div><div class="line"> *          description=&quot;Id&quot;,</div><div class="line"> *          format=&quot;integer&quot;,</div><div class="line"> *          in=&quot;formData&quot;,</div><div class="line"> *          name=&quot;user_id&quot;,</div><div class="line"> *          required=&quot;true&quot;,</div><div class="line"> *          type=&quot;integer&quot;</div><div class="line">    *      ),</div><div class="line"> *      @SWG\Parameter(</div><div class="line"> *          description=&quot;phone&quot;,</div><div class="line"> *          format=&quot;integer&quot;,</div><div class="line"> *          in=&quot;formData&quot;,</div><div class="line"> *          name=&quot;user_id&quot;,</div><div class="line"> *          required=&quot;true&quot;,</div><div class="line"> *          type=&quot;integer&quot;</div><div class="line"> *        ),</div><div class="line"> *     consumes=&#123;&quot;multipart/form-data&quot;, &quot;application/x-www-form-urlencode&quot;&#125;,</div><div class="line"> *     produces=&#123;&quot;application/json&quot;&#125;,</div><div class="line"> *     @SWG\Response(</div><div class="line"> *        response=&quot;200&quot;,</div><div class="line"> *        description=&quot;è¿”å›æˆåŠŸ&quot;,</div><div class="line"> *     )</div><div class="line"> * )</div><div class="line"> *</div><div class="line"> */</div></pre></td></tr></table></figure><p>å†™å®Œä»¥åè¿è¡Œ:</p><p><code>./vendor/zircote/swagger-php/bin/swagger app/Business/Hera/HeraMockApi.php -o ./../../swagger_json/rrc/swagger.json</code><br>ç¬¬ä¸€ä¸ªä¸ºswagger.jsonçš„ç”Ÿæˆå™¨,ç¬¬äºŒä¸ªä¸ºç›®æ ‡æ–‡ä»¶,ç¬¬ä¸‰ä¸ªä¸ºç”Ÿæˆæ–‡ä»¶ã€‚</p><p>ç„¶åæˆ‘ä»¬åœ¨swagger-ui å¼•å…¥ç”Ÿæˆçš„jsonå³å¯ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;swagger æ˜¯ä»€ä¹ˆé¬¼?&lt;br&gt;swaggeråƒæ˜¯ä¸ªæ¥å£ç”Ÿæˆã€ç®¡ç†ã€mockã€æµ‹è¯•çš„æ¡†æ¶ã€‚ä¸»è¦åŠŸèƒ½:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒAPIè‡ªåŠ¨ç”ŸæˆåŒæ­¥çš„åœ¨çº¿æ–‡æ¡£&lt;/li&gt;
&lt;li&gt;è¿™äº›æ–‡æ¡£å¯ç”¨äºé¡¹ç›®å†…éƒ¨APIå®¡æ ¸&lt;/li&gt;
&lt;li&gt;æ–¹ä¾¿æµ‹è¯•äººå‘˜äº†è§£API&lt;/li&gt;
&lt;li
      
    
    </summary>
    
    
      <category term="pear" scheme="http://yoursite.com/tags/pear/"/>
    
  </entry>
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼-å»ºé€ è€…æ¨¡å¼(builder template method)</title>
    <link href="http://yoursite.com/2018/08/01/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    <id>http://yoursite.com/2018/08/01/è®¾è®¡æ¨¡å¼/</id>
    <published>2018-08-01T12:53:15.000Z</published>
    <updated>2019-01-08T10:59:38.245Z</updated>
    
    <content type="html"><![CDATA[<h2 id="builder-æ¨¡å¼"><a href="#builder-æ¨¡å¼" class="headerlink" title="builder æ¨¡å¼"></a>builder æ¨¡å¼</h2><p>builder å»ºé€ è€…æ¨¡å¼,åˆç§°ç”Ÿæˆå™¨æ¨¡å¼ã€‚</p><p>å»ºé€ è€…æ¨¡å¼æ˜¯ä¸ºäº†ç®€åŒ– ä½¿ç”¨å¤šä¸ªå»ºå•çš„å¯¹è±¡æ„å»ºæˆä¸€ä¸ªå¤æ‚å¯¹è±¡çš„ è®¾è®¡æ¨¡å¼ã€‚ å±äºåˆ›å»ºå‹æ¨¡å¼ã€‚</p><p>ä»£ç ç¤ºä¾‹</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">publish class SmallWheel()</div><div class="line">&#123;</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">publish class BigWheel()</div><div class="line">&#123;</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">publish class SmallCar()</div><div class="line">&#123;</div><div class="line">    publish $wheel;</div><div class="line">&#125;</div><div class="line"></div><div class="line">publish class BigCar()</div><div class="line">&#123;</div><div class="line">    publish $wheel;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>ä»¥ä¸Šä¸ºé›¶ä»¶ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">publish CarBuilder()</div><div class="line">&#123;</div><div class="line">    <span class="comment">//åˆ›å»ºå°è½¿è½¦</span></div><div class="line">    publish <span class="function"><span class="keyword">function</span> <span class="title">getSmallCar</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        $smallCar = <span class="keyword">new</span> SmallCar();</div><div class="line">        $smallCar-&gt;whell = <span class="keyword">new</span> SmallWheel();</div><div class="line">        <span class="keyword">return</span> $smallCar;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//åˆ›å»ºå¤§è½¿è½¦</span></div><div class="line">    publish <span class="function"><span class="keyword">function</span> <span class="title">getBigCar</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        $bigCar = <span class="keyword">new</span> BigCar();</div><div class="line">        $bigCar-&gt;whell = <span class="keyword">new</span> BigWheel();</div><div class="line">        <span class="keyword">return</span> $bigCar;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>è°ƒåº¦ </p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$carBuilder = <span class="keyword">new</span> CArBuilder();</div><div class="line"></div><div class="line">$smallCar = $carBuilder-&gt;getSmallCar();</div><div class="line">$bigCar = $carBuilder-&gt;getBigCar();</div></pre></td></tr></table></figure><p>å¤‡æ³¨:</p><p>å»ºé€ è€…æ¨¡å¼ä¸å·¥å‚æ¨¡å¼åŒºåˆ«:<br>å·¥å‚æ¨¡å¼ç”¨äºæ‰¹é‡åˆ›å»ºé‚£å“ªä¸€ç§ç±», å»ºé€ è€…æ¨¡å¼æ›´æ³¨é‡æ„å»ºè¿‡ç¨‹ã€‚</p><h2 id="template-method"><a href="#template-method" class="headerlink" title="template method"></a>template method</h2><p>æ¨¡æ¿æ–¹æ³•:å®šä¹‰ä¸€ä¸ªæŠ½è±¡ç±»æˆ–è€…/çˆ¶ç±»,ç”±ç»§æ‰¿å®ƒçš„å­ç±»æŒ‰ç…§éœ€æ±‚é‡å†™å®ƒçš„æ–¹æ³•å®ç°ã€‚</p><p>eg:</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">publish abstract class Car()</div><div class="line">&#123;</div><div class="line">    //å¼ºåˆ¶å­ç±»å®ç°</div><div class="line">    abstract public function run();</div><div class="line">    abstract public function turnOnTheLight();</div><div class="line">    //ä¸å¼ºåˆ¶</div><div class="line">    public function palyMusic()</div><div class="line">    &#123;</div><div class="line">        return 'hengheng hahei';</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>ç»§æ‰¿</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmaCar</span> <span class="keyword">extends</span> <span class="title">car</span> </span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">'run'</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> funtion turnOnTheLight()</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">'turnOnTheLight'</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>ä»¥ä¸Š</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;builder-æ¨¡å¼&quot;&gt;&lt;a href=&quot;#builder-æ¨¡å¼&quot; class=&quot;headerlink&quot; title=&quot;builder æ¨¡å¼&quot;&gt;&lt;/a&gt;builder æ¨¡å¼&lt;/h2&gt;&lt;p&gt;builder å»ºé€ è€…æ¨¡å¼,åˆç§°ç”Ÿæˆå™¨æ¨¡å¼ã€‚&lt;/p&gt;
&lt;p&gt;å»ºé€ è€…æ¨¡å¼æ˜¯ä¸ºäº†
      
    
    </summary>
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="http://yoursite.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="http://yoursite.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Item2ä½¿ç”¨sz rzå‘½ä»¤ä»æœåŠ¡ä¸‹è½½ä¸Šä¼ æ–‡ä»¶</title>
    <link href="http://yoursite.com/2018/07/12/%E4%BD%BF%E7%94%A8sz-rz%E5%91%BD%E4%BB%A4%E4%BB%8E%E6%9C%8D%E5%8A%A1%E4%B8%8B%E8%BD%BD%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6/"/>
    <id>http://yoursite.com/2018/07/12/ä½¿ç”¨sz-rzå‘½ä»¤ä»æœåŠ¡ä¸‹è½½ä¸Šä¼ æ–‡ä»¶/</id>
    <published>2018-07-12T13:27:37.000Z</published>
    <updated>2019-01-08T10:58:18.218Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>å¦‚ä½•ä»linuxæœåŠ¡ä¸‹è½½/ä¸Šä¼ æ–‡ä»¶</p><ul><li>ä½¿ç”¨scpå‘½ä»¤</li><li>ä½¿ç”¨szå‘½ä»¤</li></ul><p>è¿™é‡Œä¸»è¦ä»‹ç»ä½¿ç”¨szå‘½ä»¤ä¸‹è½½æ–‡ä»¶</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><ul><li>å®‰è£…lrzsz <code>hobrew install llssz</code></li><li>åœ¨æœ¬åœ°ç¼–å†™shellç”¨äºæ¥å—szå‘½ä»¤ä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶</li></ul><p>ä¸Šä¼ shell</p><p><code>iterm2-send-zmodem.sh</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line"></div><div class="line"></div><div class="line">#Author: Matt Mastracci (matthew@mastracci.com)</div><div class="line"></div><div class="line"></div><div class="line"># AppleScript from http://stackoverflow.com/questions/4309087/cancel-button-on-osascript-in-a-bash-script</div><div class="line"></div><div class="line"></div><div class="line"># licensed under cc-wiki with attribution required</div><div class="line"></div><div class="line"></div><div class="line"># Remainder of script public domain</div><div class="line"></div><div class="line"></div><div class="line">osascript -e &apos;tell application &quot;iTerm2&quot; to version&apos; &gt; /dev/null 2&gt;&amp;1 &amp;&amp; NAME=iTerm2 || NAME=iTerm</div><div class="line">if [[ $NAME = &quot;iTerm&quot; ]]; then</div><div class="line">    FILE=`osascript -e &apos;tell application &quot;iTerm&quot; to activate&apos; -e &apos;tell application &quot;iTerm&quot; to set thefile to choose file with prompt &quot;Choose a file to send&quot;&apos; -e &quot;do shell script (\&quot;echo \&quot;&amp;(quoted form of POSIX path of thefile as Unicode text)&amp;\&quot;\&quot;)&quot;`</div><div class="line">else</div><div class="line">    FILE=`osascript -e &apos;tell application &quot;iTerm2&quot; to activate&apos; -e &apos;tell application &quot;iTerm2&quot; to set thefile to choose file with prompt &quot;Choose a file to send&quot;&apos; -e &quot;do shell script (\&quot;echo \&quot;&amp;(quoted form of POSIX path of thefile as Unicode text)&amp;\&quot;\&quot;)&quot;`</div><div class="line">fi</div><div class="line">if [[ $FILE = &quot;&quot; ]]; then</div><div class="line">    echo Cancelled.</div><div class="line">    # Send ZModem cancel</div><div class="line">    echo -e \\x18\\x18\\x18\\x18\\x18</div><div class="line">    sleep 1</div><div class="line">    echo</div><div class="line">    echo \# Cancelled transfer</div><div class="line">else</div><div class="line">    /usr/local/bin/sz &quot;$FILE&quot; -e -b</div><div class="line">    sleep 1</div><div class="line">    echo</div><div class="line">    echo \# Received $FILE</div><div class="line">fi</div></pre></td></tr></table></figure></p><p>ä¸‹è½½shell</p><p><code>iterm2-recv-zmodem.sh</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line"># Author: Matt Mastracci (matthew@mastracci.com)</div><div class="line"># AppleScript from http://stackoverflow.com/questions/4309087/cancel-button-on-osascript-in-a-bash-script</div><div class="line"># licensed under cc-wiki with attribution required </div><div class="line"># Remainder of script public domain</div><div class="line"></div><div class="line">osascript -e &apos;tell application &quot;iTerm2&quot; to version&apos; &gt; /dev/null 2&gt;&amp;1 &amp;&amp; NAME=iTerm2 || NAME=iTerm</div><div class="line">if [[ $NAME = &quot;iTerm&quot; ]]; then</div><div class="line">    FILE=`osascript -e &apos;tell application &quot;iTerm&quot; to activate&apos; -e &apos;tell application &quot;iTerm&quot; to set thefile to choose folder with prompt &quot;Choose a folder to place received files in&quot;&apos; -e &quot;do shell script (\&quot;echo \&quot;&amp;(quoted form of POSIX path of thefile as Unicode text)&amp;\&quot;\&quot;)&quot;`</div><div class="line">else</div><div class="line">    FILE=`osascript -e &apos;tell application &quot;iTerm2&quot; to activate&apos; -e &apos;tell application &quot;iTerm2&quot; to set thefile to choose folder with prompt &quot;Choose a folder to place received files in&quot;&apos; -e &quot;do shell script (\&quot;echo \&quot;&amp;(quoted form of POSIX path of thefile as Unicode text)&amp;\&quot;\&quot;)&quot;`</div><div class="line">fi</div><div class="line"></div><div class="line">if [[ $FILE = &quot;&quot; ]]; then</div><div class="line">    echo Cancelled.</div><div class="line">    # Send ZModem cancel</div><div class="line">    echo -e \\x18\\x18\\x18\\x18\\x18</div><div class="line">    sleep 1</div><div class="line">    echo</div><div class="line">    echo \# Cancelled transfer</div><div class="line">else</div><div class="line">    cd &quot;$FILE&quot;</div><div class="line">    /usr/local/bin/rz -E -e -b</div><div class="line">    sleep 1</div><div class="line">    echo</div><div class="line">    echo</div><div class="line">    echo \# Sent \-\&gt; $FILE</div><div class="line">fi</div></pre></td></tr></table></figure><h2 id="é…ç½®iterm2"><a href="#é…ç½®iterm2" class="headerlink" title="é…ç½®iterm2"></a>é…ç½®iterm2</h2><ul><li>è®¾ç½®Iterm2çš„Tirggerç‰¹æ€§ï¼Œprofiles-default-editProfiles-Advancedä¸­çš„Tirgger</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">æ·»åŠ ä¸¤æ¡triggerï¼Œåˆ†åˆ«è®¾ç½®Regular expressionï¼ŒActionï¼ŒParametersï¼ŒInstantå¦‚ä¸‹ï¼š</div><div class="line">    1.ç¬¬ä¸€æ¡</div><div class="line">        Regular expression: rz waiting to receive.\*\*B0100</div><div class="line">        Action: Run Silent Coprocess</div><div class="line">        Parameters: /usr/local/bin/iterm2-send-zmodem.sh</div><div class="line">        Instant: checked</div><div class="line">    2.ç¬¬äºŒæ¡</div><div class="line">        Regular expression: \*\*B00000000000000</div><div class="line">        Action: Run Silent Coprocess</div><div class="line">        Parameters: /usr/local/bin/iterm2-recv-zmodem.sh</div><div class="line">        Instant: checked</div></pre></td></tr></table></figure><p><strong>å¤‡æ³¨</strong>:æ³¨æ„ä¸¤ä¸ªæ–‡ä»¶çš„æƒé™</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;å¦‚ä½•ä»linuxæœåŠ¡ä¸‹è½½/ä¸Šä¼ æ–‡ä»¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨scpå‘½ä»¤&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨szå‘½ä»¤&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™
      
    
    </summary>
    
      <category term="å·¥å…·" scheme="http://yoursite.com/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="å·¥å…·" scheme="http://yoursite.com/tags/%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>solr-å¢åˆ æ”¹æŸ¥</title>
    <link href="http://yoursite.com/2018/06/21/solr-%E4%BB%8E%E6%8E%A7%E5%88%B6%E9%A1%B5%E9%9D%A2%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE/"/>
    <id>http://yoursite.com/2018/06/21/solr-ä»æ§åˆ¶é¡µé¢åˆ é™¤æ•°æ®/</id>
    <published>2018-06-21T12:21:18.000Z</published>
    <updated>2019-01-08T10:57:17.491Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>solr ç‰ˆæœ¬ 5.3.1</p><h3 id="1-åˆ é™¤æ•°æ®"><a href="#1-åˆ é™¤æ•°æ®" class="headerlink" title="1.åˆ é™¤æ•°æ®"></a>1.åˆ é™¤æ•°æ®</h3><p>solr æä¾›å¤šé‡åˆ é™¤æ•°æ®æ–¹å¼, ä»æ§åˆ¶é¡µåˆ é™¤æ•°æ®æ˜¯ä¸€ç§æ–¹å¼,ä¸»è¦ç”¨äºäººå·¥åˆ é™¤å°‘é‡æ•°æ®<br>eg:<br><img src="/photo/img/solr-å¢åˆ æ”¹æŸ¥/DingTalk20180621202319.png" alt="image"></p><p>æ‰§è¡Œåˆ é™¤æ“ä½œä¹‹å‰:</p><p><img src="/photo/img/solr-å¢åˆ æ”¹æŸ¥/æ‰§è¡Œåˆ é™¤å‰æ•°æ®.png" alt="image"></p><p>åˆ é™¤æ“ä½œåªéœ€åœ¨æ§åˆ¶é¡µDocument Type é€‰æ‹©XMLé€‰é¡¹,ç„¶åè¾“å…¥ä¸€ä¸‹å†…å®¹æäº¤å³å¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;commit/&gt;</div><div class="line">&lt;delete&gt;&lt;query&gt;id:change.me1&lt;/query&gt;&lt;/delete&gt;</div><div class="line">&lt;commit/&gt;</div></pre></td></tr></table></figure><p>å…·ä½“æ‰§è¡Œ,ä»¥åŠhttpè¯·æ±‚:</p><p><img src="/photo/img/solr-å¢åˆ æ”¹æŸ¥/æ‰§è¡Œåˆ é™¤æ“ä½œ.png" alt="image"></p><p>æœ€åä¸ºæ‰§è¡Œåˆ é™¤åçš„ç»“æœ:</p><p><img src="/photo/img/solr-å¢åˆ æ”¹æŸ¥/æ‰§è¡Œåˆ é™¤æ“ä½œç»“æœ.png" alt="image"></p><h3 id="æ–°å¢æ•°æ®"><a href="#æ–°å¢æ•°æ®" class="headerlink" title="æ–°å¢æ•°æ®"></a>æ–°å¢æ•°æ®</h3><h4 id="json-æ–¹å¼æ·»åŠ æ•°æ®"><a href="#json-æ–¹å¼æ·»åŠ æ•°æ®" class="headerlink" title="json æ–¹å¼æ·»åŠ æ•°æ®"></a>json æ–¹å¼æ·»åŠ æ•°æ®</h4><p>åŒæ ·åœ¨solrçš„æ§åˆ¶é¡µé¢,é€‰åœ¨Document Typeä¸ºjsonã€‚</p><p>è¾“å…¥:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;&quot;id&quot;:&quot;ceshi2&quot;,&quot;title&quot;:&quot;è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•&quot;&#125;</div></pre></td></tr></table></figure><p><img src="/photo/img/solr-å¢åˆ æ”¹æŸ¥/æ–°å¢æ•°æ®.png" alt="image"></p><p>å¯ä»¥çœ‹å‡ºæ¥solræ˜¯å·²httpè¯·æ±‚çš„æ–¹å¼è¯·æ±‚ solr server,æ‰€ä»¥æˆ‘ä»¬ç”¨ç¨‹åºå»æŸ¥è¯¢solræ•°æ®æ˜¯,ä¹Ÿå¯jsonçš„æ–¹å¼å»æŸ¥è¯¢ã€‚<br>å½“ç„¶solræ”¯æŒxmlç­‰å¤šç§åŠŸèƒ½ã€‚ï¼ˆsolræ”¯æŒä»æ•°æ®åº“å¯¼å…¥æ•°æ®ï¼‰<br>å…·ä½“æŸ¥è¯¢è§„åˆ™ï¼ˆç›®å‰è¿˜æ²¡æ‰¾åˆ°,æ‰¾åˆ°åè¡¥å……ï¼‰:</p><p>æ‰§è¡Œç»“æœ</p><p><img src="/photo/img/solr-å¢åˆ æ”¹æŸ¥/æ‰§è¡Œç»“æœ.png" alt="image"></p><h3 id="æ›´æ–°æ•°æ®"><a href="#æ›´æ–°æ•°æ®" class="headerlink" title="æ›´æ–°æ•°æ®"></a>æ›´æ–°æ•°æ®</h3><p>ç¬¬ä¸€ä¸ªé—®é¢˜:solrä¸æ”¯æŒå±€éƒ¨æ›´æ–°ã€‚<br>æ‰€æœ‰çš„æ›´æ–°æ“ä½œå¯¹äºsolræ¥è¯´éƒ½æ˜¯ä¸€æ¬¡æ•°æ®çš„åˆ é™¤å’Œæ’å…¥,ä¾‹å¦‚:</p><p><img src="/photo/img/solr-å¢åˆ æ”¹æŸ¥/æ›´æ–°æ“ä½œ.png" alt="image"></p><p>åŒäº‹åˆè¯´æ”¯æŒå±€éƒ¨æ›´æ–°,ä½†æ˜¯æˆ‘è¿˜æ²¡æœ‰æ‰¾åˆ°ç›¸å…³æ–‡æ¡£,è¿™ä¸ªå¸¦æ±‚è¯</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;solr ç‰ˆæœ¬ 5.3.1&lt;/p&gt;
&lt;h3 id=&quot;1-åˆ é™¤æ•°æ®&quot;&gt;&lt;a href=&quot;#1-åˆ é™¤æ•°æ®&quot; class=&quot;headerlink&quot;
      
    
    </summary>
    
    
      <category term="solr" scheme="http://yoursite.com/tags/solr/"/>
    
  </entry>
  
</feed>
